{"dependencies":[{"name":"../api.js","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":66,"index":66}}],"key":"cPKsELqWARxElqFlbsOK3W8pAh4=","exportNames":["*"],"imports":1}},{"name":"../utils/dsn.js","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":2,"column":0,"index":67},"end":{"line":2,"column":48,"index":115}}],"key":"N9KAuIoocXj/7+4SJW53+/eZu00=","exportNames":["*"],"imports":1}},{"name":"../utils/envelope.js","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":3,"column":0,"index":116},"end":{"line":3,"column":75,"index":191}}],"key":"yiniLg9hHeIHPDkrzeivR1oDz5o=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  Object.defineProperty(exports, \"eventFromEnvelope\", {\n    enumerable: true,\n    get: function () {\n      return eventFromEnvelope;\n    }\n  });\n  Object.defineProperty(exports, \"makeMultiplexedTransport\", {\n    enumerable: true,\n    get: function () {\n      return makeMultiplexedTransport;\n    }\n  });\n  var _apiJs = require(_dependencyMap[0], \"../api.js\");\n  var _utilsDsnJs = require(_dependencyMap[1], \"../utils/dsn.js\");\n  var _utilsEnvelopeJs = require(_dependencyMap[2], \"../utils/envelope.js\");\n  /**\n   * Gets an event from an envelope.\n   *\n   * This is only exported for use in the tests\n   */\n  function eventFromEnvelope(env, types) {\n    let event;\n    (0, _utilsEnvelopeJs.forEachEnvelopeItem)(env, (item, type) => {\n      if (types.includes(type)) {\n        event = Array.isArray(item) ? item[1] : undefined;\n      }\n      // bail out if we found an event\n      return !!event;\n    });\n    return event;\n  }\n\n  /**\n   * Creates a transport that overrides the release on all events.\n   */\n  function makeOverrideReleaseTransport(createTransport, release) {\n    return options => {\n      const transport = createTransport(options);\n      return Object.assign({}, transport, {\n        send: async envelope => {\n          const event = eventFromEnvelope(envelope, ['event', 'transaction', 'profile', 'replay_event']);\n          if (event) {\n            event.release = release;\n          }\n          return transport.send(envelope);\n        }\n      });\n    };\n  }\n\n  /** Overrides the DSN in the envelope header  */\n  function overrideDsn(envelope, dsn) {\n    return (0, _utilsEnvelopeJs.createEnvelope)(dsn ? Object.assign({}, envelope[0], {\n      dsn\n    }) : envelope[0], envelope[1]);\n  }\n\n  /**\n   * Creates a transport that can send events to different DSNs depending on the envelope contents.\n   */\n  function makeMultiplexedTransport(createTransport, matcher) {\n    return options => {\n      const fallbackTransport = createTransport(options);\n      const otherTransports = new Map();\n      function getTransport(dsn, release) {\n        // We create a transport for every unique dsn/release combination as there may be code from multiple releases in\n        // use at the same time\n        const key = release ? `${dsn}:${release}` : dsn;\n        let transport = otherTransports.get(key);\n        if (!transport) {\n          const validatedDsn = (0, _utilsDsnJs.dsnFromString)(dsn);\n          if (!validatedDsn) {\n            return undefined;\n          }\n          const url = (0, _apiJs.getEnvelopeEndpointWithUrlEncodedAuth)(validatedDsn, options.tunnel);\n          transport = release ? makeOverrideReleaseTransport(createTransport, release)(Object.assign({}, options, {\n            url\n          })) : createTransport(Object.assign({}, options, {\n            url\n          }));\n          otherTransports.set(key, transport);\n        }\n        return [dsn, transport];\n      }\n      async function send(envelope) {\n        function getEvent(types) {\n          const eventTypes = types?.length ? types : ['event'];\n          return eventFromEnvelope(envelope, eventTypes);\n        }\n        const transports = matcher({\n          envelope,\n          getEvent\n        }).map(result => {\n          if (typeof result === 'string') {\n            return getTransport(result, undefined);\n          } else {\n            return getTransport(result.dsn, result.release);\n          }\n        }).filter(t => !!t);\n\n        // If we have no transports to send to, use the fallback transport\n        // Don't override the DSN in the header for the fallback transport. '' is falsy\n        const transportsWithFallback = transports.length ? transports : [['', fallbackTransport]];\n        const results = await Promise.all(transportsWithFallback.map(([dsn, transport]) => transport.send(overrideDsn(envelope, dsn))));\n        return results[0];\n      }\n      async function flush(timeout) {\n        const allTransports = [...otherTransports.values(), fallbackTransport];\n        const results = await Promise.all(allTransports.map(transport => transport.flush(timeout)));\n        return results.every(r => r);\n      }\n      return {\n        send,\n        flush\n      };\n    };\n  }\n});","lineCount":124,"map":[[7,2,136,0,"Object"],[7,8,136,0],[7,9,136,0,"defineProperty"],[7,23,136,0],[7,24,136,0,"exports"],[7,31,136,0],[8,4,136,0,"enumerable"],[8,14,136,0],[9,4,136,0,"get"],[9,7,136,0],[9,18,136,0,"get"],[9,19,136,0],[10,6,136,0],[10,13,136,9,"eventFromEnvelope"],[10,30,136,26],[11,4,136,26],[12,2,136,26],[13,2,136,0,"Object"],[13,8,136,0],[13,9,136,0,"defineProperty"],[13,23,136,0],[13,24,136,0,"exports"],[13,31,136,0],[14,4,136,0,"enumerable"],[14,14,136,0],[15,4,136,0,"get"],[15,7,136,0],[15,18,136,0,"get"],[15,19,136,0],[16,6,136,0],[16,13,136,28,"makeMultiplexedTransport"],[16,37,136,52],[17,4,136,52],[18,2,136,52],[19,2,1,0],[19,6,1,0,"_apiJs"],[19,12,1,0],[19,15,1,0,"require"],[19,22,1,0],[19,23,1,0,"_dependencyMap"],[19,37,1,0],[20,2,2,0],[20,6,2,0,"_utilsDsnJs"],[20,17,2,0],[20,20,2,0,"require"],[20,27,2,0],[20,28,2,0,"_dependencyMap"],[20,42,2,0],[21,2,3,0],[21,6,3,0,"_utilsEnvelopeJs"],[21,22,3,0],[21,25,3,0,"require"],[21,32,3,0],[21,33,3,0,"_dependencyMap"],[21,47,3,0],[22,2,5,0],[23,0,6,0],[24,0,7,0],[25,0,8,0],[26,0,9,0],[27,2,10,0],[27,11,10,9,"eventFromEnvelope"],[27,28,10,26,"eventFromEnvelope"],[27,29,10,27,"env"],[27,32,10,30],[27,34,10,32,"types"],[27,39,10,37],[27,41,10,39],[28,4,11,2],[28,8,11,6,"event"],[28,13,11,11],[29,4,13,2],[29,8,13,2,"forEachEnvelopeItem"],[29,24,13,21],[29,25,13,21,"forEachEnvelopeItem"],[29,44,13,21],[29,46,13,22,"env"],[29,49,13,25],[29,51,13,27],[29,52,13,28,"item"],[29,56,13,32],[29,58,13,34,"type"],[29,62,13,38],[29,67,13,43],[30,6,14,4],[30,10,14,8,"types"],[30,15,14,13],[30,16,14,14,"includes"],[30,24,14,22],[30,25,14,23,"type"],[30,29,14,27],[30,30,14,28],[30,32,14,30],[31,8,15,6,"event"],[31,13,15,11],[31,16,15,14,"Array"],[31,21,15,19],[31,22,15,20,"isArray"],[31,29,15,27],[31,30,15,28,"item"],[31,34,15,32],[31,35,15,33],[31,38,15,37,"item"],[31,42,15,41],[31,43,15,44],[31,44,15,45],[31,45,15,46],[31,48,15,49,"undefined"],[31,57,15,58],[32,6,16,4],[33,6,17,4],[34,6,18,4],[34,13,18,11],[34,14,18,12],[34,15,18,13,"event"],[34,20,18,18],[35,4,19,2],[35,5,19,3],[35,6,19,4],[36,4,21,2],[36,11,21,9,"event"],[36,16,21,14],[37,2,22,0],[39,2,24,0],[40,0,25,0],[41,0,26,0],[42,2,27,0],[42,11,27,9,"makeOverrideReleaseTransport"],[42,39,27,37,"makeOverrideReleaseTransport"],[42,40,28,2,"createTransport"],[42,55,28,17],[42,57,29,2,"release"],[42,64,29,9],[42,66,30,2],[43,4,31,2],[43,11,31,9,"options"],[43,18,31,16],[43,22,31,20],[44,6,32,4],[44,12,32,10,"transport"],[44,21,32,19],[44,24,32,22,"createTransport"],[44,39,32,37],[44,40,32,38,"options"],[44,47,32,45],[44,48,32,46],[45,6,34,4],[45,13,34,4,"Object"],[45,19,34,4],[45,20,34,4,"assign"],[45,26,34,4],[45,31,35,9,"transport"],[45,40,35,18],[46,8,36,6,"send"],[46,12,36,10],[46,14,36,12],[46,20,36,19,"envelope"],[46,28,36,27],[46,32,36,32],[47,10,37,8],[47,16,37,14,"event"],[47,21,37,19],[47,24,37,22,"eventFromEnvelope"],[47,41,37,39],[47,42,37,40,"envelope"],[47,50,37,48],[47,52,37,50],[47,53,37,51],[47,60,37,58],[47,62,37,60],[47,75,37,73],[47,77,37,75],[47,86,37,84],[47,88,37,86],[47,102,37,100],[47,103,37,101],[47,104,37,102],[48,10,39,8],[48,14,39,12,"event"],[48,19,39,17],[48,21,39,19],[49,12,40,10,"event"],[49,17,40,15],[49,18,40,16,"release"],[49,25,40,23],[49,28,40,26,"release"],[49,35,40,33],[50,10,41,8],[51,10,42,8],[51,17,42,15,"transport"],[51,26,42,24],[51,27,42,25,"send"],[51,31,42,29],[51,32,42,30,"envelope"],[51,40,42,38],[51,41,42,39],[52,8,43,6],[53,6,43,7],[54,4,45,2],[54,5,45,3],[55,2,46,0],[57,2,48,0],[58,2,49,0],[58,11,49,9,"overrideDsn"],[58,22,49,20,"overrideDsn"],[58,23,49,21,"envelope"],[58,31,49,29],[58,33,49,31,"dsn"],[58,36,49,34],[58,38,49,36],[59,4,50,2],[59,11,50,9],[59,15,50,9,"createEnvelope"],[59,31,50,23],[59,32,50,23,"createEnvelope"],[59,46,50,23],[59,48,51,4,"dsn"],[59,51,51,7],[59,54,51,7,"Object"],[59,60,51,7],[59,61,51,7,"assign"],[59,67,51,7],[59,72,53,13,"envelope"],[59,80,53,21],[59,81,53,22],[59,82,53,23],[59,83,53,24],[60,6,54,10,"dsn"],[61,4,54,13],[61,9,56,8,"envelope"],[61,17,56,16],[61,18,56,17],[61,19,56,18],[61,20,56,19],[61,22,57,4,"envelope"],[61,30,57,12],[61,31,57,13],[61,32,57,14],[61,33,58,2],[61,34,58,3],[62,2,59,0],[64,2,61,0],[65,0,62,0],[66,0,63,0],[67,2,64,0],[67,11,64,9,"makeMultiplexedTransport"],[67,35,64,33,"makeMultiplexedTransport"],[67,36,65,2,"createTransport"],[67,51,65,17],[67,53,66,2,"matcher"],[67,60,66,9],[67,62,67,2],[68,4,68,2],[68,11,68,9,"options"],[68,18,68,16],[68,22,68,20],[69,6,69,4],[69,12,69,10,"fallbackTransport"],[69,29,69,27],[69,32,69,30,"createTransport"],[69,47,69,45],[69,48,69,46,"options"],[69,55,69,53],[69,56,69,54],[70,6,70,4],[70,12,70,10,"otherTransports"],[70,27,70,25],[70,30,70,28],[70,34,70,32,"Map"],[70,37,70,35],[70,38,70,36],[70,39,70,37],[71,6,72,4],[71,15,72,13,"getTransport"],[71,27,72,25,"getTransport"],[71,28,72,26,"dsn"],[71,31,72,29],[71,33,72,31,"release"],[71,40,72,38],[71,42,72,40],[72,8,73,6],[73,8,74,6],[74,8,75,6],[74,14,75,12,"key"],[74,17,75,15],[74,20,75,18,"release"],[74,27,75,25],[74,30,75,28],[74,33,75,31,"dsn"],[74,36,75,34],[74,40,75,38,"release"],[74,47,75,45],[74,49,75,47],[74,52,75,50,"dsn"],[74,55,75,53],[75,8,77,6],[75,12,77,10,"transport"],[75,21,77,19],[75,24,77,22,"otherTransports"],[75,39,77,37],[75,40,77,38,"get"],[75,43,77,41],[75,44,77,42,"key"],[75,47,77,45],[75,48,77,46],[76,8,79,6],[76,12,79,10],[76,13,79,11,"transport"],[76,22,79,20],[76,24,79,22],[77,10,80,8],[77,16,80,14,"validatedDsn"],[77,28,80,26],[77,31,80,29],[77,35,80,29,"dsnFromString"],[77,46,80,42],[77,47,80,42,"dsnFromString"],[77,60,80,42],[77,62,80,43,"dsn"],[77,65,80,46],[77,66,80,47],[78,10,81,8],[78,14,81,12],[78,15,81,13,"validatedDsn"],[78,27,81,25],[78,29,81,27],[79,12,82,10],[79,19,82,17,"undefined"],[79,28,82,26],[80,10,83,8],[81,10,84,8],[81,16,84,14,"url"],[81,19,84,17],[81,22,84,20],[81,26,84,20,"getEnvelopeEndpointWithUrlEncodedAuth"],[81,32,84,57],[81,33,84,57,"getEnvelopeEndpointWithUrlEncodedAuth"],[81,70,84,57],[81,72,84,58,"validatedDsn"],[81,84,84,70],[81,86,84,72,"options"],[81,93,84,79],[81,94,84,80,"tunnel"],[81,100,84,86],[81,101,84,87],[82,10,86,8,"transport"],[82,19,86,17],[82,22,86,20,"release"],[82,29,86,27],[82,32,87,12,"makeOverrideReleaseTransport"],[82,60,87,40],[82,61,87,41,"createTransport"],[82,76,87,56],[82,78,87,58,"release"],[82,85,87,65],[82,86,87,66],[82,87,87,66,"Object"],[82,93,87,66],[82,94,87,66,"assign"],[82,100,87,66],[82,105,87,72,"options"],[82,112,87,79],[83,12,87,81,"url"],[84,10,87,84],[84,12,87,86],[84,13,87,87],[84,16,88,12,"createTransport"],[84,31,88,27],[84,32,88,27,"Object"],[84,38,88,27],[84,39,88,27,"assign"],[84,45,88,27],[84,50,88,33,"options"],[84,57,88,40],[85,12,88,42,"url"],[86,10,88,45],[86,12,88,47],[86,13,88,48],[87,10,90,8,"otherTransports"],[87,25,90,23],[87,26,90,24,"set"],[87,29,90,27],[87,30,90,28,"key"],[87,33,90,31],[87,35,90,33,"transport"],[87,44,90,42],[87,45,90,43],[88,8,91,6],[89,8,93,6],[89,15,93,13],[89,16,93,14,"dsn"],[89,19,93,17],[89,21,93,19,"transport"],[89,30,93,28],[89,31,93,29],[90,6,94,4],[91,6,96,4],[91,21,96,19,"send"],[91,25,96,23,"send"],[91,26,96,24,"envelope"],[91,34,96,32],[91,36,96,34],[92,8,97,6],[92,17,97,15,"getEvent"],[92,25,97,23,"getEvent"],[92,26,97,24,"types"],[92,31,97,29],[92,33,97,31],[93,10,98,8],[93,16,98,14,"eventTypes"],[93,26,98,24],[93,29,98,27,"types"],[93,34,98,32],[93,36,98,34,"length"],[93,42,98,40],[93,45,98,43,"types"],[93,50,98,48],[93,53,98,51],[93,54,98,52],[93,61,98,59],[93,62,98,60],[94,10,99,8],[94,17,99,15,"eventFromEnvelope"],[94,34,99,32],[94,35,99,33,"envelope"],[94,43,99,41],[94,45,99,43,"eventTypes"],[94,55,99,53],[94,56,99,54],[95,8,100,6],[96,8,102,6],[96,14,102,12,"transports"],[96,24,102,22],[96,27,102,25,"matcher"],[96,34,102,32],[96,35,102,33],[97,10,102,35,"envelope"],[97,18,102,43],[98,10,102,45,"getEvent"],[99,8,102,54],[99,9,102,55],[99,10,102,56],[99,11,103,9,"map"],[99,14,103,12],[99,15,103,13,"result"],[99,21,103,19],[99,25,103,23],[100,10,104,10],[100,14,104,14],[100,21,104,21,"result"],[100,27,104,27],[100,32,104,32],[100,40,104,40],[100,42,104,42],[101,12,105,12],[101,19,105,19,"getTransport"],[101,31,105,31],[101,32,105,32,"result"],[101,38,105,38],[101,40,105,40,"undefined"],[101,49,105,49],[101,50,105,50],[102,10,106,10],[102,11,106,11],[102,17,106,17],[103,12,107,12],[103,19,107,19,"getTransport"],[103,31,107,31],[103,32,107,32,"result"],[103,38,107,38],[103,39,107,39,"dsn"],[103,42,107,42],[103,44,107,44,"result"],[103,50,107,50],[103,51,107,51,"release"],[103,58,107,58],[103,59,107,59],[104,10,108,10],[105,8,109,8],[105,9,109,9],[105,10,109,10],[105,11,110,9,"filter"],[105,17,110,15],[105,18,110,17,"t"],[105,19,110,18],[105,23,110,23],[105,24,110,24],[105,25,110,25,"t"],[105,26,110,26],[105,27,110,27],[107,8,112,6],[108,8,113,6],[109,8,114,6],[109,14,114,12,"transportsWithFallback"],[109,36,114,34],[109,39,114,37,"transports"],[109,49,114,47],[109,50,114,48,"length"],[109,56,114,54],[109,59,114,57,"transports"],[109,69,114,67],[109,72,114,70],[109,73,114,71],[109,74,114,72],[109,76,114,74],[109,78,114,76,"fallbackTransport"],[109,95,114,93],[109,96,114,94],[109,97,114,95],[110,8,116,6],[110,14,116,12,"results"],[110,21,116,19],[110,24,116,23],[110,30,116,29,"Promise"],[110,37,116,36],[110,38,116,37,"all"],[110,41,116,40],[110,42,117,8,"transportsWithFallback"],[110,64,117,30],[110,65,117,31,"map"],[110,68,117,34],[110,69,117,35],[110,70,117,36],[110,71,117,37,"dsn"],[110,74,117,40],[110,76,117,42,"transport"],[110,85,117,51],[110,86,117,52],[110,91,117,57,"transport"],[110,100,117,66],[110,101,117,67,"send"],[110,105,117,71],[110,106,117,72,"overrideDsn"],[110,117,117,83],[110,118,117,84,"envelope"],[110,126,117,92],[110,128,117,94,"dsn"],[110,131,117,97],[110,132,117,98],[110,133,117,99],[110,134,118,6],[110,135,118,8],[111,8,120,6],[111,15,120,13,"results"],[111,22,120,20],[111,23,120,21],[111,24,120,22],[111,25,120,23],[112,6,121,4],[113,6,123,4],[113,21,123,19,"flush"],[113,26,123,24,"flush"],[113,27,123,25,"timeout"],[113,34,123,32],[113,36,123,34],[114,8,124,6],[114,14,124,12,"allTransports"],[114,27,124,25],[114,30,124,28],[114,31,124,29],[114,34,124,32,"otherTransports"],[114,49,124,47],[114,50,124,48,"values"],[114,56,124,54],[114,57,124,55],[114,58,124,56],[114,60,124,58,"fallbackTransport"],[114,77,124,75],[114,78,124,76],[115,8,125,6],[115,14,125,12,"results"],[115,21,125,19],[115,24,125,22],[115,30,125,28,"Promise"],[115,37,125,35],[115,38,125,36,"all"],[115,41,125,39],[115,42,125,40,"allTransports"],[115,55,125,53],[115,56,125,54,"map"],[115,59,125,57],[115,60,125,58,"transport"],[115,69,125,67],[115,73,125,71,"transport"],[115,82,125,80],[115,83,125,81,"flush"],[115,88,125,86],[115,89,125,87,"timeout"],[115,96,125,94],[115,97,125,95],[115,98,125,96],[115,99,125,97],[116,8,126,6],[116,15,126,13,"results"],[116,22,126,20],[116,23,126,21,"every"],[116,28,126,26],[116,29,126,27,"r"],[116,30,126,28],[116,34,126,32,"r"],[116,35,126,33],[116,36,126,34],[117,6,127,4],[118,6,129,4],[118,13,129,11],[119,8,130,6,"send"],[119,12,130,10],[120,8,131,6,"flush"],[121,6,132,4],[121,7,132,5],[122,4,133,2],[122,5,133,3],[123,2,134,0],[124,0,134,1],[124,3]],"functionMap":{"names":["<global>","eventFromEnvelope","forEachEnvelopeItem$argument_1","makeOverrideReleaseTransport","<anonymous>","send","overrideDsn","makeMultiplexedTransport","getTransport","getEvent","matcher.map$argument_0","matcher.map.filter$argument_0","transportsWithFallback.map$argument_0","flush","allTransports.map$argument_0","results.every$argument_0"],"mappings":"AAA;ACS;2BCG;GDM;CDG;AGK;SCI;YCK;ODO;GDE;CHC;AMG;CNU;AOK;SHI;III;KJsB;ICE;MIC;OJG;aKG;SLM;gBMC,UN;mCOO,gEP;KDI;ISE;0DCE,qCD;2BEC,MF;KTC;GGM;CPC"},"hasCjsExports":false},"type":"js/module"}]}