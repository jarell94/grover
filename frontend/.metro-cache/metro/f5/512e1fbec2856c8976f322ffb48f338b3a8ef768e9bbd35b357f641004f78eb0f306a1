{"dependencies":[{"name":"./attributes.js","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":194,"index":194}}],"key":"UMlNobrmssIvLA9C9D03xjrDrQE=","exportNames":["*"],"imports":1}},{"name":"./validation.js","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":2,"column":0,"index":195},"end":{"line":2,"column":53,"index":248}}],"key":"wSuRSTlWQJOdJulOWcNvpmeJHkU=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  Object.defineProperty(exports, \"extractPromptResultAttributes\", {\n    enumerable: true,\n    get: function () {\n      return extractPromptResultAttributes;\n    }\n  });\n  Object.defineProperty(exports, \"extractToolResultAttributes\", {\n    enumerable: true,\n    get: function () {\n      return extractToolResultAttributes;\n    }\n  });\n  var _attributesJs = require(_dependencyMap[0], \"./attributes.js\");\n  var _validationJs = require(_dependencyMap[1], \"./validation.js\");\n  /**\n   * Result extraction functions for MCP server instrumentation\n   *\n   * Handles extraction of attributes from tool and prompt execution results.\n   */\n\n  /**\n   * Build attributes for tool result content items\n   * @param content - Array of content items from tool result\n   * @returns Attributes extracted from each content item including type, text, mime type, URI, and resource info\n   */\n  function buildAllContentItemAttributes(content) {\n    const attributes = {\n      [_attributesJs.MCP_TOOL_RESULT_CONTENT_COUNT_ATTRIBUTE]: content.length\n    };\n    for (const [i, item] of content.entries()) {\n      if (!(0, _validationJs.isValidContentItem)(item)) {\n        continue;\n      }\n      const prefix = content.length === 1 ? 'mcp.tool.result' : `mcp.tool.result.${i}`;\n      const safeSet = (key, value) => {\n        if (typeof value === 'string') {\n          attributes[`${prefix}.${key}`] = value;\n        }\n      };\n      safeSet('content_type', item.type);\n      safeSet('mime_type', item.mimeType);\n      safeSet('uri', item.uri);\n      safeSet('name', item.name);\n      if (typeof item.text === 'string') {\n        attributes[`${prefix}.content`] = item.text;\n      }\n      if (typeof item.data === 'string') {\n        attributes[`${prefix}.data_size`] = item.data.length;\n      }\n      const resource = item.resource;\n      if ((0, _validationJs.isValidContentItem)(resource)) {\n        safeSet('resource_uri', resource.uri);\n        safeSet('resource_mime_type', resource.mimeType);\n      }\n    }\n    return attributes;\n  }\n\n  /**\n   * Extract tool result attributes for span instrumentation\n   * @param result - Tool execution result\n   * @returns Attributes extracted from tool result content\n   */\n  function extractToolResultAttributes(result) {\n    if (!(0, _validationJs.isValidContentItem)(result)) {\n      return {};\n    }\n    const attributes = Array.isArray(result.content) ? buildAllContentItemAttributes(result.content) : {};\n    if (typeof result.isError === 'boolean') {\n      attributes[_attributesJs.MCP_TOOL_RESULT_IS_ERROR_ATTRIBUTE] = result.isError;\n    }\n    return attributes;\n  }\n\n  /**\n   * Extract prompt result attributes for span instrumentation\n   * @param result - Prompt execution result\n   * @returns Attributes extracted from prompt result\n   */\n  function extractPromptResultAttributes(result) {\n    const attributes = {};\n    if (!(0, _validationJs.isValidContentItem)(result)) {\n      return attributes;\n    }\n    if (typeof result.description === 'string') {\n      attributes[_attributesJs.MCP_PROMPT_RESULT_DESCRIPTION_ATTRIBUTE] = result.description;\n    }\n    if (Array.isArray(result.messages)) {\n      attributes[_attributesJs.MCP_PROMPT_RESULT_MESSAGE_COUNT_ATTRIBUTE] = result.messages.length;\n      const messages = result.messages;\n      for (const [i, message] of messages.entries()) {\n        if (!(0, _validationJs.isValidContentItem)(message)) {\n          continue;\n        }\n        const prefix = messages.length === 1 ? 'mcp.prompt.result' : `mcp.prompt.result.${i}`;\n        const safeSet = (key, value) => {\n          if (typeof value === 'string') {\n            const attrName = messages.length === 1 ? `${prefix}.message_${key}` : `${prefix}.${key}`;\n            attributes[attrName] = value;\n          }\n        };\n        safeSet('role', message.role);\n        if ((0, _validationJs.isValidContentItem)(message.content)) {\n          const content = message.content;\n          if (typeof content.text === 'string') {\n            const attrName = messages.length === 1 ? `${prefix}.message_content` : `${prefix}.content`;\n            attributes[attrName] = content.text;\n          }\n        }\n      }\n    }\n    return attributes;\n  }\n});","lineCount":120,"map":[[7,2,124,0,"Object"],[7,8,124,0],[7,9,124,0,"defineProperty"],[7,23,124,0],[7,24,124,0,"exports"],[7,31,124,0],[8,4,124,0,"enumerable"],[8,14,124,0],[9,4,124,0,"get"],[9,7,124,0],[9,18,124,0,"get"],[9,19,124,0],[10,6,124,0],[10,13,124,9,"extractPromptResultAttributes"],[10,42,124,38],[11,4,124,38],[12,2,124,38],[13,2,124,0,"Object"],[13,8,124,0],[13,9,124,0,"defineProperty"],[13,23,124,0],[13,24,124,0,"exports"],[13,31,124,0],[14,4,124,0,"enumerable"],[14,14,124,0],[15,4,124,0,"get"],[15,7,124,0],[15,18,124,0,"get"],[15,19,124,0],[16,6,124,0],[16,13,124,40,"extractToolResultAttributes"],[16,40,124,67],[17,4,124,67],[18,2,124,67],[19,2,1,0],[19,6,1,0,"_attributesJs"],[19,19,1,0],[19,22,1,0,"require"],[19,29,1,0],[19,30,1,0,"_dependencyMap"],[19,44,1,0],[20,2,2,0],[20,6,2,0,"_validationJs"],[20,19,2,0],[20,22,2,0,"require"],[20,29,2,0],[20,30,2,0,"_dependencyMap"],[20,44,2,0],[21,2,4,0],[22,0,5,0],[23,0,6,0],[24,0,7,0],[25,0,8,0],[27,2,11,0],[28,0,12,0],[29,0,13,0],[30,0,14,0],[31,0,15,0],[32,2,16,0],[32,11,16,9,"buildAllContentItemAttributes"],[32,40,16,38,"buildAllContentItemAttributes"],[32,41,16,39,"content"],[32,48,16,46],[32,50,16,48],[33,4,17,2],[33,10,17,8,"attributes"],[33,20,17,18],[33,23,17,21],[34,6,18,4],[34,7,18,5,"MCP_TOOL_RESULT_CONTENT_COUNT_ATTRIBUTE"],[34,20,18,44],[34,21,18,44,"MCP_TOOL_RESULT_CONTENT_COUNT_ATTRIBUTE"],[34,60,18,44],[34,63,18,47,"content"],[34,70,18,54],[34,71,18,55,"length"],[35,4,19,2],[35,5,19,3],[36,4,21,2],[36,9,21,7],[36,15,21,13],[36,16,21,14,"i"],[36,17,21,15],[36,19,21,17,"item"],[36,23,21,21],[36,24,21,22],[36,28,21,26,"content"],[36,35,21,33],[36,36,21,34,"entries"],[36,43,21,41],[36,44,21,42],[36,45,21,43],[36,47,21,45],[37,6,22,4],[37,10,22,8],[37,11,22,9],[37,15,22,9,"isValidContentItem"],[37,28,22,27],[37,29,22,27,"isValidContentItem"],[37,47,22,27],[37,49,22,28,"item"],[37,53,22,32],[37,54,22,33],[37,56,22,35],[38,8,23,6],[39,6,24,4],[40,6,26,4],[40,12,26,10,"prefix"],[40,18,26,16],[40,21,26,19,"content"],[40,28,26,26],[40,29,26,27,"length"],[40,35,26,33],[40,40,26,38],[40,41,26,39],[40,44,26,42],[40,61,26,59],[40,64,26,62],[40,83,26,81,"i"],[40,84,26,82],[40,86,26,84],[41,6,28,4],[41,12,28,10,"safeSet"],[41,19,28,17],[41,22,28,20,"safeSet"],[41,23,28,21,"key"],[41,26,28,24],[41,28,28,26,"value"],[41,33,28,31],[41,38,28,36],[42,8,29,6],[42,12,29,10],[42,19,29,17,"value"],[42,24,29,22],[42,29,29,27],[42,37,29,35],[42,39,29,37],[43,10,30,8,"attributes"],[43,20,30,18],[43,21,30,19],[43,24,30,22,"prefix"],[43,30,30,28],[43,34,30,32,"key"],[43,37,30,35],[43,39,30,37],[43,40,30,38],[43,43,30,41,"value"],[43,48,30,46],[44,8,31,6],[45,6,32,4],[45,7,32,5],[46,6,34,4,"safeSet"],[46,13,34,11],[46,14,34,12],[46,28,34,26],[46,30,34,28,"item"],[46,34,34,32],[46,35,34,33,"type"],[46,39,34,37],[46,40,34,38],[47,6,35,4,"safeSet"],[47,13,35,11],[47,14,35,12],[47,25,35,23],[47,27,35,25,"item"],[47,31,35,29],[47,32,35,30,"mimeType"],[47,40,35,38],[47,41,35,39],[48,6,36,4,"safeSet"],[48,13,36,11],[48,14,36,12],[48,19,36,17],[48,21,36,19,"item"],[48,25,36,23],[48,26,36,24,"uri"],[48,29,36,27],[48,30,36,28],[49,6,37,4,"safeSet"],[49,13,37,11],[49,14,37,12],[49,20,37,18],[49,22,37,20,"item"],[49,26,37,24],[49,27,37,25,"name"],[49,31,37,29],[49,32,37,30],[50,6,39,4],[50,10,39,8],[50,17,39,15,"item"],[50,21,39,19],[50,22,39,20,"text"],[50,26,39,24],[50,31,39,29],[50,39,39,37],[50,41,39,39],[51,8,40,6,"attributes"],[51,18,40,16],[51,19,40,17],[51,22,40,20,"prefix"],[51,28,40,26],[51,38,40,36],[51,39,40,37],[51,42,40,40,"item"],[51,46,40,44],[51,47,40,45,"text"],[51,51,40,49],[52,6,41,4],[53,6,43,4],[53,10,43,8],[53,17,43,15,"item"],[53,21,43,19],[53,22,43,20,"data"],[53,26,43,24],[53,31,43,29],[53,39,43,37],[53,41,43,39],[54,8,44,6,"attributes"],[54,18,44,16],[54,19,44,17],[54,22,44,20,"prefix"],[54,28,44,26],[54,40,44,38],[54,41,44,39],[54,44,44,42,"item"],[54,48,44,46],[54,49,44,47,"data"],[54,53,44,51],[54,54,44,52,"length"],[54,60,44,58],[55,6,45,4],[56,6,47,4],[56,12,47,10,"resource"],[56,20,47,18],[56,23,47,21,"item"],[56,27,47,25],[56,28,47,26,"resource"],[56,36,47,34],[57,6,48,4],[57,10,48,8],[57,14,48,8,"isValidContentItem"],[57,27,48,26],[57,28,48,26,"isValidContentItem"],[57,46,48,26],[57,48,48,27,"resource"],[57,56,48,35],[57,57,48,36],[57,59,48,38],[58,8,49,6,"safeSet"],[58,15,49,13],[58,16,49,14],[58,30,49,28],[58,32,49,30,"resource"],[58,40,49,38],[58,41,49,39,"uri"],[58,44,49,42],[58,45,49,43],[59,8,50,6,"safeSet"],[59,15,50,13],[59,16,50,14],[59,36,50,34],[59,38,50,36,"resource"],[59,46,50,44],[59,47,50,45,"mimeType"],[59,55,50,53],[59,56,50,54],[60,6,51,4],[61,4,52,2],[62,4,54,2],[62,11,54,9,"attributes"],[62,21,54,19],[63,2,55,0],[65,2,57,0],[66,0,58,0],[67,0,59,0],[68,0,60,0],[69,0,61,0],[70,2,62,0],[70,11,62,9,"extractToolResultAttributes"],[70,38,62,36,"extractToolResultAttributes"],[70,39,62,37,"result"],[70,45,62,43],[70,47,62,45],[71,4,63,2],[71,8,63,6],[71,9,63,7],[71,13,63,7,"isValidContentItem"],[71,26,63,25],[71,27,63,25,"isValidContentItem"],[71,45,63,25],[71,47,63,26,"result"],[71,53,63,32],[71,54,63,33],[71,56,63,35],[72,6,64,4],[72,13,64,11],[72,14,64,12],[72,15,64,13],[73,4,65,2],[74,4,67,2],[74,10,67,8,"attributes"],[74,20,67,18],[74,23,67,21,"Array"],[74,28,67,26],[74,29,67,27,"isArray"],[74,36,67,34],[74,37,67,35,"result"],[74,43,67,41],[74,44,67,42,"content"],[74,51,67,49],[74,52,67,50],[74,55,67,53,"buildAllContentItemAttributes"],[74,84,67,82],[74,85,67,83,"result"],[74,91,67,89],[74,92,67,90,"content"],[74,99,67,97],[74,100,67,98],[74,103,67,101],[74,104,67,102],[74,105,67,103],[75,4,69,2],[75,8,69,6],[75,15,69,13,"result"],[75,21,69,19],[75,22,69,20,"isError"],[75,29,69,27],[75,34,69,32],[75,43,69,41],[75,45,69,43],[76,6,70,4,"attributes"],[76,16,70,14],[76,17,70,15,"MCP_TOOL_RESULT_IS_ERROR_ATTRIBUTE"],[76,30,70,49],[76,31,70,49,"MCP_TOOL_RESULT_IS_ERROR_ATTRIBUTE"],[76,65,70,49],[76,66,70,50],[76,69,70,53,"result"],[76,75,70,59],[76,76,70,60,"isError"],[76,83,70,67],[77,4,71,2],[78,4,73,2],[78,11,73,9,"attributes"],[78,21,73,19],[79,2,74,0],[81,2,76,0],[82,0,77,0],[83,0,78,0],[84,0,79,0],[85,0,80,0],[86,2,81,0],[86,11,81,9,"extractPromptResultAttributes"],[86,40,81,38,"extractPromptResultAttributes"],[86,41,81,39,"result"],[86,47,81,45],[86,49,81,47],[87,4,82,2],[87,10,82,8,"attributes"],[87,20,82,18],[87,23,82,21],[87,24,82,22],[87,25,82,23],[88,4,83,2],[88,8,83,6],[88,9,83,7],[88,13,83,7,"isValidContentItem"],[88,26,83,25],[88,27,83,25,"isValidContentItem"],[88,45,83,25],[88,47,83,26,"result"],[88,53,83,32],[88,54,83,33],[88,56,83,35],[89,6,84,4],[89,13,84,11,"attributes"],[89,23,84,21],[90,4,85,2],[91,4,87,2],[91,8,87,6],[91,15,87,13,"result"],[91,21,87,19],[91,22,87,20,"description"],[91,33,87,31],[91,38,87,36],[91,46,87,44],[91,48,87,46],[92,6,88,4,"attributes"],[92,16,88,14],[92,17,88,15,"MCP_PROMPT_RESULT_DESCRIPTION_ATTRIBUTE"],[92,30,88,54],[92,31,88,54,"MCP_PROMPT_RESULT_DESCRIPTION_ATTRIBUTE"],[92,70,88,54],[92,71,88,55],[92,74,88,58,"result"],[92,80,88,64],[92,81,88,65,"description"],[92,92,88,76],[93,4,89,2],[94,4,91,2],[94,8,91,6,"Array"],[94,13,91,11],[94,14,91,12,"isArray"],[94,21,91,19],[94,22,91,20,"result"],[94,28,91,26],[94,29,91,27,"messages"],[94,37,91,35],[94,38,91,36],[94,40,91,38],[95,6,92,4,"attributes"],[95,16,92,14],[95,17,92,15,"MCP_PROMPT_RESULT_MESSAGE_COUNT_ATTRIBUTE"],[95,30,92,56],[95,31,92,56,"MCP_PROMPT_RESULT_MESSAGE_COUNT_ATTRIBUTE"],[95,72,92,56],[95,73,92,57],[95,76,92,60,"result"],[95,82,92,66],[95,83,92,67,"messages"],[95,91,92,75],[95,92,92,76,"length"],[95,98,92,82],[96,6,94,4],[96,12,94,10,"messages"],[96,20,94,18],[96,23,94,21,"result"],[96,29,94,27],[96,30,94,28,"messages"],[96,38,94,36],[97,6,95,4],[97,11,95,9],[97,17,95,15],[97,18,95,16,"i"],[97,19,95,17],[97,21,95,19,"message"],[97,28,95,26],[97,29,95,27],[97,33,95,31,"messages"],[97,41,95,39],[97,42,95,40,"entries"],[97,49,95,47],[97,50,95,48],[97,51,95,49],[97,53,95,51],[98,8,96,6],[98,12,96,10],[98,13,96,11],[98,17,96,11,"isValidContentItem"],[98,30,96,29],[98,31,96,29,"isValidContentItem"],[98,49,96,29],[98,51,96,30,"message"],[98,58,96,37],[98,59,96,38],[98,61,96,40],[99,10,97,8],[100,8,98,6],[101,8,100,6],[101,14,100,12,"prefix"],[101,20,100,18],[101,23,100,21,"messages"],[101,31,100,29],[101,32,100,30,"length"],[101,38,100,36],[101,43,100,41],[101,44,100,42],[101,47,100,45],[101,66,100,64],[101,69,100,67],[101,90,100,88,"i"],[101,91,100,89],[101,93,100,91],[102,8,102,6],[102,14,102,12,"safeSet"],[102,21,102,19],[102,24,102,22,"safeSet"],[102,25,102,23,"key"],[102,28,102,26],[102,30,102,28,"value"],[102,35,102,33],[102,40,102,38],[103,10,103,8],[103,14,103,12],[103,21,103,19,"value"],[103,26,103,24],[103,31,103,29],[103,39,103,37],[103,41,103,39],[104,12,104,10],[104,18,104,16,"attrName"],[104,26,104,24],[104,29,104,27,"messages"],[104,37,104,35],[104,38,104,36,"length"],[104,44,104,42],[104,49,104,47],[104,50,104,48],[104,53,104,51],[104,56,104,54,"prefix"],[104,62,104,60],[104,74,104,72,"key"],[104,77,104,75],[104,79,104,77],[104,82,104,80],[104,85,104,83,"prefix"],[104,91,104,89],[104,95,104,93,"key"],[104,98,104,96],[104,100,104,98],[105,12,105,10,"attributes"],[105,22,105,20],[105,23,105,21,"attrName"],[105,31,105,29],[105,32,105,30],[105,35,105,33,"value"],[105,40,105,38],[106,10,106,8],[107,8,107,6],[107,9,107,7],[108,8,109,6,"safeSet"],[108,15,109,13],[108,16,109,14],[108,22,109,20],[108,24,109,22,"message"],[108,31,109,29],[108,32,109,30,"role"],[108,36,109,34],[108,37,109,35],[109,8,111,6],[109,12,111,10],[109,16,111,10,"isValidContentItem"],[109,29,111,28],[109,30,111,28,"isValidContentItem"],[109,48,111,28],[109,50,111,29,"message"],[109,57,111,36],[109,58,111,37,"content"],[109,65,111,44],[109,66,111,45],[109,68,111,47],[110,10,112,8],[110,16,112,14,"content"],[110,23,112,21],[110,26,112,24,"message"],[110,33,112,31],[110,34,112,32,"content"],[110,41,112,39],[111,10,113,8],[111,14,113,12],[111,21,113,19,"content"],[111,28,113,26],[111,29,113,27,"text"],[111,33,113,31],[111,38,113,36],[111,46,113,44],[111,48,113,46],[112,12,114,10],[112,18,114,16,"attrName"],[112,26,114,24],[112,29,114,27,"messages"],[112,37,114,35],[112,38,114,36,"length"],[112,44,114,42],[112,49,114,47],[112,50,114,48],[112,53,114,51],[112,56,114,54,"prefix"],[112,62,114,60],[112,80,114,78],[112,83,114,81],[112,86,114,84,"prefix"],[112,92,114,90],[112,102,114,100],[113,12,115,10,"attributes"],[113,22,115,20],[113,23,115,21,"attrName"],[113,31,115,29],[113,32,115,30],[113,35,115,33,"content"],[113,42,115,40],[113,43,115,41,"text"],[113,47,115,45],[114,10,116,8],[115,8,117,6],[116,6,118,4],[117,4,119,2],[118,4,121,2],[118,11,121,9,"attributes"],[118,21,121,19],[119,2,122,0],[120,0,122,1],[120,3]],"functionMap":{"names":["<global>","buildAllContentItemAttributes","safeSet","extractToolResultAttributes","extractPromptResultAttributes"],"mappings":"AAA;ACe;oBCY;KDI;CDuB;AGO;CHY;AIO;sBFqB;OEK;CJe"},"hasCjsExports":false},"type":"js/module"}]}