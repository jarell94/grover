{"dependencies":[{"name":"@sentry/core","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":84,"index":84}}],"key":"/o+dASQcHF2bB25icdsM0E4TExc=","exportNames":["*"],"imports":1}},{"name":"../debug-build.js","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":2,"column":0,"index":85},"end":{"line":2,"column":48,"index":133}}],"key":"rfhktnzi6PvZxT1xtyHWbBktN/w=","exportNames":["*"],"imports":1}},{"name":"./startProfileForSpan.js","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":3,"column":0,"index":134},"end":{"line":3,"column":63,"index":197}}],"key":"TzywuMgogXTTTnhuIvWyUl40448=","exportNames":["*"],"imports":1}},{"name":"./utils.js","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":4,"column":0,"index":198},"end":{"line":4,"column":207,"index":405}}],"key":"NIaSEHO1E48gsZc7jH9Ex1xTHgE=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  Object.defineProperty(exports, \"browserProfilingIntegration\", {\n    enumerable: true,\n    get: function () {\n      return browserProfilingIntegration;\n    }\n  });\n  var _sentryCore = require(_dependencyMap[0], \"@sentry/core\");\n  var _debugBuildJs = require(_dependencyMap[1], \"../debug-build.js\");\n  var _startProfileForSpanJs = require(_dependencyMap[2], \"./startProfileForSpan.js\");\n  var _utilsJs = require(_dependencyMap[3], \"./utils.js\");\n  const INTEGRATION_NAME = 'BrowserProfiling';\n  const _browserProfilingIntegration = () => {\n    return {\n      name: INTEGRATION_NAME,\n      setup(client) {\n        const activeSpan = (0, _sentryCore.getActiveSpan)();\n        const rootSpan = activeSpan && (0, _sentryCore.getRootSpan)(activeSpan);\n        if (rootSpan && (0, _utilsJs.isAutomatedPageLoadSpan)(rootSpan)) {\n          if ((0, _utilsJs.shouldProfileSpan)(rootSpan)) {\n            (0, _startProfileForSpanJs.startProfileForSpan)(rootSpan);\n          }\n        }\n        client.on('spanStart', span => {\n          if (span === (0, _sentryCore.getRootSpan)(span) && (0, _utilsJs.shouldProfileSpan)(span)) {\n            (0, _startProfileForSpanJs.startProfileForSpan)(span);\n          }\n        });\n        client.on('beforeEnvelope', envelope => {\n          // if not profiles are in queue, there is nothing to add to the envelope.\n          if (!(0, _utilsJs.getActiveProfilesCount)()) {\n            return;\n          }\n          const profiledTransactionEvents = (0, _utilsJs.findProfiledTransactionsFromEnvelope)(envelope);\n          if (!profiledTransactionEvents.length) {\n            return;\n          }\n          const profilesToAddToEnvelope = [];\n          for (const profiledTransaction of profiledTransactionEvents) {\n            const context = profiledTransaction?.contexts;\n            const profile_id = context?.profile?.['profile_id'];\n            const start_timestamp = context?.profile?.['start_timestamp'];\n            if (typeof profile_id !== 'string') {\n              _debugBuildJs.DEBUG_BUILD && _sentryCore.debug.log('[Profiling] cannot find profile for a span without a profile context');\n              continue;\n            }\n            if (!profile_id) {\n              _debugBuildJs.DEBUG_BUILD && _sentryCore.debug.log('[Profiling] cannot find profile for a span without a profile context');\n              continue;\n            }\n\n            // Remove the profile from the span context before sending, relay will take care of the rest.\n            if (context?.profile) {\n              delete context.profile;\n            }\n            const profile = (0, _utilsJs.takeProfileFromGlobalCache)(profile_id);\n            if (!profile) {\n              _debugBuildJs.DEBUG_BUILD && _sentryCore.debug.log(`[Profiling] Could not retrieve profile for span: ${profile_id}`);\n              continue;\n            }\n            const profileEvent = (0, _utilsJs.createProfilingEvent)(profile_id, start_timestamp, profile, profiledTransaction);\n            if (profileEvent) {\n              profilesToAddToEnvelope.push(profileEvent);\n            }\n          }\n          (0, _utilsJs.addProfilesToEnvelope)(envelope, profilesToAddToEnvelope);\n        });\n      }\n    };\n  };\n  const browserProfilingIntegration = (0, _sentryCore.defineIntegration)(_browserProfilingIntegration);\n});","lineCount":77,"map":[[7,2,85,0,"Object"],[7,8,85,0],[7,9,85,0,"defineProperty"],[7,23,85,0],[7,24,85,0,"exports"],[7,31,85,0],[8,4,85,0,"enumerable"],[8,14,85,0],[9,4,85,0,"get"],[9,7,85,0],[9,18,85,0,"get"],[9,19,85,0],[10,6,85,0],[10,13,85,9,"browserProfilingIntegration"],[10,40,85,36],[11,4,85,36],[12,2,85,36],[13,2,1,0],[13,6,1,0,"_sentryCore"],[13,17,1,0],[13,20,1,0,"require"],[13,27,1,0],[13,28,1,0,"_dependencyMap"],[13,42,1,0],[14,2,2,0],[14,6,2,0,"_debugBuildJs"],[14,19,2,0],[14,22,2,0,"require"],[14,29,2,0],[14,30,2,0,"_dependencyMap"],[14,44,2,0],[15,2,3,0],[15,6,3,0,"_startProfileForSpanJs"],[15,28,3,0],[15,31,3,0,"require"],[15,38,3,0],[15,39,3,0,"_dependencyMap"],[15,53,3,0],[16,2,4,0],[16,6,4,0,"_utilsJs"],[16,14,4,0],[16,17,4,0,"require"],[16,24,4,0],[16,25,4,0,"_dependencyMap"],[16,39,4,0],[17,2,6,0],[17,8,6,6,"INTEGRATION_NAME"],[17,24,6,22],[17,27,6,25],[17,45,6,43],[18,2,8,0],[18,8,8,6,"_browserProfilingIntegration"],[18,36,8,34],[18,39,8,38,"_browserProfilingIntegration"],[18,40,8,38],[18,45,8,44],[19,4,9,2],[19,11,9,9],[20,6,10,4,"name"],[20,10,10,8],[20,12,10,10,"INTEGRATION_NAME"],[20,28,10,26],[21,6,11,4,"setup"],[21,11,11,9,"setup"],[21,12,11,10,"client"],[21,18,11,16],[21,20,11,18],[22,8,12,6],[22,14,12,12,"activeSpan"],[22,24,12,22],[22,27,12,25],[22,31,12,25,"getActiveSpan"],[22,42,12,38],[22,43,12,38,"getActiveSpan"],[22,56,12,38],[22,58,12,39],[22,59,12,40],[23,8,13,6],[23,14,13,12,"rootSpan"],[23,22,13,20],[23,25,13,23,"activeSpan"],[23,35,13,33],[23,39,13,37],[23,43,13,37,"getRootSpan"],[23,54,13,48],[23,55,13,48,"getRootSpan"],[23,66,13,48],[23,68,13,49,"activeSpan"],[23,78,13,59],[23,79,13,60],[24,8,15,6],[24,12,15,10,"rootSpan"],[24,20,15,18],[24,24,15,22],[24,28,15,22,"isAutomatedPageLoadSpan"],[24,36,15,45],[24,37,15,45,"isAutomatedPageLoadSpan"],[24,60,15,45],[24,62,15,46,"rootSpan"],[24,70,15,54],[24,71,15,55],[24,73,15,57],[25,10,16,8],[25,14,16,12],[25,18,16,12,"shouldProfileSpan"],[25,26,16,29],[25,27,16,29,"shouldProfileSpan"],[25,44,16,29],[25,46,16,30,"rootSpan"],[25,54,16,38],[25,55,16,39],[25,57,16,41],[26,12,17,10],[26,16,17,10,"startProfileForSpan"],[26,38,17,29],[26,39,17,29,"startProfileForSpan"],[26,58,17,29],[26,60,17,30,"rootSpan"],[26,68,17,38],[26,69,17,39],[27,10,18,8],[28,8,19,6],[29,8,21,6,"client"],[29,14,21,12],[29,15,21,13,"on"],[29,17,21,15],[29,18,21,16],[29,29,21,27],[29,31,21,30,"span"],[29,35,21,34],[29,39,21,39],[30,10,22,8],[30,14,22,12,"span"],[30,18,22,16],[30,23,22,21],[30,27,22,21,"getRootSpan"],[30,38,22,32],[30,39,22,32,"getRootSpan"],[30,50,22,32],[30,52,22,33,"span"],[30,56,22,37],[30,57,22,38],[30,61,22,42],[30,65,22,42,"shouldProfileSpan"],[30,73,22,59],[30,74,22,59,"shouldProfileSpan"],[30,91,22,59],[30,93,22,60,"span"],[30,97,22,64],[30,98,22,65],[30,100,22,67],[31,12,23,10],[31,16,23,10,"startProfileForSpan"],[31,38,23,29],[31,39,23,29,"startProfileForSpan"],[31,58,23,29],[31,60,23,30,"span"],[31,64,23,34],[31,65,23,35],[32,10,24,8],[33,8,25,6],[33,9,25,7],[33,10,25,8],[34,8,27,6,"client"],[34,14,27,12],[34,15,27,13,"on"],[34,17,27,15],[34,18,27,16],[34,34,27,32],[34,36,27,35,"envelope"],[34,44,27,43],[34,48,27,48],[35,10,28,8],[36,10,29,8],[36,14,29,12],[36,15,29,13],[36,19,29,13,"getActiveProfilesCount"],[36,27,29,35],[36,28,29,35,"getActiveProfilesCount"],[36,50,29,35],[36,52,29,36],[36,53,29,37],[36,55,29,39],[37,12,30,10],[38,10,31,8],[39,10,33,8],[39,16,33,14,"profiledTransactionEvents"],[39,41,33,39],[39,44,33,42],[39,48,33,42,"findProfiledTransactionsFromEnvelope"],[39,56,33,78],[39,57,33,78,"findProfiledTransactionsFromEnvelope"],[39,93,33,78],[39,95,33,79,"envelope"],[39,103,33,87],[39,104,33,88],[40,10,34,8],[40,14,34,12],[40,15,34,13,"profiledTransactionEvents"],[40,40,34,38],[40,41,34,39,"length"],[40,47,34,45],[40,49,34,47],[41,12,35,10],[42,10,36,8],[43,10,38,8],[43,16,38,14,"profilesToAddToEnvelope"],[43,39,38,37],[43,42,38,40],[43,44,38,42],[44,10,40,8],[44,15,40,13],[44,21,40,19,"profiledTransaction"],[44,40,40,38],[44,44,40,42,"profiledTransactionEvents"],[44,69,40,67],[44,71,40,69],[45,12,41,10],[45,18,41,16,"context"],[45,25,41,23],[45,28,41,26,"profiledTransaction"],[45,47,41,45],[45,49,41,47,"contexts"],[45,57,41,55],[46,12,42,10],[46,18,42,16,"profile_id"],[46,28,42,26],[46,31,42,29,"context"],[46,38,42,36],[46,40,42,38,"profile"],[46,47,42,45],[46,50,42,48],[46,62,42,60],[46,63,42,61],[47,12,43,10],[47,18,43,16,"start_timestamp"],[47,33,43,31],[47,36,43,34,"context"],[47,43,43,41],[47,45,43,43,"profile"],[47,52,43,50],[47,55,43,53],[47,72,43,70],[47,73,43,71],[48,12,45,10],[48,16,45,14],[48,23,45,21,"profile_id"],[48,33,45,31],[48,38,45,36],[48,46,45,44],[48,48,45,46],[49,14,46,12,"DEBUG_BUILD"],[49,27,46,23],[49,28,46,23,"DEBUG_BUILD"],[49,39,46,23],[49,43,46,27,"debug"],[49,54,46,32],[49,55,46,32,"debug"],[49,60,46,32],[49,61,46,33,"log"],[49,64,46,36],[49,65,46,37],[49,135,46,107],[49,136,46,108],[50,14,47,12],[51,12,48,10],[52,12,50,10],[52,16,50,14],[52,17,50,15,"profile_id"],[52,27,50,25],[52,29,50,27],[53,14,51,12,"DEBUG_BUILD"],[53,27,51,23],[53,28,51,23,"DEBUG_BUILD"],[53,39,51,23],[53,43,51,27,"debug"],[53,54,51,32],[53,55,51,32,"debug"],[53,60,51,32],[53,61,51,33,"log"],[53,64,51,36],[53,65,51,37],[53,135,51,107],[53,136,51,108],[54,14,52,12],[55,12,53,10],[57,12,55,10],[58,12,56,10],[58,16,56,14,"context"],[58,23,56,21],[58,25,56,23,"profile"],[58,32,56,30],[58,34,56,32],[59,14,57,12],[59,21,57,19,"context"],[59,28,57,26],[59,29,57,27,"profile"],[59,36,57,34],[60,12,58,10],[61,12,60,10],[61,18,60,16,"profile"],[61,25,60,23],[61,28,60,26],[61,32,60,26,"takeProfileFromGlobalCache"],[61,40,60,52],[61,41,60,52,"takeProfileFromGlobalCache"],[61,67,60,52],[61,69,60,53,"profile_id"],[61,79,60,63],[61,80,60,64],[62,12,61,10],[62,16,61,14],[62,17,61,15,"profile"],[62,24,61,22],[62,26,61,24],[63,14,62,12,"DEBUG_BUILD"],[63,27,62,23],[63,28,62,23,"DEBUG_BUILD"],[63,39,62,23],[63,43,62,27,"debug"],[63,54,62,32],[63,55,62,32,"debug"],[63,60,62,32],[63,61,62,33,"log"],[63,64,62,36],[63,65,62,37],[63,117,62,89,"profile_id"],[63,127,62,99],[63,129,62,101],[63,130,62,102],[64,14,63,12],[65,12,64,10],[66,12,66,10],[66,18,66,16,"profileEvent"],[66,30,66,28],[66,33,66,31],[66,37,66,31,"createProfilingEvent"],[66,45,66,51],[66,46,66,51,"createProfilingEvent"],[66,66,66,51],[66,68,67,12,"profile_id"],[66,78,67,22],[66,80,68,12,"start_timestamp"],[66,95,68,27],[66,97,69,12,"profile"],[66,104,69,19],[66,106,70,12,"profiledTransaction"],[66,125,71,10],[66,126,71,11],[67,12,72,10],[67,16,72,14,"profileEvent"],[67,28,72,26],[67,30,72,28],[68,14,73,12,"profilesToAddToEnvelope"],[68,37,73,35],[68,38,73,36,"push"],[68,42,73,40],[68,43,73,41,"profileEvent"],[68,55,73,53],[68,56,73,54],[69,12,74,10],[70,10,75,8],[71,10,77,8],[71,14,77,8,"addProfilesToEnvelope"],[71,22,77,29],[71,23,77,29,"addProfilesToEnvelope"],[71,44,77,29],[71,46,77,30,"envelope"],[71,54,77,38],[71,56,77,41,"profilesToAddToEnvelope"],[71,79,77,64],[71,80,77,65],[72,8,78,6],[72,9,78,7],[72,10,78,8],[73,6,79,4],[74,4,80,2],[74,5,80,3],[75,2,81,0],[75,3,81,2],[76,2,83,0],[76,8,83,6,"browserProfilingIntegration"],[76,35,83,33],[76,38,83,36],[76,42,83,36,"defineIntegration"],[76,53,83,53],[76,54,83,53,"defineIntegration"],[76,71,83,53],[76,73,83,54,"_browserProfilingIntegration"],[76,101,83,82],[76,102,83,83],[77,0,83,84],[77,3]],"functionMap":{"names":["<global>","_browserProfilingIntegration","setup","client.on$argument_1"],"mappings":"AAA;sCCO;ICG;6BCU;ODI;kCCE;ODmD;KDC;CDE"},"hasCjsExports":false},"type":"js/module"}]}