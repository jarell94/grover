{"dependencies":[{"name":"../debug-build.js","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":48,"index":48}}],"key":"rfhktnzi6PvZxT1xtyHWbBktN/w=","exportNames":["*"],"imports":1}},{"name":"../utils/debug-logger.js","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":2,"column":0,"index":49},"end":{"line":2,"column":49,"index":98}}],"key":"bptn1GZFOkS4BOMU8jhPqqHmvAc=","exportNames":["*"],"imports":1}},{"name":"../utils/envelope.js","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":3,"column":0,"index":99},"end":{"line":3,"column":126,"index":225}}],"key":"yiniLg9hHeIHPDkrzeivR1oDz5o=","exportNames":["*"],"imports":1}},{"name":"../utils/promisebuffer.js","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":4,"column":0,"index":226},"end":{"line":4,"column":88,"index":314}}],"key":"g1PLmpXkRqx5eG1RICG6UFDmM1s=","exportNames":["*"],"imports":1}},{"name":"../utils/ratelimit.js","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":5,"column":0,"index":315},"end":{"line":5,"column":72,"index":387}}],"key":"eBQc6ZZkzOf7Vfwryf2nt/LMy9M=","exportNames":["*"],"imports":1}},{"name":"../utils/syncpromise.js","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":6,"column":0,"index":388},"end":{"line":6,"column":62,"index":450}}],"key":"A7iBz19/phyB0RwS5dVtkvOlBSI=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  Object.defineProperty(exports, \"DEFAULT_TRANSPORT_BUFFER_SIZE\", {\n    enumerable: true,\n    get: function () {\n      return DEFAULT_TRANSPORT_BUFFER_SIZE;\n    }\n  });\n  Object.defineProperty(exports, \"createTransport\", {\n    enumerable: true,\n    get: function () {\n      return createTransport;\n    }\n  });\n  var _debugBuildJs = require(_dependencyMap[0], \"../debug-build.js\");\n  var _utilsDebugLoggerJs = require(_dependencyMap[1], \"../utils/debug-logger.js\");\n  var _utilsEnvelopeJs = require(_dependencyMap[2], \"../utils/envelope.js\");\n  var _utilsPromisebufferJs = require(_dependencyMap[3], \"../utils/promisebuffer.js\");\n  var _utilsRatelimitJs = require(_dependencyMap[4], \"../utils/ratelimit.js\");\n  var _utilsSyncpromiseJs = require(_dependencyMap[5], \"../utils/syncpromise.js\");\n  const DEFAULT_TRANSPORT_BUFFER_SIZE = 64;\n\n  /**\n   * Creates an instance of a Sentry `Transport`\n   *\n   * @param options\n   * @param makeRequest\n   */\n  function createTransport(options, makeRequest, buffer = (0, _utilsPromisebufferJs.makePromiseBuffer)(options.bufferSize || DEFAULT_TRANSPORT_BUFFER_SIZE)) {\n    let rateLimits = {};\n    const flush = timeout => buffer.drain(timeout);\n    function send(envelope) {\n      const filteredEnvelopeItems = [];\n\n      // Drop rate limited items from envelope\n      (0, _utilsEnvelopeJs.forEachEnvelopeItem)(envelope, (item, type) => {\n        const dataCategory = (0, _utilsEnvelopeJs.envelopeItemTypeToDataCategory)(type);\n        if ((0, _utilsRatelimitJs.isRateLimited)(rateLimits, dataCategory)) {\n          options.recordDroppedEvent('ratelimit_backoff', dataCategory);\n        } else {\n          filteredEnvelopeItems.push(item);\n        }\n      });\n\n      // Skip sending if envelope is empty after filtering out rate limited events\n      if (filteredEnvelopeItems.length === 0) {\n        return (0, _utilsSyncpromiseJs.resolvedSyncPromise)({});\n      }\n      const filteredEnvelope = (0, _utilsEnvelopeJs.createEnvelope)(envelope[0], filteredEnvelopeItems);\n\n      // Creates client report for each item in an envelope\n      const recordEnvelopeLoss = reason => {\n        (0, _utilsEnvelopeJs.forEachEnvelopeItem)(filteredEnvelope, (item, type) => {\n          options.recordDroppedEvent(reason, (0, _utilsEnvelopeJs.envelopeItemTypeToDataCategory)(type));\n        });\n      };\n      const requestTask = () => makeRequest({\n        body: (0, _utilsEnvelopeJs.serializeEnvelope)(filteredEnvelope)\n      }).then(response => {\n        // We don't want to throw on NOK responses, but we want to at least log them\n        if (response.statusCode !== undefined && (response.statusCode < 200 || response.statusCode >= 300)) {\n          _debugBuildJs.DEBUG_BUILD && _utilsDebugLoggerJs.debug.warn(`Sentry responded with status code ${response.statusCode} to sent event.`);\n        }\n        rateLimits = (0, _utilsRatelimitJs.updateRateLimits)(rateLimits, response);\n        return response;\n      }, error => {\n        recordEnvelopeLoss('network_error');\n        _debugBuildJs.DEBUG_BUILD && _utilsDebugLoggerJs.debug.error('Encountered error running transport request:', error);\n        throw error;\n      });\n      return buffer.add(requestTask).then(result => result, error => {\n        if (error === _utilsPromisebufferJs.SENTRY_BUFFER_FULL_ERROR) {\n          _debugBuildJs.DEBUG_BUILD && _utilsDebugLoggerJs.debug.error('Skipped sending event because buffer is full.');\n          recordEnvelopeLoss('queue_overflow');\n          return (0, _utilsSyncpromiseJs.resolvedSyncPromise)({});\n        } else {\n          throw error;\n        }\n      });\n    }\n    return {\n      send,\n      flush\n    };\n  }\n});","lineCount":90,"map":[[7,2,91,0,"Object"],[7,8,91,0],[7,9,91,0,"defineProperty"],[7,23,91,0],[7,24,91,0,"exports"],[7,31,91,0],[8,4,91,0,"enumerable"],[8,14,91,0],[9,4,91,0,"get"],[9,7,91,0],[9,18,91,0,"get"],[9,19,91,0],[10,6,91,0],[10,13,91,9,"DEFAULT_TRANSPORT_BUFFER_SIZE"],[10,42,91,38],[11,4,91,38],[12,2,91,38],[13,2,91,0,"Object"],[13,8,91,0],[13,9,91,0,"defineProperty"],[13,23,91,0],[13,24,91,0,"exports"],[13,31,91,0],[14,4,91,0,"enumerable"],[14,14,91,0],[15,4,91,0,"get"],[15,7,91,0],[15,18,91,0,"get"],[15,19,91,0],[16,6,91,0],[16,13,91,40,"createTransport"],[16,28,91,55],[17,4,91,55],[18,2,91,55],[19,2,1,0],[19,6,1,0,"_debugBuildJs"],[19,19,1,0],[19,22,1,0,"require"],[19,29,1,0],[19,30,1,0,"_dependencyMap"],[19,44,1,0],[20,2,2,0],[20,6,2,0,"_utilsDebugLoggerJs"],[20,25,2,0],[20,28,2,0,"require"],[20,35,2,0],[20,36,2,0,"_dependencyMap"],[20,50,2,0],[21,2,3,0],[21,6,3,0,"_utilsEnvelopeJs"],[21,22,3,0],[21,25,3,0,"require"],[21,32,3,0],[21,33,3,0,"_dependencyMap"],[21,47,3,0],[22,2,4,0],[22,6,4,0,"_utilsPromisebufferJs"],[22,27,4,0],[22,30,4,0,"require"],[22,37,4,0],[22,38,4,0,"_dependencyMap"],[22,52,4,0],[23,2,5,0],[23,6,5,0,"_utilsRatelimitJs"],[23,23,5,0],[23,26,5,0,"require"],[23,33,5,0],[23,34,5,0,"_dependencyMap"],[23,48,5,0],[24,2,6,0],[24,6,6,0,"_utilsSyncpromiseJs"],[24,25,6,0],[24,28,6,0,"require"],[24,35,6,0],[24,36,6,0,"_dependencyMap"],[24,50,6,0],[25,2,8,0],[25,8,8,6,"DEFAULT_TRANSPORT_BUFFER_SIZE"],[25,37,8,35],[25,40,8,38],[25,42,8,40],[27,2,10,0],[28,0,11,0],[29,0,12,0],[30,0,13,0],[31,0,14,0],[32,0,15,0],[33,2,16,0],[33,11,16,9,"createTransport"],[33,26,16,24,"createTransport"],[33,27,17,2,"options"],[33,34,17,9],[33,36,18,2,"makeRequest"],[33,47,18,13],[33,49,19,2,"buffer"],[33,55,19,8],[33,58,19,11],[33,62,19,11,"makePromiseBuffer"],[33,83,19,28],[33,84,19,28,"makePromiseBuffer"],[33,101,19,28],[33,103,20,4,"options"],[33,110,20,11],[33,111,20,12,"bufferSize"],[33,121,20,22],[33,125,20,26,"DEFAULT_TRANSPORT_BUFFER_SIZE"],[33,154,21,2],[33,155,21,3],[33,157,22,2],[34,4,23,2],[34,8,23,6,"rateLimits"],[34,18,23,16],[34,21,23,19],[34,22,23,20],[34,23,23,21],[35,4,24,2],[35,10,24,8,"flush"],[35,15,24,13],[35,18,24,17,"timeout"],[35,25,24,24],[35,29,24,29,"buffer"],[35,35,24,35],[35,36,24,36,"drain"],[35,41,24,41],[35,42,24,42,"timeout"],[35,49,24,49],[35,50,24,50],[36,4,26,2],[36,13,26,11,"send"],[36,17,26,15,"send"],[36,18,26,16,"envelope"],[36,26,26,24],[36,28,26,26],[37,6,27,4],[37,12,27,10,"filteredEnvelopeItems"],[37,33,27,31],[37,36,27,34],[37,38,27,36],[39,6,29,4],[40,6,30,4],[40,10,30,4,"forEachEnvelopeItem"],[40,26,30,23],[40,27,30,23,"forEachEnvelopeItem"],[40,46,30,23],[40,48,30,24,"envelope"],[40,56,30,32],[40,58,30,34],[40,59,30,35,"item"],[40,63,30,39],[40,65,30,41,"type"],[40,69,30,45],[40,74,30,50],[41,8,31,6],[41,14,31,12,"dataCategory"],[41,26,31,24],[41,29,31,27],[41,33,31,27,"envelopeItemTypeToDataCategory"],[41,49,31,57],[41,50,31,57,"envelopeItemTypeToDataCategory"],[41,80,31,57],[41,82,31,58,"type"],[41,86,31,62],[41,87,31,63],[42,8,32,6],[42,12,32,10],[42,16,32,10,"isRateLimited"],[42,33,32,23],[42,34,32,23,"isRateLimited"],[42,47,32,23],[42,49,32,24,"rateLimits"],[42,59,32,34],[42,61,32,36,"dataCategory"],[42,73,32,48],[42,74,32,49],[42,76,32,51],[43,10,33,8,"options"],[43,17,33,15],[43,18,33,16,"recordDroppedEvent"],[43,36,33,34],[43,37,33,35],[43,56,33,54],[43,58,33,56,"dataCategory"],[43,70,33,68],[43,71,33,69],[44,8,34,6],[44,9,34,7],[44,15,34,13],[45,10,35,8,"filteredEnvelopeItems"],[45,31,35,29],[45,32,35,30,"push"],[45,36,35,34],[45,37,35,35,"item"],[45,41,35,39],[45,42,35,40],[46,8,36,6],[47,6,37,4],[47,7,37,5],[47,8,37,6],[49,6,39,4],[50,6,40,4],[50,10,40,8,"filteredEnvelopeItems"],[50,31,40,29],[50,32,40,30,"length"],[50,38,40,36],[50,43,40,41],[50,44,40,42],[50,46,40,44],[51,8,41,6],[51,15,41,13],[51,19,41,13,"resolvedSyncPromise"],[51,38,41,32],[51,39,41,32,"resolvedSyncPromise"],[51,58,41,32],[51,60,41,33],[51,61,41,34],[51,62,41,35],[51,63,41,36],[52,6,42,4],[53,6,44,4],[53,12,44,10,"filteredEnvelope"],[53,28,44,26],[53,31,44,29],[53,35,44,29,"createEnvelope"],[53,51,44,43],[53,52,44,43,"createEnvelope"],[53,66,44,43],[53,68,44,44,"envelope"],[53,76,44,52],[53,77,44,53],[53,78,44,54],[53,79,44,55],[53,81,44,57,"filteredEnvelopeItems"],[53,102,44,79],[53,103,44,80],[55,6,46,4],[56,6,47,4],[56,12,47,10,"recordEnvelopeLoss"],[56,30,47,28],[56,33,47,32,"reason"],[56,39,47,38],[56,43,47,43],[57,8,48,6],[57,12,48,6,"forEachEnvelopeItem"],[57,28,48,25],[57,29,48,25,"forEachEnvelopeItem"],[57,48,48,25],[57,50,48,26,"filteredEnvelope"],[57,66,48,42],[57,68,48,44],[57,69,48,45,"item"],[57,73,48,49],[57,75,48,51,"type"],[57,79,48,55],[57,84,48,60],[58,10,49,8,"options"],[58,17,49,15],[58,18,49,16,"recordDroppedEvent"],[58,36,49,34],[58,37,49,35,"reason"],[58,43,49,41],[58,45,49,43],[58,49,49,43,"envelopeItemTypeToDataCategory"],[58,65,49,73],[58,66,49,73,"envelopeItemTypeToDataCategory"],[58,96,49,73],[58,98,49,74,"type"],[58,102,49,78],[58,103,49,79],[58,104,49,80],[59,8,50,6],[59,9,50,7],[59,10,50,8],[60,6,51,4],[60,7,51,5],[61,6,53,4],[61,12,53,10,"requestTask"],[61,23,53,21],[61,26,53,24,"requestTask"],[61,27,53,24],[61,32,54,6,"makeRequest"],[61,43,54,17],[61,44,54,18],[62,8,54,20,"body"],[62,12,54,24],[62,14,54,26],[62,18,54,26,"serializeEnvelope"],[62,34,54,43],[62,35,54,43,"serializeEnvelope"],[62,52,54,43],[62,54,54,44,"filteredEnvelope"],[62,70,54,60],[63,6,54,62],[63,7,54,63],[63,8,54,64],[63,9,54,65,"then"],[63,13,54,69],[63,14,55,8,"response"],[63,22,55,16],[63,26,55,20],[64,8,56,10],[65,8,57,10],[65,12,57,14,"response"],[65,20,57,22],[65,21,57,23,"statusCode"],[65,31,57,33],[65,36,57,38,"undefined"],[65,45,57,47],[65,50,57,52,"response"],[65,58,57,60],[65,59,57,61,"statusCode"],[65,69,57,71],[65,72,57,74],[65,75,57,77],[65,79,57,81,"response"],[65,87,57,89],[65,88,57,90,"statusCode"],[65,98,57,100],[65,102,57,104],[65,105,57,107],[65,106,57,108],[65,108,57,110],[66,10,58,12,"DEBUG_BUILD"],[66,23,58,23],[66,24,58,23,"DEBUG_BUILD"],[66,35,58,23],[66,39,58,27,"debug"],[66,58,58,32],[66,59,58,32,"debug"],[66,64,58,32],[66,65,58,33,"warn"],[66,69,58,37],[66,70,58,38],[66,107,58,75,"response"],[66,115,58,83],[66,116,58,84,"statusCode"],[66,126,58,94],[66,143,58,111],[66,144,58,112],[67,8,59,10],[68,8,61,10,"rateLimits"],[68,18,61,20],[68,21,61,23],[68,25,61,23,"updateRateLimits"],[68,42,61,39],[68,43,61,39,"updateRateLimits"],[68,59,61,39],[68,61,61,40,"rateLimits"],[68,71,61,50],[68,73,61,52,"response"],[68,81,61,60],[68,82,61,61],[69,8,62,10],[69,15,62,17,"response"],[69,23,62,25],[70,6,63,8],[70,7,63,9],[70,9,64,8,"error"],[70,14,64,13],[70,18,64,17],[71,8,65,10,"recordEnvelopeLoss"],[71,26,65,28],[71,27,65,29],[71,42,65,44],[71,43,65,45],[72,8,66,10,"DEBUG_BUILD"],[72,21,66,21],[72,22,66,21,"DEBUG_BUILD"],[72,33,66,21],[72,37,66,25,"debug"],[72,56,66,30],[72,57,66,30,"debug"],[72,62,66,30],[72,63,66,31,"error"],[72,68,66,36],[72,69,66,37],[72,115,66,83],[72,117,66,85,"error"],[72,122,66,90],[72,123,66,91],[73,8,67,10],[73,14,67,16,"error"],[73,19,67,21],[74,6,68,8],[74,7,69,6],[74,8,69,7],[75,6,71,4],[75,13,71,11,"buffer"],[75,19,71,17],[75,20,71,18,"add"],[75,23,71,21],[75,24,71,22,"requestTask"],[75,35,71,33],[75,36,71,34],[75,37,71,35,"then"],[75,41,71,39],[75,42,72,6,"result"],[75,48,72,12],[75,52,72,16,"result"],[75,58,72,22],[75,60,73,6,"error"],[75,65,73,11],[75,69,73,15],[76,8,74,8],[76,12,74,12,"error"],[76,17,74,17],[76,22,74,22,"SENTRY_BUFFER_FULL_ERROR"],[76,43,74,46],[76,44,74,46,"SENTRY_BUFFER_FULL_ERROR"],[76,68,74,46],[76,70,74,48],[77,10,75,10,"DEBUG_BUILD"],[77,23,75,21],[77,24,75,21,"DEBUG_BUILD"],[77,35,75,21],[77,39,75,25,"debug"],[77,58,75,30],[77,59,75,30,"debug"],[77,64,75,30],[77,65,75,31,"error"],[77,70,75,36],[77,71,75,37],[77,118,75,84],[77,119,75,85],[78,10,76,10,"recordEnvelopeLoss"],[78,28,76,28],[78,29,76,29],[78,45,76,45],[78,46,76,46],[79,10,77,10],[79,17,77,17],[79,21,77,17,"resolvedSyncPromise"],[79,40,77,36],[79,41,77,36,"resolvedSyncPromise"],[79,60,77,36],[79,62,77,37],[79,63,77,38],[79,64,77,39],[79,65,77,40],[80,8,78,8],[80,9,78,9],[80,15,78,15],[81,10,79,10],[81,16,79,16,"error"],[81,21,79,21],[82,8,80,8],[83,6,81,6],[83,7,82,4],[83,8,82,5],[84,4,83,2],[85,4,85,2],[85,11,85,9],[86,6,86,4,"send"],[86,10,86,8],[87,6,87,4,"flush"],[88,4,88,2],[88,5,88,3],[89,2,89,0],[90,0,89,1],[90,3]],"functionMap":{"names":["<global>","createTransport","flush","send","forEachEnvelopeItem$argument_1","recordEnvelopeLoss","requestTask","makeRequest.then$argument_0","makeRequest.then$argument_1","buffer.add.then$argument_0","buffer.add.then$argument_1"],"mappings":"AAA;ACe;gBCQ,kCD;EEE;kCCI;KDO;+BEU;4CDC;OCE;KFC;wBGE;QCE;SDQ;QEC;SFI;OHC;MMG,gBN;MOC;OPQ;GFE;CDM"},"hasCjsExports":false},"type":"js/module"}]}