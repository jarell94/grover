{"dependencies":[{"name":"../api.js","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":66,"index":66}}],"key":"cPKsELqWARxElqFlbsOK3W8pAh4=","exportNames":["*"],"imports":1}},{"name":"../utils/dsn.js","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":2,"column":0,"index":67},"end":{"line":2,"column":48,"index":115}}],"key":"N9KAuIoocXj/7+4SJW53+/eZu00=","exportNames":["*"],"imports":1}},{"name":"../utils/envelope.js","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":3,"column":0,"index":116},"end":{"line":3,"column":75,"index":191}}],"key":"yiniLg9hHeIHPDkrzeivR1oDz5o=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  Object.defineProperty(exports, \"eventFromEnvelope\", {\n    enumerable: true,\n    get: function () {\n      return eventFromEnvelope;\n    }\n  });\n  Object.defineProperty(exports, \"makeMultiplexedTransport\", {\n    enumerable: true,\n    get: function () {\n      return makeMultiplexedTransport;\n    }\n  });\n  var _apiJs = require(_dependencyMap[0], \"../api.js\");\n  var _utilsDsnJs = require(_dependencyMap[1], \"../utils/dsn.js\");\n  var _utilsEnvelopeJs = require(_dependencyMap[2], \"../utils/envelope.js\");\n  /**\n   * Gets an event from an envelope.\n   *\n   * This is only exported for use in the tests\n   */\n  function eventFromEnvelope(env, types) {\n    let event;\n    (0, _utilsEnvelopeJs.forEachEnvelopeItem)(env, (item, type) => {\n      if (types.includes(type)) {\n        event = Array.isArray(item) ? item[1] : undefined;\n      }\n      // bail out if we found an event\n      return !!event;\n    });\n    return event;\n  }\n\n  /**\n   * Creates a transport that overrides the release on all events.\n   */\n  function makeOverrideReleaseTransport(createTransport, release) {\n    return options => {\n      const transport = createTransport(options);\n      return {\n        ...transport,\n        send: async envelope => {\n          const event = eventFromEnvelope(envelope, ['event', 'transaction', 'profile', 'replay_event']);\n          if (event) {\n            event.release = release;\n          }\n          return transport.send(envelope);\n        }\n      };\n    };\n  }\n\n  /** Overrides the DSN in the envelope header  */\n  function overrideDsn(envelope, dsn) {\n    return (0, _utilsEnvelopeJs.createEnvelope)(dsn ? {\n      ...envelope[0],\n      dsn\n    } : envelope[0], envelope[1]);\n  }\n\n  /**\n   * Creates a transport that can send events to different DSNs depending on the envelope contents.\n   */\n  function makeMultiplexedTransport(createTransport, matcher) {\n    return options => {\n      const fallbackTransport = createTransport(options);\n      const otherTransports = new Map();\n      function getTransport(dsn, release) {\n        // We create a transport for every unique dsn/release combination as there may be code from multiple releases in\n        // use at the same time\n        const key = release ? `${dsn}:${release}` : dsn;\n        let transport = otherTransports.get(key);\n        if (!transport) {\n          const validatedDsn = (0, _utilsDsnJs.dsnFromString)(dsn);\n          if (!validatedDsn) {\n            return undefined;\n          }\n          const url = (0, _apiJs.getEnvelopeEndpointWithUrlEncodedAuth)(validatedDsn, options.tunnel);\n          transport = release ? makeOverrideReleaseTransport(createTransport, release)({\n            ...options,\n            url\n          }) : createTransport({\n            ...options,\n            url\n          });\n          otherTransports.set(key, transport);\n        }\n        return [dsn, transport];\n      }\n      async function send(envelope) {\n        function getEvent(types) {\n          const eventTypes = types?.length ? types : ['event'];\n          return eventFromEnvelope(envelope, eventTypes);\n        }\n        const transports = matcher({\n          envelope,\n          getEvent\n        }).map(result => {\n          if (typeof result === 'string') {\n            return getTransport(result, undefined);\n          } else {\n            return getTransport(result.dsn, result.release);\n          }\n        }).filter(t => !!t);\n\n        // If we have no transports to send to, use the fallback transport\n        // Don't override the DSN in the header for the fallback transport. '' is falsy\n        const transportsWithFallback = transports.length ? transports : [['', fallbackTransport]];\n        const results = await Promise.all(transportsWithFallback.map(([dsn, transport]) => transport.send(overrideDsn(envelope, dsn))));\n        return results[0];\n      }\n      async function flush(timeout) {\n        const allTransports = [...otherTransports.values(), fallbackTransport];\n        const results = await Promise.all(allTransports.map(transport => transport.flush(timeout)));\n        return results.every(r => r);\n      }\n      return {\n        send,\n        flush\n      };\n    };\n  }\n});","lineCount":128,"map":[[7,2,136,0,"Object"],[7,8,136,0],[7,9,136,0,"defineProperty"],[7,23,136,0],[7,24,136,0,"exports"],[7,31,136,0],[8,4,136,0,"enumerable"],[8,14,136,0],[9,4,136,0,"get"],[9,7,136,0],[9,18,136,0,"get"],[9,19,136,0],[10,6,136,0],[10,13,136,9,"eventFromEnvelope"],[10,30,136,26],[11,4,136,26],[12,2,136,26],[13,2,136,0,"Object"],[13,8,136,0],[13,9,136,0,"defineProperty"],[13,23,136,0],[13,24,136,0,"exports"],[13,31,136,0],[14,4,136,0,"enumerable"],[14,14,136,0],[15,4,136,0,"get"],[15,7,136,0],[15,18,136,0,"get"],[15,19,136,0],[16,6,136,0],[16,13,136,28,"makeMultiplexedTransport"],[16,37,136,52],[17,4,136,52],[18,2,136,52],[19,2,1,0],[19,6,1,0,"_apiJs"],[19,12,1,0],[19,15,1,0,"require"],[19,22,1,0],[19,23,1,0,"_dependencyMap"],[19,37,1,0],[20,2,2,0],[20,6,2,0,"_utilsDsnJs"],[20,17,2,0],[20,20,2,0,"require"],[20,27,2,0],[20,28,2,0,"_dependencyMap"],[20,42,2,0],[21,2,3,0],[21,6,3,0,"_utilsEnvelopeJs"],[21,22,3,0],[21,25,3,0,"require"],[21,32,3,0],[21,33,3,0,"_dependencyMap"],[21,47,3,0],[22,2,5,0],[23,0,6,0],[24,0,7,0],[25,0,8,0],[26,0,9,0],[27,2,10,0],[27,11,10,9,"eventFromEnvelope"],[27,28,10,26,"eventFromEnvelope"],[27,29,10,27,"env"],[27,32,10,30],[27,34,10,32,"types"],[27,39,10,37],[27,41,10,39],[28,4,11,2],[28,8,11,6,"event"],[28,13,11,11],[29,4,13,2],[29,8,13,2,"forEachEnvelopeItem"],[29,24,13,21],[29,25,13,21,"forEachEnvelopeItem"],[29,44,13,21],[29,46,13,22,"env"],[29,49,13,25],[29,51,13,27],[29,52,13,28,"item"],[29,56,13,32],[29,58,13,34,"type"],[29,62,13,38],[29,67,13,43],[30,6,14,4],[30,10,14,8,"types"],[30,15,14,13],[30,16,14,14,"includes"],[30,24,14,22],[30,25,14,23,"type"],[30,29,14,27],[30,30,14,28],[30,32,14,30],[31,8,15,6,"event"],[31,13,15,11],[31,16,15,14,"Array"],[31,21,15,19],[31,22,15,20,"isArray"],[31,29,15,27],[31,30,15,28,"item"],[31,34,15,32],[31,35,15,33],[31,38,15,37,"item"],[31,42,15,41],[31,43,15,44],[31,44,15,45],[31,45,15,46],[31,48,15,49,"undefined"],[31,57,15,58],[32,6,16,4],[33,6,17,4],[34,6,18,4],[34,13,18,11],[34,14,18,12],[34,15,18,13,"event"],[34,20,18,18],[35,4,19,2],[35,5,19,3],[35,6,19,4],[36,4,21,2],[36,11,21,9,"event"],[36,16,21,14],[37,2,22,0],[39,2,24,0],[40,0,25,0],[41,0,26,0],[42,2,27,0],[42,11,27,9,"makeOverrideReleaseTransport"],[42,39,27,37,"makeOverrideReleaseTransport"],[42,40,28,2,"createTransport"],[42,55,28,17],[42,57,29,2,"release"],[42,64,29,9],[42,66,30,2],[43,4,31,2],[43,11,31,9,"options"],[43,18,31,16],[43,22,31,20],[44,6,32,4],[44,12,32,10,"transport"],[44,21,32,19],[44,24,32,22,"createTransport"],[44,39,32,37],[44,40,32,38,"options"],[44,47,32,45],[44,48,32,46],[45,6,34,4],[45,13,34,11],[46,8,35,6],[46,11,35,9,"transport"],[46,20,35,18],[47,8,36,6,"send"],[47,12,36,10],[47,14,36,12],[47,20,36,19,"envelope"],[47,28,36,27],[47,32,36,32],[48,10,37,8],[48,16,37,14,"event"],[48,21,37,19],[48,24,37,22,"eventFromEnvelope"],[48,41,37,39],[48,42,37,40,"envelope"],[48,50,37,48],[48,52,37,50],[48,53,37,51],[48,60,37,58],[48,62,37,60],[48,75,37,73],[48,77,37,75],[48,86,37,84],[48,88,37,86],[48,102,37,100],[48,103,37,101],[48,104,37,102],[49,10,39,8],[49,14,39,12,"event"],[49,19,39,17],[49,21,39,19],[50,12,40,10,"event"],[50,17,40,15],[50,18,40,16,"release"],[50,25,40,23],[50,28,40,26,"release"],[50,35,40,33],[51,10,41,8],[52,10,42,8],[52,17,42,15,"transport"],[52,26,42,24],[52,27,42,25,"send"],[52,31,42,29],[52,32,42,30,"envelope"],[52,40,42,38],[52,41,42,39],[53,8,43,6],[54,6,44,4],[54,7,44,5],[55,4,45,2],[55,5,45,3],[56,2,46,0],[58,2,48,0],[59,2,49,0],[59,11,49,9,"overrideDsn"],[59,22,49,20,"overrideDsn"],[59,23,49,21,"envelope"],[59,31,49,29],[59,33,49,31,"dsn"],[59,36,49,34],[59,38,49,36],[60,4,50,2],[60,11,50,9],[60,15,50,9,"createEnvelope"],[60,31,50,23],[60,32,50,23,"createEnvelope"],[60,46,50,23],[60,48,51,4,"dsn"],[60,51,51,7],[60,54,52,8],[61,6,53,10],[61,9,53,13,"envelope"],[61,17,53,21],[61,18,53,22],[61,19,53,23],[61,20,53,24],[62,6,54,10,"dsn"],[63,4,55,8],[63,5,55,9],[63,8,56,8,"envelope"],[63,16,56,16],[63,17,56,17],[63,18,56,18],[63,19,56,19],[63,21,57,4,"envelope"],[63,29,57,12],[63,30,57,13],[63,31,57,14],[63,32,58,2],[63,33,58,3],[64,2,59,0],[66,2,61,0],[67,0,62,0],[68,0,63,0],[69,2,64,0],[69,11,64,9,"makeMultiplexedTransport"],[69,35,64,33,"makeMultiplexedTransport"],[69,36,65,2,"createTransport"],[69,51,65,17],[69,53,66,2,"matcher"],[69,60,66,9],[69,62,67,2],[70,4,68,2],[70,11,68,9,"options"],[70,18,68,16],[70,22,68,20],[71,6,69,4],[71,12,69,10,"fallbackTransport"],[71,29,69,27],[71,32,69,30,"createTransport"],[71,47,69,45],[71,48,69,46,"options"],[71,55,69,53],[71,56,69,54],[72,6,70,4],[72,12,70,10,"otherTransports"],[72,27,70,25],[72,30,70,28],[72,34,70,32,"Map"],[72,37,70,35],[72,38,70,36],[72,39,70,37],[73,6,72,4],[73,15,72,13,"getTransport"],[73,27,72,25,"getTransport"],[73,28,72,26,"dsn"],[73,31,72,29],[73,33,72,31,"release"],[73,40,72,38],[73,42,72,40],[74,8,73,6],[75,8,74,6],[76,8,75,6],[76,14,75,12,"key"],[76,17,75,15],[76,20,75,18,"release"],[76,27,75,25],[76,30,75,28],[76,33,75,31,"dsn"],[76,36,75,34],[76,40,75,38,"release"],[76,47,75,45],[76,49,75,47],[76,52,75,50,"dsn"],[76,55,75,53],[77,8,77,6],[77,12,77,10,"transport"],[77,21,77,19],[77,24,77,22,"otherTransports"],[77,39,77,37],[77,40,77,38,"get"],[77,43,77,41],[77,44,77,42,"key"],[77,47,77,45],[77,48,77,46],[78,8,79,6],[78,12,79,10],[78,13,79,11,"transport"],[78,22,79,20],[78,24,79,22],[79,10,80,8],[79,16,80,14,"validatedDsn"],[79,28,80,26],[79,31,80,29],[79,35,80,29,"dsnFromString"],[79,46,80,42],[79,47,80,42,"dsnFromString"],[79,60,80,42],[79,62,80,43,"dsn"],[79,65,80,46],[79,66,80,47],[80,10,81,8],[80,14,81,12],[80,15,81,13,"validatedDsn"],[80,27,81,25],[80,29,81,27],[81,12,82,10],[81,19,82,17,"undefined"],[81,28,82,26],[82,10,83,8],[83,10,84,8],[83,16,84,14,"url"],[83,19,84,17],[83,22,84,20],[83,26,84,20,"getEnvelopeEndpointWithUrlEncodedAuth"],[83,32,84,57],[83,33,84,57,"getEnvelopeEndpointWithUrlEncodedAuth"],[83,70,84,57],[83,72,84,58,"validatedDsn"],[83,84,84,70],[83,86,84,72,"options"],[83,93,84,79],[83,94,84,80,"tunnel"],[83,100,84,86],[83,101,84,87],[84,10,86,8,"transport"],[84,19,86,17],[84,22,86,20,"release"],[84,29,86,27],[84,32,87,12,"makeOverrideReleaseTransport"],[84,60,87,40],[84,61,87,41,"createTransport"],[84,76,87,56],[84,78,87,58,"release"],[84,85,87,65],[84,86,87,66],[84,87,87,67],[85,12,87,69],[85,15,87,72,"options"],[85,22,87,79],[86,12,87,81,"url"],[87,10,87,85],[87,11,87,86],[87,12,87,87],[87,15,88,12,"createTransport"],[87,30,88,27],[87,31,88,28],[88,12,88,30],[88,15,88,33,"options"],[88,22,88,40],[89,12,88,42,"url"],[90,10,88,46],[90,11,88,47],[90,12,88,48],[91,10,90,8,"otherTransports"],[91,25,90,23],[91,26,90,24,"set"],[91,29,90,27],[91,30,90,28,"key"],[91,33,90,31],[91,35,90,33,"transport"],[91,44,90,42],[91,45,90,43],[92,8,91,6],[93,8,93,6],[93,15,93,13],[93,16,93,14,"dsn"],[93,19,93,17],[93,21,93,19,"transport"],[93,30,93,28],[93,31,93,29],[94,6,94,4],[95,6,96,4],[95,21,96,19,"send"],[95,25,96,23,"send"],[95,26,96,24,"envelope"],[95,34,96,32],[95,36,96,34],[96,8,97,6],[96,17,97,15,"getEvent"],[96,25,97,23,"getEvent"],[96,26,97,24,"types"],[96,31,97,29],[96,33,97,31],[97,10,98,8],[97,16,98,14,"eventTypes"],[97,26,98,24],[97,29,98,27,"types"],[97,34,98,32],[97,36,98,34,"length"],[97,42,98,40],[97,45,98,43,"types"],[97,50,98,48],[97,53,98,51],[97,54,98,52],[97,61,98,59],[97,62,98,60],[98,10,99,8],[98,17,99,15,"eventFromEnvelope"],[98,34,99,32],[98,35,99,33,"envelope"],[98,43,99,41],[98,45,99,43,"eventTypes"],[98,55,99,53],[98,56,99,54],[99,8,100,6],[100,8,102,6],[100,14,102,12,"transports"],[100,24,102,22],[100,27,102,25,"matcher"],[100,34,102,32],[100,35,102,33],[101,10,102,35,"envelope"],[101,18,102,43],[102,10,102,45,"getEvent"],[103,8,102,54],[103,9,102,55],[103,10,102,56],[103,11,103,9,"map"],[103,14,103,12],[103,15,103,13,"result"],[103,21,103,19],[103,25,103,23],[104,10,104,10],[104,14,104,14],[104,21,104,21,"result"],[104,27,104,27],[104,32,104,32],[104,40,104,40],[104,42,104,42],[105,12,105,12],[105,19,105,19,"getTransport"],[105,31,105,31],[105,32,105,32,"result"],[105,38,105,38],[105,40,105,40,"undefined"],[105,49,105,49],[105,50,105,50],[106,10,106,10],[106,11,106,11],[106,17,106,17],[107,12,107,12],[107,19,107,19,"getTransport"],[107,31,107,31],[107,32,107,32,"result"],[107,38,107,38],[107,39,107,39,"dsn"],[107,42,107,42],[107,44,107,44,"result"],[107,50,107,50],[107,51,107,51,"release"],[107,58,107,58],[107,59,107,59],[108,10,108,10],[109,8,109,8],[109,9,109,9],[109,10,109,10],[109,11,110,9,"filter"],[109,17,110,15],[109,18,110,17,"t"],[109,19,110,18],[109,23,110,23],[109,24,110,24],[109,25,110,25,"t"],[109,26,110,26],[109,27,110,27],[111,8,112,6],[112,8,113,6],[113,8,114,6],[113,14,114,12,"transportsWithFallback"],[113,36,114,34],[113,39,114,37,"transports"],[113,49,114,47],[113,50,114,48,"length"],[113,56,114,54],[113,59,114,57,"transports"],[113,69,114,67],[113,72,114,70],[113,73,114,71],[113,74,114,72],[113,76,114,74],[113,78,114,76,"fallbackTransport"],[113,95,114,93],[113,96,114,94],[113,97,114,95],[114,8,116,6],[114,14,116,12,"results"],[114,21,116,19],[114,24,116,23],[114,30,116,29,"Promise"],[114,37,116,36],[114,38,116,37,"all"],[114,41,116,40],[114,42,117,8,"transportsWithFallback"],[114,64,117,30],[114,65,117,31,"map"],[114,68,117,34],[114,69,117,35],[114,70,117,36],[114,71,117,37,"dsn"],[114,74,117,40],[114,76,117,42,"transport"],[114,85,117,51],[114,86,117,52],[114,91,117,57,"transport"],[114,100,117,66],[114,101,117,67,"send"],[114,105,117,71],[114,106,117,72,"overrideDsn"],[114,117,117,83],[114,118,117,84,"envelope"],[114,126,117,92],[114,128,117,94,"dsn"],[114,131,117,97],[114,132,117,98],[114,133,117,99],[114,134,118,6],[114,135,118,8],[115,8,120,6],[115,15,120,13,"results"],[115,22,120,20],[115,23,120,21],[115,24,120,22],[115,25,120,23],[116,6,121,4],[117,6,123,4],[117,21,123,19,"flush"],[117,26,123,24,"flush"],[117,27,123,25,"timeout"],[117,34,123,32],[117,36,123,34],[118,8,124,6],[118,14,124,12,"allTransports"],[118,27,124,25],[118,30,124,28],[118,31,124,29],[118,34,124,32,"otherTransports"],[118,49,124,47],[118,50,124,48,"values"],[118,56,124,54],[118,57,124,55],[118,58,124,56],[118,60,124,58,"fallbackTransport"],[118,77,124,75],[118,78,124,76],[119,8,125,6],[119,14,125,12,"results"],[119,21,125,19],[119,24,125,22],[119,30,125,28,"Promise"],[119,37,125,35],[119,38,125,36,"all"],[119,41,125,39],[119,42,125,40,"allTransports"],[119,55,125,53],[119,56,125,54,"map"],[119,59,125,57],[119,60,125,58,"transport"],[119,69,125,67],[119,73,125,71,"transport"],[119,82,125,80],[119,83,125,81,"flush"],[119,88,125,86],[119,89,125,87,"timeout"],[119,96,125,94],[119,97,125,95],[119,98,125,96],[119,99,125,97],[120,8,126,6],[120,15,126,13,"results"],[120,22,126,20],[120,23,126,21,"every"],[120,28,126,26],[120,29,126,27,"r"],[120,30,126,28],[120,34,126,32,"r"],[120,35,126,33],[120,36,126,34],[121,6,127,4],[122,6,129,4],[122,13,129,11],[123,8,130,6,"send"],[123,12,130,10],[124,8,131,6,"flush"],[125,6,132,4],[125,7,132,5],[126,4,133,2],[126,5,133,3],[127,2,134,0],[128,0,134,1],[128,3]],"functionMap":{"names":["<global>","eventFromEnvelope","forEachEnvelopeItem$argument_1","makeOverrideReleaseTransport","<anonymous>","send","overrideDsn","makeMultiplexedTransport","getTransport","getEvent","matcher.map$argument_0","matcher.map.filter$argument_0","transportsWithFallback.map$argument_0","flush","allTransports.map$argument_0","results.every$argument_0"],"mappings":"AAA;ACS;2BCG;GDM;CDG;AGK;SCI;YCK;ODO;GDE;CHC;AMG;CNU;AOK;SHI;III;KJsB;ICE;MIC;OJG;aKG;SLM;gBMC,UN;mCOO,gEP;KDI;ISE;0DCE,qCD;2BEC,MF;KTC;GGM;CPC"},"hasCjsExports":false},"type":"js/module"}]}