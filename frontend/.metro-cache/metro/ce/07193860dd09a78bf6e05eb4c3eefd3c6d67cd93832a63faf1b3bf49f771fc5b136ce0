{"dependencies":[{"name":"./gen-ai-attributes.js","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":152,"index":152}}],"key":"EmAYAYXJGPnzpSXN+q9ZtGOEkn0=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  Object.defineProperty(exports, \"buildMethodPath\", {\n    enumerable: true,\n    get: function () {\n      return buildMethodPath;\n    }\n  });\n  Object.defineProperty(exports, \"getFinalOperationName\", {\n    enumerable: true,\n    get: function () {\n      return getFinalOperationName;\n    }\n  });\n  Object.defineProperty(exports, \"getSpanOperation\", {\n    enumerable: true,\n    get: function () {\n      return getSpanOperation;\n    }\n  });\n  Object.defineProperty(exports, \"setTokenUsageAttributes\", {\n    enumerable: true,\n    get: function () {\n      return setTokenUsageAttributes;\n    }\n  });\n  var _genAiAttributesJs = require(_dependencyMap[0], \"./gen-ai-attributes.js\");\n  /**\n   * Maps AI method paths to Sentry operation name\n   */\n  function getFinalOperationName(methodPath) {\n    if (methodPath.includes('messages')) {\n      return 'messages';\n    }\n    if (methodPath.includes('completions')) {\n      return 'completions';\n    }\n    if (methodPath.includes('models')) {\n      return 'models';\n    }\n    return methodPath.split('.').pop() || 'unknown';\n  }\n\n  /**\n   * Get the span operation for AI methods\n   * Following Sentry's convention: \"gen_ai.{operation_name}\"\n   */\n  function getSpanOperation(methodPath) {\n    return `gen_ai.${getFinalOperationName(methodPath)}`;\n  }\n\n  /**\n   * Build method path from current traversal\n   */\n  function buildMethodPath(currentPath, prop) {\n    return currentPath ? `${currentPath}.${prop}` : prop;\n  }\n\n  /**\n   * Set token usage attributes\n   * @param span - The span to add attributes to\n   * @param promptTokens - The number of prompt tokens\n   * @param completionTokens - The number of completion tokens\n   * @param cachedInputTokens - The number of cached input tokens\n   * @param cachedOutputTokens - The number of cached output tokens\n   */\n  function setTokenUsageAttributes(span, promptTokens, completionTokens, cachedInputTokens, cachedOutputTokens) {\n    if (promptTokens !== undefined) {\n      span.setAttributes({\n        [_genAiAttributesJs.GEN_AI_USAGE_INPUT_TOKENS_ATTRIBUTE]: promptTokens\n      });\n    }\n    if (completionTokens !== undefined) {\n      span.setAttributes({\n        [_genAiAttributesJs.GEN_AI_USAGE_OUTPUT_TOKENS_ATTRIBUTE]: completionTokens\n      });\n    }\n    if (promptTokens !== undefined || completionTokens !== undefined || cachedInputTokens !== undefined || cachedOutputTokens !== undefined) {\n      /**\n       * Total input tokens in a request is the summation of `input_tokens`,\n       * `cache_creation_input_tokens`, and `cache_read_input_tokens`.\n       */\n      const totalTokens = (promptTokens ?? 0) + (completionTokens ?? 0) + (cachedInputTokens ?? 0) + (cachedOutputTokens ?? 0);\n      span.setAttributes({\n        [_genAiAttributesJs.GEN_AI_USAGE_TOTAL_TOKENS_ATTRIBUTE]: totalTokens\n      });\n    }\n  }\n});","lineCount":93,"map":[[7,2,78,0,"Object"],[7,8,78,0],[7,9,78,0,"defineProperty"],[7,23,78,0],[7,24,78,0,"exports"],[7,31,78,0],[8,4,78,0,"enumerable"],[8,14,78,0],[9,4,78,0,"get"],[9,7,78,0],[9,18,78,0,"get"],[9,19,78,0],[10,6,78,0],[10,13,78,9,"buildMethodPath"],[10,28,78,24],[11,4,78,24],[12,2,78,24],[13,2,78,0,"Object"],[13,8,78,0],[13,9,78,0,"defineProperty"],[13,23,78,0],[13,24,78,0,"exports"],[13,31,78,0],[14,4,78,0,"enumerable"],[14,14,78,0],[15,4,78,0,"get"],[15,7,78,0],[15,18,78,0,"get"],[15,19,78,0],[16,6,78,0],[16,13,78,26,"getFinalOperationName"],[16,34,78,47],[17,4,78,47],[18,2,78,47],[19,2,78,0,"Object"],[19,8,78,0],[19,9,78,0,"defineProperty"],[19,23,78,0],[19,24,78,0,"exports"],[19,31,78,0],[20,4,78,0,"enumerable"],[20,14,78,0],[21,4,78,0,"get"],[21,7,78,0],[21,18,78,0,"get"],[21,19,78,0],[22,6,78,0],[22,13,78,49,"getSpanOperation"],[22,29,78,65],[23,4,78,65],[24,2,78,65],[25,2,78,0,"Object"],[25,8,78,0],[25,9,78,0,"defineProperty"],[25,23,78,0],[25,24,78,0,"exports"],[25,31,78,0],[26,4,78,0,"enumerable"],[26,14,78,0],[27,4,78,0,"get"],[27,7,78,0],[27,18,78,0,"get"],[27,19,78,0],[28,6,78,0],[28,13,78,67,"setTokenUsageAttributes"],[28,36,78,90],[29,4,78,90],[30,2,78,90],[31,2,1,0],[31,6,1,0,"_genAiAttributesJs"],[31,24,1,0],[31,27,1,0,"require"],[31,34,1,0],[31,35,1,0,"_dependencyMap"],[31,49,1,0],[32,2,3,0],[33,0,4,0],[34,0,5,0],[35,2,6,0],[35,11,6,9,"getFinalOperationName"],[35,32,6,30,"getFinalOperationName"],[35,33,6,31,"methodPath"],[35,43,6,41],[35,45,6,43],[36,4,7,2],[36,8,7,6,"methodPath"],[36,18,7,16],[36,19,7,17,"includes"],[36,27,7,25],[36,28,7,26],[36,38,7,36],[36,39,7,37],[36,41,7,39],[37,6,8,4],[37,13,8,11],[37,23,8,21],[38,4,9,2],[39,4,10,2],[39,8,10,6,"methodPath"],[39,18,10,16],[39,19,10,17,"includes"],[39,27,10,25],[39,28,10,26],[39,41,10,39],[39,42,10,40],[39,44,10,42],[40,6,11,4],[40,13,11,11],[40,26,11,24],[41,4,12,2],[42,4,13,2],[42,8,13,6,"methodPath"],[42,18,13,16],[42,19,13,17,"includes"],[42,27,13,25],[42,28,13,26],[42,36,13,34],[42,37,13,35],[42,39,13,37],[43,6,14,4],[43,13,14,11],[43,21,14,19],[44,4,15,2],[45,4,16,2],[45,11,16,9,"methodPath"],[45,21,16,19],[45,22,16,20,"split"],[45,27,16,25],[45,28,16,26],[45,31,16,29],[45,32,16,30],[45,33,16,31,"pop"],[45,36,16,34],[45,37,16,35],[45,38,16,36],[45,42,16,40],[45,51,16,49],[46,2,17,0],[48,2,19,0],[49,0,20,0],[50,0,21,0],[51,0,22,0],[52,2,23,0],[52,11,23,9,"getSpanOperation"],[52,27,23,25,"getSpanOperation"],[52,28,23,26,"methodPath"],[52,38,23,36],[52,40,23,38],[53,4,24,2],[53,11,24,9],[53,21,24,19,"getFinalOperationName"],[53,42,24,40],[53,43,24,41,"methodPath"],[53,53,24,51],[53,54,24,52],[53,56,24,54],[54,2,25,0],[56,2,27,0],[57,0,28,0],[58,0,29,0],[59,2,30,0],[59,11,30,9,"buildMethodPath"],[59,26,30,24,"buildMethodPath"],[59,27,30,25,"currentPath"],[59,38,30,36],[59,40,30,38,"prop"],[59,44,30,42],[59,46,30,44],[60,4,31,2],[60,11,31,9,"currentPath"],[60,22,31,20],[60,25,31,23],[60,28,31,26,"currentPath"],[60,39,31,37],[60,43,31,41,"prop"],[60,47,31,45],[60,49,31,47],[60,52,31,50,"prop"],[60,56,31,54],[61,2,32,0],[63,2,34,0],[64,0,35,0],[65,0,36,0],[66,0,37,0],[67,0,38,0],[68,0,39,0],[69,0,40,0],[70,0,41,0],[71,2,42,0],[71,11,42,9,"setTokenUsageAttributes"],[71,34,42,32,"setTokenUsageAttributes"],[71,35,43,2,"span"],[71,39,43,6],[71,41,44,2,"promptTokens"],[71,53,44,14],[71,55,45,2,"completionTokens"],[71,71,45,18],[71,73,46,2,"cachedInputTokens"],[71,90,46,19],[71,92,47,2,"cachedOutputTokens"],[71,110,47,20],[71,112,48,2],[72,4,49,2],[72,8,49,6,"promptTokens"],[72,20,49,18],[72,25,49,23,"undefined"],[72,34,49,32],[72,36,49,34],[73,6,50,4,"span"],[73,10,50,8],[73,11,50,9,"setAttributes"],[73,24,50,22],[73,25,50,23],[74,8,51,6],[74,9,51,7,"GEN_AI_USAGE_INPUT_TOKENS_ATTRIBUTE"],[74,27,51,42],[74,28,51,42,"GEN_AI_USAGE_INPUT_TOKENS_ATTRIBUTE"],[74,63,51,42],[74,66,51,45,"promptTokens"],[75,6,52,4],[75,7,52,5],[75,8,52,6],[76,4,53,2],[77,4,54,2],[77,8,54,6,"completionTokens"],[77,24,54,22],[77,29,54,27,"undefined"],[77,38,54,36],[77,40,54,38],[78,6,55,4,"span"],[78,10,55,8],[78,11,55,9,"setAttributes"],[78,24,55,22],[78,25,55,23],[79,8,56,6],[79,9,56,7,"GEN_AI_USAGE_OUTPUT_TOKENS_ATTRIBUTE"],[79,27,56,43],[79,28,56,43,"GEN_AI_USAGE_OUTPUT_TOKENS_ATTRIBUTE"],[79,64,56,43],[79,67,56,46,"completionTokens"],[80,6,57,4],[80,7,57,5],[80,8,57,6],[81,4,58,2],[82,4,59,2],[82,8,60,4,"promptTokens"],[82,20,60,16],[82,25,60,21,"undefined"],[82,34,60,30],[82,38,61,4,"completionTokens"],[82,54,61,20],[82,59,61,25,"undefined"],[82,68,61,34],[82,72,62,4,"cachedInputTokens"],[82,89,62,21],[82,94,62,26,"undefined"],[82,103,62,35],[82,107,63,4,"cachedOutputTokens"],[82,125,63,22],[82,130,63,27,"undefined"],[82,139,63,36],[82,141,64,4],[83,6,65,4],[84,0,66,0],[85,0,67,0],[86,0,68,0],[87,6,69,4],[87,12,69,10,"totalTokens"],[87,23,69,21],[87,26,70,6],[87,27,70,7,"promptTokens"],[87,39,70,19],[87,43,70,23],[87,44,70,24],[87,49,70,29,"completionTokens"],[87,65,70,45],[87,69,70,49],[87,70,70,50],[87,71,70,51],[87,75,70,55,"cachedInputTokens"],[87,92,70,72],[87,96,70,76],[87,97,70,77],[87,98,70,78],[87,102,70,82,"cachedOutputTokens"],[87,120,70,100],[87,124,70,104],[87,125,70,105],[87,126,70,106],[88,6,72,4,"span"],[88,10,72,8],[88,11,72,9,"setAttributes"],[88,24,72,22],[88,25,72,23],[89,8,73,6],[89,9,73,7,"GEN_AI_USAGE_TOTAL_TOKENS_ATTRIBUTE"],[89,27,73,42],[89,28,73,42,"GEN_AI_USAGE_TOTAL_TOKENS_ATTRIBUTE"],[89,63,73,42],[89,66,73,45,"totalTokens"],[90,6,74,4],[90,7,74,5],[90,8,74,6],[91,4,75,2],[92,2,76,0],[93,0,76,1],[93,3]],"functionMap":{"names":["<global>","getFinalOperationName","getSpanOperation","buildMethodPath","setTokenUsageAttributes"],"mappings":"AAA;ACK;CDW;AEM;CFE;AGK;CHE;AIU;CJkC"},"hasCjsExports":false},"type":"js/module"}]}