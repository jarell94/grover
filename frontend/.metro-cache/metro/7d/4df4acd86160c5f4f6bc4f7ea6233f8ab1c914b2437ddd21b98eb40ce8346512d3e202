{"dependencies":[{"name":"../../exports.js","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":52,"index":52}}],"key":"EZPmsHt7bn9JJ4Y0grXw/CrOow0=","exportNames":["*"],"imports":1}},{"name":"../../tracing/spanstatus.js","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":2,"column":0,"index":53},"end":{"line":2,"column":64,"index":117}}],"key":"xTnLe4eZ8UwJZsOO8L+5TFoq+AE=","exportNames":["*"],"imports":1}},{"name":"../ai/gen-ai-attributes.js","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":3,"column":0,"index":118},"end":{"line":3,"column":256,"index":374}}],"key":"nKHaXfEjIYF1icPUCGJgR0o1cZ8=","exportNames":["*"],"imports":1}},{"name":"../ai/utils.js","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":4,"column":0,"index":375},"end":{"line":4,"column":57,"index":432}}],"key":"4ap/A8nGTkT0jtbnAG1G9kFBsuw=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  Object.defineProperty(exports, \"instrumentStream\", {\n    enumerable: true,\n    get: function () {\n      return instrumentStream;\n    }\n  });\n  var _exportsJs = require(_dependencyMap[0], \"../../exports.js\");\n  var _tracingSpanstatusJs = require(_dependencyMap[1], \"../../tracing/spanstatus.js\");\n  var _aiGenAiAttributesJs = require(_dependencyMap[2], \"../ai/gen-ai-attributes.js\");\n  var _aiUtilsJs = require(_dependencyMap[3], \"../ai/utils.js\");\n  /**\n   * State object used to accumulate information from a stream of Anthropic AI events.\n   */\n\n  /**\n   * Checks if an event is an error event\n   * @param event - The event to process\n   * @param state - The state of the streaming process\n   * @param recordOutputs - Whether to record outputs\n   * @param span - The span to update\n   * @returns Whether an error occurred\n   */\n\n  function isErrorEvent(event, span) {\n    if ('type' in event && typeof event.type === 'string') {\n      // If the event is an error, set the span status and capture the error\n      // These error events are not rejected by the API by default, but are sent as metadata of the response\n      if (event.type === 'error') {\n        span.setStatus({\n          code: _tracingSpanstatusJs.SPAN_STATUS_ERROR,\n          message: event.error?.type ?? 'unknown_error'\n        });\n        (0, _exportsJs.captureException)(event.error, {\n          mechanism: {\n            handled: false,\n            type: 'auto.ai.anthropic.anthropic_error'\n          }\n        });\n        return true;\n      }\n    }\n    return false;\n  }\n\n  /**\n   * Processes the message metadata of an event\n   * @param event - The event to process\n   * @param state - The state of the streaming process\n   */\n\n  function handleMessageMetadata(event, state) {\n    // The token counts shown in the usage field of the message_delta event are cumulative.\n    // @see https://docs.anthropic.com/en/docs/build-with-claude/streaming#event-types\n    if (event.type === 'message_delta' && event.usage) {\n      if ('output_tokens' in event.usage && typeof event.usage.output_tokens === 'number') {\n        state.completionTokens = event.usage.output_tokens;\n      }\n    }\n    if (event.message) {\n      const message = event.message;\n      if (message.id) state.responseId = message.id;\n      if (message.model) state.responseModel = message.model;\n      if (message.stop_reason) state.finishReasons.push(message.stop_reason);\n      if (message.usage) {\n        if (typeof message.usage.input_tokens === 'number') state.promptTokens = message.usage.input_tokens;\n        if (typeof message.usage.cache_creation_input_tokens === 'number') state.cacheCreationInputTokens = message.usage.cache_creation_input_tokens;\n        if (typeof message.usage.cache_read_input_tokens === 'number') state.cacheReadInputTokens = message.usage.cache_read_input_tokens;\n      }\n    }\n  }\n\n  /**\n   * Handle start of a content block (e.g., tool_use)\n   */\n  function handleContentBlockStart(event, state) {\n    if (event.type !== 'content_block_start' || typeof event.index !== 'number' || !event.content_block) return;\n    if (event.content_block.type === 'tool_use' || event.content_block.type === 'server_tool_use') {\n      state.activeToolBlocks[event.index] = {\n        id: event.content_block.id,\n        name: event.content_block.name,\n        inputJsonParts: []\n      };\n    }\n  }\n\n  /**\n   * Handle deltas of a content block, including input_json_delta for tool_use\n   */\n  function handleContentBlockDelta(event, state, recordOutputs) {\n    if (event.type !== 'content_block_delta' || !event.delta) return;\n\n    // Accumulate tool_use input JSON deltas only when we have an index and an active tool block\n    if (typeof event.index === 'number' && 'partial_json' in event.delta && typeof event.delta.partial_json === 'string') {\n      const active = state.activeToolBlocks[event.index];\n      if (active) {\n        active.inputJsonParts.push(event.delta.partial_json);\n      }\n    }\n\n    // Accumulate streamed response text regardless of index\n    if (recordOutputs && typeof event.delta.text === 'string') {\n      state.responseTexts.push(event.delta.text);\n    }\n  }\n\n  /**\n   * Handle stop of a content block; finalize tool_use entries\n   */\n  function handleContentBlockStop(event, state) {\n    if (event.type !== 'content_block_stop' || typeof event.index !== 'number') return;\n    const active = state.activeToolBlocks[event.index];\n    if (!active) return;\n    const raw = active.inputJsonParts.join('');\n    let parsedInput;\n    try {\n      parsedInput = raw ? JSON.parse(raw) : {};\n    } catch {\n      parsedInput = {\n        __unparsed: raw\n      };\n    }\n    state.toolCalls.push({\n      type: 'tool_use',\n      id: active.id,\n      name: active.name,\n      input: parsedInput\n    });\n\n    // eslint-disable-next-line @typescript-eslint/no-dynamic-delete\n    delete state.activeToolBlocks[event.index];\n  }\n\n  /**\n   * Processes an event\n   * @param event - The event to process\n   * @param state - The state of the streaming process\n   * @param recordOutputs - Whether to record outputs\n   * @param span - The span to update\n   */\n\n  function processEvent(event, state, recordOutputs, span) {\n    if (!(event && typeof event === 'object')) {\n      return;\n    }\n    const isError = isErrorEvent(event, span);\n    if (isError) return;\n    handleMessageMetadata(event, state);\n\n    // Tool call events are sent via 3 separate events:\n    // - content_block_start (start of the tool call)\n    // - content_block_delta (delta aka input of the tool call)\n    // - content_block_stop (end of the tool call)\n    // We need to handle them all to capture the full tool call.\n    handleContentBlockStart(event, state);\n    handleContentBlockDelta(event, state, recordOutputs);\n    handleContentBlockStop(event, state);\n  }\n\n  /**\n   * Instruments an async iterable stream of Anthropic events, updates the span with\n   * streaming attributes and (optionally) the aggregated output text, and yields\n   * each event from the input stream unchanged.\n   */\n  async function* instrumentStream(stream, span, recordOutputs) {\n    const state = {\n      responseTexts: [],\n      finishReasons: [],\n      responseId: '',\n      responseModel: '',\n      promptTokens: undefined,\n      completionTokens: undefined,\n      cacheCreationInputTokens: undefined,\n      cacheReadInputTokens: undefined,\n      toolCalls: [],\n      activeToolBlocks: {}\n    };\n    try {\n      for await (const event of stream) {\n        processEvent(event, state, recordOutputs, span);\n        yield event;\n      }\n    } finally {\n      // Set common response attributes if available\n      if (state.responseId) {\n        span.setAttributes({\n          [_aiGenAiAttributesJs.GEN_AI_RESPONSE_ID_ATTRIBUTE]: state.responseId\n        });\n      }\n      if (state.responseModel) {\n        span.setAttributes({\n          [_aiGenAiAttributesJs.GEN_AI_RESPONSE_MODEL_ATTRIBUTE]: state.responseModel\n        });\n      }\n      (0, _aiUtilsJs.setTokenUsageAttributes)(span, state.promptTokens, state.completionTokens, state.cacheCreationInputTokens, state.cacheReadInputTokens);\n      span.setAttributes({\n        [_aiGenAiAttributesJs.GEN_AI_RESPONSE_STREAMING_ATTRIBUTE]: true\n      });\n      if (state.finishReasons.length > 0) {\n        span.setAttributes({\n          [_aiGenAiAttributesJs.GEN_AI_RESPONSE_FINISH_REASONS_ATTRIBUTE]: JSON.stringify(state.finishReasons)\n        });\n      }\n      if (recordOutputs && state.responseTexts.length > 0) {\n        span.setAttributes({\n          [_aiGenAiAttributesJs.GEN_AI_RESPONSE_TEXT_ATTRIBUTE]: state.responseTexts.join('')\n        });\n      }\n\n      // Set tool calls if any were captured\n      if (recordOutputs && state.toolCalls.length > 0) {\n        span.setAttributes({\n          [_aiGenAiAttributesJs.GEN_AI_RESPONSE_TOOL_CALLS_ATTRIBUTE]: JSON.stringify(state.toolCalls)\n        });\n      }\n      span.end();\n    }\n  }\n});","lineCount":224,"map":[[7,2,249,0,"Object"],[7,8,249,0],[7,9,249,0,"defineProperty"],[7,23,249,0],[7,24,249,0,"exports"],[7,31,249,0],[8,4,249,0,"enumerable"],[8,14,249,0],[9,4,249,0,"get"],[9,7,249,0],[9,18,249,0,"get"],[9,19,249,0],[10,6,249,0],[10,13,249,9,"instrumentStream"],[10,29,249,25],[11,4,249,25],[12,2,249,25],[13,2,1,0],[13,6,1,0,"_exportsJs"],[13,16,1,0],[13,19,1,0,"require"],[13,26,1,0],[13,27,1,0,"_dependencyMap"],[13,41,1,0],[14,2,2,0],[14,6,2,0,"_tracingSpanstatusJs"],[14,26,2,0],[14,29,2,0,"require"],[14,36,2,0],[14,37,2,0,"_dependencyMap"],[14,51,2,0],[15,2,3,0],[15,6,3,0,"_aiGenAiAttributesJs"],[15,26,3,0],[15,29,3,0,"require"],[15,36,3,0],[15,37,3,0,"_dependencyMap"],[15,51,3,0],[16,2,4,0],[16,6,4,0,"_aiUtilsJs"],[16,16,4,0],[16,19,4,0,"require"],[16,26,4,0],[16,27,4,0,"_dependencyMap"],[16,41,4,0],[17,2,6,0],[18,0,7,0],[19,0,8,0],[21,2,10,0],[22,0,11,0],[23,0,12,0],[24,0,13,0],[25,0,14,0],[26,0,15,0],[27,0,16,0],[28,0,17,0],[30,2,19,0],[30,11,19,9,"isErrorEvent"],[30,23,19,21,"isErrorEvent"],[30,24,19,22,"event"],[30,29,19,27],[30,31,19,29,"span"],[30,35,19,33],[30,37,19,35],[31,4,20,2],[31,8,20,6],[31,14,20,12],[31,18,20,16,"event"],[31,23,20,21],[31,27,20,25],[31,34,20,32,"event"],[31,39,20,37],[31,40,20,38,"type"],[31,44,20,42],[31,49,20,47],[31,57,20,55],[31,59,20,57],[32,6,21,4],[33,6,22,4],[34,6,23,4],[34,10,23,8,"event"],[34,15,23,13],[34,16,23,14,"type"],[34,20,23,18],[34,25,23,23],[34,32,23,30],[34,34,23,32],[35,8,24,6,"span"],[35,12,24,10],[35,13,24,11,"setStatus"],[35,22,24,20],[35,23,24,21],[36,10,24,23,"code"],[36,14,24,27],[36,16,24,29,"SPAN_STATUS_ERROR"],[36,36,24,46],[36,37,24,46,"SPAN_STATUS_ERROR"],[36,54,24,46],[37,10,24,48,"message"],[37,17,24,55],[37,19,24,57,"event"],[37,24,24,62],[37,25,24,63,"error"],[37,30,24,68],[37,32,24,70,"type"],[37,36,24,74],[37,40,24,78],[38,8,24,94],[38,9,24,95],[38,10,24,96],[39,8,25,6],[39,12,25,6,"captureException"],[39,22,25,22],[39,23,25,22,"captureException"],[39,39,25,22],[39,41,25,23,"event"],[39,46,25,28],[39,47,25,29,"error"],[39,52,25,34],[39,54,25,36],[40,10,26,8,"mechanism"],[40,19,26,17],[40,21,26,19],[41,12,27,10,"handled"],[41,19,27,17],[41,21,27,19],[41,26,27,24],[42,12,28,10,"type"],[42,16,28,14],[42,18,28,16],[43,10,29,8],[44,8,30,6],[44,9,30,7],[44,10,30,8],[45,8,31,6],[45,15,31,13],[45,19,31,17],[46,6,32,4],[47,4,33,2],[48,4,34,2],[48,11,34,9],[48,16,34,14],[49,2,35,0],[51,2,37,0],[52,0,38,0],[53,0,39,0],[54,0,40,0],[55,0,41,0],[57,2,43,0],[57,11,43,9,"handleMessageMetadata"],[57,32,43,30,"handleMessageMetadata"],[57,33,43,31,"event"],[57,38,43,36],[57,40,43,38,"state"],[57,45,43,43],[57,47,43,45],[58,4,44,2],[59,4,45,2],[60,4,46,2],[60,8,46,6,"event"],[60,13,46,11],[60,14,46,12,"type"],[60,18,46,16],[60,23,46,21],[60,38,46,36],[60,42,46,40,"event"],[60,47,46,45],[60,48,46,46,"usage"],[60,53,46,51],[60,55,46,53],[61,6,47,4],[61,10,47,8],[61,25,47,23],[61,29,47,27,"event"],[61,34,47,32],[61,35,47,33,"usage"],[61,40,47,38],[61,44,47,42],[61,51,47,49,"event"],[61,56,47,54],[61,57,47,55,"usage"],[61,62,47,60],[61,63,47,61,"output_tokens"],[61,76,47,74],[61,81,47,79],[61,89,47,87],[61,91,47,89],[62,8,48,6,"state"],[62,13,48,11],[62,14,48,12,"completionTokens"],[62,30,48,28],[62,33,48,31,"event"],[62,38,48,36],[62,39,48,37,"usage"],[62,44,48,42],[62,45,48,43,"output_tokens"],[62,58,48,56],[63,6,49,4],[64,4,50,2],[65,4,52,2],[65,8,52,6,"event"],[65,13,52,11],[65,14,52,12,"message"],[65,21,52,19],[65,23,52,21],[66,6,53,4],[66,12,53,10,"message"],[66,19,53,17],[66,22,53,20,"event"],[66,27,53,25],[66,28,53,26,"message"],[66,35,53,33],[67,6,55,4],[67,10,55,8,"message"],[67,17,55,15],[67,18,55,16,"id"],[67,20,55,18],[67,22,55,20,"state"],[67,27,55,25],[67,28,55,26,"responseId"],[67,38,55,36],[67,41,55,39,"message"],[67,48,55,46],[67,49,55,47,"id"],[67,51,55,49],[68,6,56,4],[68,10,56,8,"message"],[68,17,56,15],[68,18,56,16,"model"],[68,23,56,21],[68,25,56,23,"state"],[68,30,56,28],[68,31,56,29,"responseModel"],[68,44,56,42],[68,47,56,45,"message"],[68,54,56,52],[68,55,56,53,"model"],[68,60,56,58],[69,6,57,4],[69,10,57,8,"message"],[69,17,57,15],[69,18,57,16,"stop_reason"],[69,29,57,27],[69,31,57,29,"state"],[69,36,57,34],[69,37,57,35,"finishReasons"],[69,50,57,48],[69,51,57,49,"push"],[69,55,57,53],[69,56,57,54,"message"],[69,63,57,61],[69,64,57,62,"stop_reason"],[69,75,57,73],[69,76,57,74],[70,6,59,4],[70,10,59,8,"message"],[70,17,59,15],[70,18,59,16,"usage"],[70,23,59,21],[70,25,59,23],[71,8,60,6],[71,12,60,10],[71,19,60,17,"message"],[71,26,60,24],[71,27,60,25,"usage"],[71,32,60,30],[71,33,60,31,"input_tokens"],[71,45,60,43],[71,50,60,48],[71,58,60,56],[71,60,60,58,"state"],[71,65,60,63],[71,66,60,64,"promptTokens"],[71,78,60,76],[71,81,60,79,"message"],[71,88,60,86],[71,89,60,87,"usage"],[71,94,60,92],[71,95,60,93,"input_tokens"],[71,107,60,105],[72,8,61,6],[72,12,61,10],[72,19,61,17,"message"],[72,26,61,24],[72,27,61,25,"usage"],[72,32,61,30],[72,33,61,31,"cache_creation_input_tokens"],[72,60,61,58],[72,65,61,63],[72,73,61,71],[72,75,62,8,"state"],[72,80,62,13],[72,81,62,14,"cacheCreationInputTokens"],[72,105,62,38],[72,108,62,41,"message"],[72,115,62,48],[72,116,62,49,"usage"],[72,121,62,54],[72,122,62,55,"cache_creation_input_tokens"],[72,149,62,82],[73,8,63,6],[73,12,63,10],[73,19,63,17,"message"],[73,26,63,24],[73,27,63,25,"usage"],[73,32,63,30],[73,33,63,31,"cache_read_input_tokens"],[73,56,63,54],[73,61,63,59],[73,69,63,67],[73,71,64,8,"state"],[73,76,64,13],[73,77,64,14,"cacheReadInputTokens"],[73,97,64,34],[73,100,64,37,"message"],[73,107,64,44],[73,108,64,45,"usage"],[73,113,64,50],[73,114,64,51,"cache_read_input_tokens"],[73,137,64,74],[74,6,65,4],[75,4,66,2],[76,2,67,0],[78,2,69,0],[79,0,70,0],[80,0,71,0],[81,2,72,0],[81,11,72,9,"handleContentBlockStart"],[81,34,72,32,"handleContentBlockStart"],[81,35,72,33,"event"],[81,40,72,38],[81,42,72,40,"state"],[81,47,72,45],[81,49,72,47],[82,4,73,2],[82,8,73,6,"event"],[82,13,73,11],[82,14,73,12,"type"],[82,18,73,16],[82,23,73,21],[82,44,73,42],[82,48,73,46],[82,55,73,53,"event"],[82,60,73,58],[82,61,73,59,"index"],[82,66,73,64],[82,71,73,69],[82,79,73,77],[82,83,73,81],[82,84,73,82,"event"],[82,89,73,87],[82,90,73,88,"content_block"],[82,103,73,101],[82,105,73,103],[83,4,74,2],[83,8,74,6,"event"],[83,13,74,11],[83,14,74,12,"content_block"],[83,27,74,25],[83,28,74,26,"type"],[83,32,74,30],[83,37,74,35],[83,47,74,45],[83,51,74,49,"event"],[83,56,74,54],[83,57,74,55,"content_block"],[83,70,74,68],[83,71,74,69,"type"],[83,75,74,73],[83,80,74,78],[83,97,74,95],[83,99,74,97],[84,6,75,4,"state"],[84,11,75,9],[84,12,75,10,"activeToolBlocks"],[84,28,75,26],[84,29,75,27,"event"],[84,34,75,32],[84,35,75,33,"index"],[84,40,75,38],[84,41,75,39],[84,44,75,42],[85,8,76,6,"id"],[85,10,76,8],[85,12,76,10,"event"],[85,17,76,15],[85,18,76,16,"content_block"],[85,31,76,29],[85,32,76,30,"id"],[85,34,76,32],[86,8,77,6,"name"],[86,12,77,10],[86,14,77,12,"event"],[86,19,77,17],[86,20,77,18,"content_block"],[86,33,77,31],[86,34,77,32,"name"],[86,38,77,36],[87,8,78,6,"inputJsonParts"],[87,22,78,20],[87,24,78,22],[88,6,79,4],[88,7,79,5],[89,4,80,2],[90,2,81,0],[92,2,83,0],[93,0,84,0],[94,0,85,0],[95,2,86,0],[95,11,86,9,"handleContentBlockDelta"],[95,34,86,32,"handleContentBlockDelta"],[95,35,87,2,"event"],[95,40,87,7],[95,42,88,2,"state"],[95,47,88,7],[95,49,89,2,"recordOutputs"],[95,62,89,15],[95,64,90,2],[96,4,91,2],[96,8,91,6,"event"],[96,13,91,11],[96,14,91,12,"type"],[96,18,91,16],[96,23,91,21],[96,44,91,42],[96,48,91,46],[96,49,91,47,"event"],[96,54,91,52],[96,55,91,53,"delta"],[96,60,91,58],[96,62,91,60],[98,4,93,2],[99,4,94,2],[99,8,95,4],[99,15,95,11,"event"],[99,20,95,16],[99,21,95,17,"index"],[99,26,95,22],[99,31,95,27],[99,39,95,35],[99,43,96,4],[99,57,96,18],[99,61,96,22,"event"],[99,66,96,27],[99,67,96,28,"delta"],[99,72,96,33],[99,76,97,4],[99,83,97,11,"event"],[99,88,97,16],[99,89,97,17,"delta"],[99,94,97,22],[99,95,97,23,"partial_json"],[99,107,97,35],[99,112,97,40],[99,120,97,48],[99,122,98,4],[100,6,99,4],[100,12,99,10,"active"],[100,18,99,16],[100,21,99,19,"state"],[100,26,99,24],[100,27,99,25,"activeToolBlocks"],[100,43,99,41],[100,44,99,42,"event"],[100,49,99,47],[100,50,99,48,"index"],[100,55,99,53],[100,56,99,54],[101,6,100,4],[101,10,100,8,"active"],[101,16,100,14],[101,18,100,16],[102,8,101,6,"active"],[102,14,101,12],[102,15,101,13,"inputJsonParts"],[102,29,101,27],[102,30,101,28,"push"],[102,34,101,32],[102,35,101,33,"event"],[102,40,101,38],[102,41,101,39,"delta"],[102,46,101,44],[102,47,101,45,"partial_json"],[102,59,101,57],[102,60,101,58],[103,6,102,4],[104,4,103,2],[106,4,105,2],[107,4,106,2],[107,8,106,6,"recordOutputs"],[107,21,106,19],[107,25,106,23],[107,32,106,30,"event"],[107,37,106,35],[107,38,106,36,"delta"],[107,43,106,41],[107,44,106,42,"text"],[107,48,106,46],[107,53,106,51],[107,61,106,59],[107,63,106,61],[108,6,107,4,"state"],[108,11,107,9],[108,12,107,10,"responseTexts"],[108,25,107,23],[108,26,107,24,"push"],[108,30,107,28],[108,31,107,29,"event"],[108,36,107,34],[108,37,107,35,"delta"],[108,42,107,40],[108,43,107,41,"text"],[108,47,107,45],[108,48,107,46],[109,4,108,2],[110,2,109,0],[112,2,111,0],[113,0,112,0],[114,0,113,0],[115,2,114,0],[115,11,114,9,"handleContentBlockStop"],[115,33,114,31,"handleContentBlockStop"],[115,34,114,32,"event"],[115,39,114,37],[115,41,114,39,"state"],[115,46,114,44],[115,48,114,46],[116,4,115,2],[116,8,115,6,"event"],[116,13,115,11],[116,14,115,12,"type"],[116,18,115,16],[116,23,115,21],[116,43,115,41],[116,47,115,45],[116,54,115,52,"event"],[116,59,115,57],[116,60,115,58,"index"],[116,65,115,63],[116,70,115,68],[116,78,115,76],[116,80,115,78],[117,4,117,2],[117,10,117,8,"active"],[117,16,117,14],[117,19,117,17,"state"],[117,24,117,22],[117,25,117,23,"activeToolBlocks"],[117,41,117,39],[117,42,117,40,"event"],[117,47,117,45],[117,48,117,46,"index"],[117,53,117,51],[117,54,117,52],[118,4,118,2],[118,8,118,6],[118,9,118,7,"active"],[118,15,118,13],[118,17,118,15],[119,4,120,2],[119,10,120,8,"raw"],[119,13,120,11],[119,16,120,14,"active"],[119,22,120,20],[119,23,120,21,"inputJsonParts"],[119,37,120,35],[119,38,120,36,"join"],[119,42,120,40],[119,43,120,41],[119,45,120,43],[119,46,120,44],[120,4,121,2],[120,8,121,6,"parsedInput"],[120,19,121,17],[121,4,123,2],[121,8,123,6],[122,6,124,4,"parsedInput"],[122,17,124,15],[122,20,124,18,"raw"],[122,23,124,21],[122,26,124,24,"JSON"],[122,30,124,28],[122,31,124,29,"parse"],[122,36,124,34],[122,37,124,35,"raw"],[122,40,124,38],[122,41,124,39],[122,44,124,42],[122,45,124,43],[122,46,124,44],[123,4,125,2],[123,5,125,3],[123,6,125,4],[123,12,125,10],[124,6,126,4,"parsedInput"],[124,17,126,15],[124,20,126,18],[125,8,126,20,"__unparsed"],[125,18,126,30],[125,20,126,32,"raw"],[126,6,126,36],[126,7,126,37],[127,4,127,2],[128,4,129,2,"state"],[128,9,129,7],[128,10,129,8,"toolCalls"],[128,19,129,17],[128,20,129,18,"push"],[128,24,129,22],[128,25,129,23],[129,6,130,4,"type"],[129,10,130,8],[129,12,130,10],[129,22,130,20],[130,6,131,4,"id"],[130,8,131,6],[130,10,131,8,"active"],[130,16,131,14],[130,17,131,15,"id"],[130,19,131,17],[131,6,132,4,"name"],[131,10,132,8],[131,12,132,10,"active"],[131,18,132,16],[131,19,132,17,"name"],[131,23,132,21],[132,6,133,4,"input"],[132,11,133,9],[132,13,133,11,"parsedInput"],[133,4,134,2],[133,5,134,3],[133,6,134,4],[135,4,136,2],[136,4,137,2],[136,11,137,9,"state"],[136,16,137,14],[136,17,137,15,"activeToolBlocks"],[136,33,137,31],[136,34,137,32,"event"],[136,39,137,37],[136,40,137,38,"index"],[136,45,137,43],[136,46,137,44],[137,2,138,0],[139,2,140,0],[140,0,141,0],[141,0,142,0],[142,0,143,0],[143,0,144,0],[144,0,145,0],[145,0,146,0],[147,2,148,0],[147,11,148,9,"processEvent"],[147,23,148,21,"processEvent"],[147,24,149,2,"event"],[147,29,149,7],[147,31,150,2,"state"],[147,36,150,7],[147,38,151,2,"recordOutputs"],[147,51,151,15],[147,53,152,2,"span"],[147,57,152,6],[147,59,153,2],[148,4,154,2],[148,8,154,6],[148,10,154,8,"event"],[148,15,154,13],[148,19,154,17],[148,26,154,24,"event"],[148,31,154,29],[148,36,154,34],[148,44,154,42],[148,45,154,43],[148,47,154,45],[149,6,155,4],[150,4,156,2],[151,4,158,2],[151,10,158,8,"isError"],[151,17,158,15],[151,20,158,18,"isErrorEvent"],[151,32,158,30],[151,33,158,31,"event"],[151,38,158,36],[151,40,158,38,"span"],[151,44,158,42],[151,45,158,43],[152,4,159,2],[152,8,159,6,"isError"],[152,15,159,13],[152,17,159,15],[153,4,161,2,"handleMessageMetadata"],[153,25,161,23],[153,26,161,24,"event"],[153,31,161,29],[153,33,161,31,"state"],[153,38,161,36],[153,39,161,37],[155,4,163,2],[156,4,164,2],[157,4,165,2],[158,4,166,2],[159,4,167,2],[160,4,168,2,"handleContentBlockStart"],[160,27,168,25],[160,28,168,26,"event"],[160,33,168,31],[160,35,168,33,"state"],[160,40,168,38],[160,41,168,39],[161,4,169,2,"handleContentBlockDelta"],[161,27,169,25],[161,28,169,26,"event"],[161,33,169,31],[161,35,169,33,"state"],[161,40,169,38],[161,42,169,40,"recordOutputs"],[161,55,169,53],[161,56,169,54],[162,4,170,2,"handleContentBlockStop"],[162,26,170,24],[162,27,170,25,"event"],[162,32,170,30],[162,34,170,32,"state"],[162,39,170,37],[162,40,170,38],[163,2,171,0],[165,2,173,0],[166,0,174,0],[167,0,175,0],[168,0,176,0],[169,0,177,0],[170,2,178,0],[170,18,178,16,"instrumentStream"],[170,34,178,32,"instrumentStream"],[170,35,179,2,"stream"],[170,41,179,8],[170,43,180,2,"span"],[170,47,180,6],[170,49,181,2,"recordOutputs"],[170,62,181,15],[170,64,182,2],[171,4,183,2],[171,10,183,8,"state"],[171,15,183,13],[171,18,183,16],[172,6,184,4,"responseTexts"],[172,19,184,17],[172,21,184,19],[172,23,184,21],[173,6,185,4,"finishReasons"],[173,19,185,17],[173,21,185,19],[173,23,185,21],[174,6,186,4,"responseId"],[174,16,186,14],[174,18,186,16],[174,20,186,18],[175,6,187,4,"responseModel"],[175,19,187,17],[175,21,187,19],[175,23,187,21],[176,6,188,4,"promptTokens"],[176,18,188,16],[176,20,188,18,"undefined"],[176,29,188,27],[177,6,189,4,"completionTokens"],[177,22,189,20],[177,24,189,22,"undefined"],[177,33,189,31],[178,6,190,4,"cacheCreationInputTokens"],[178,30,190,28],[178,32,190,30,"undefined"],[178,41,190,39],[179,6,191,4,"cacheReadInputTokens"],[179,26,191,24],[179,28,191,26,"undefined"],[179,37,191,35],[180,6,192,4,"toolCalls"],[180,15,192,13],[180,17,192,15],[180,19,192,17],[181,6,193,4,"activeToolBlocks"],[181,22,193,20],[181,24,193,22],[181,25,193,23],[182,4,194,2],[182,5,194,3],[183,4,196,2],[183,8,196,6],[184,6,197,4],[184,17,197,15],[184,23,197,21,"event"],[184,28,197,26],[184,32,197,30,"stream"],[184,38,197,36],[184,40,197,38],[185,8,198,6,"processEvent"],[185,20,198,18],[185,21,198,19,"event"],[185,26,198,24],[185,28,198,26,"state"],[185,33,198,31],[185,35,198,33,"recordOutputs"],[185,48,198,46],[185,50,198,48,"span"],[185,54,198,52],[185,55,198,53],[186,8,199,6],[186,14,199,12,"event"],[186,19,199,17],[187,6,200,4],[188,4,201,2],[188,5,201,3],[188,14,201,12],[189,6,202,4],[190,6,203,4],[190,10,203,8,"state"],[190,15,203,13],[190,16,203,14,"responseId"],[190,26,203,24],[190,28,203,26],[191,8,204,6,"span"],[191,12,204,10],[191,13,204,11,"setAttributes"],[191,26,204,24],[191,27,204,25],[192,10,205,8],[192,11,205,9,"GEN_AI_RESPONSE_ID_ATTRIBUTE"],[192,31,205,37],[192,32,205,37,"GEN_AI_RESPONSE_ID_ATTRIBUTE"],[192,60,205,37],[192,63,205,40,"state"],[192,68,205,45],[192,69,205,46,"responseId"],[193,8,206,6],[193,9,206,7],[193,10,206,8],[194,6,207,4],[195,6,208,4],[195,10,208,8,"state"],[195,15,208,13],[195,16,208,14,"responseModel"],[195,29,208,27],[195,31,208,29],[196,8,209,6,"span"],[196,12,209,10],[196,13,209,11,"setAttributes"],[196,26,209,24],[196,27,209,25],[197,10,210,8],[197,11,210,9,"GEN_AI_RESPONSE_MODEL_ATTRIBUTE"],[197,31,210,40],[197,32,210,40,"GEN_AI_RESPONSE_MODEL_ATTRIBUTE"],[197,63,210,40],[197,66,210,43,"state"],[197,71,210,48],[197,72,210,49,"responseModel"],[198,8,211,6],[198,9,211,7],[198,10,211,8],[199,6,212,4],[200,6,214,4],[200,10,214,4,"setTokenUsageAttributes"],[200,20,214,27],[200,21,214,27,"setTokenUsageAttributes"],[200,44,214,27],[200,46,215,6,"span"],[200,50,215,10],[200,52,216,6,"state"],[200,57,216,11],[200,58,216,12,"promptTokens"],[200,70,216,24],[200,72,217,6,"state"],[200,77,217,11],[200,78,217,12,"completionTokens"],[200,94,217,28],[200,96,218,6,"state"],[200,101,218,11],[200,102,218,12,"cacheCreationInputTokens"],[200,126,218,36],[200,128,219,6,"state"],[200,133,219,11],[200,134,219,12,"cacheReadInputTokens"],[200,154,220,4],[200,155,220,5],[201,6,222,4,"span"],[201,10,222,8],[201,11,222,9,"setAttributes"],[201,24,222,22],[201,25,222,23],[202,8,223,6],[202,9,223,7,"GEN_AI_RESPONSE_STREAMING_ATTRIBUTE"],[202,29,223,42],[202,30,223,42,"GEN_AI_RESPONSE_STREAMING_ATTRIBUTE"],[202,65,223,42],[202,68,223,45],[203,6,224,4],[203,7,224,5],[203,8,224,6],[204,6,226,4],[204,10,226,8,"state"],[204,15,226,13],[204,16,226,14,"finishReasons"],[204,29,226,27],[204,30,226,28,"length"],[204,36,226,34],[204,39,226,37],[204,40,226,38],[204,42,226,40],[205,8,227,6,"span"],[205,12,227,10],[205,13,227,11,"setAttributes"],[205,26,227,24],[205,27,227,25],[206,10,228,8],[206,11,228,9,"GEN_AI_RESPONSE_FINISH_REASONS_ATTRIBUTE"],[206,31,228,49],[206,32,228,49,"GEN_AI_RESPONSE_FINISH_REASONS_ATTRIBUTE"],[206,72,228,49],[206,75,228,52,"JSON"],[206,79,228,56],[206,80,228,57,"stringify"],[206,89,228,66],[206,90,228,67,"state"],[206,95,228,72],[206,96,228,73,"finishReasons"],[206,109,228,86],[207,8,229,6],[207,9,229,7],[207,10,229,8],[208,6,230,4],[209,6,232,4],[209,10,232,8,"recordOutputs"],[209,23,232,21],[209,27,232,25,"state"],[209,32,232,30],[209,33,232,31,"responseTexts"],[209,46,232,44],[209,47,232,45,"length"],[209,53,232,51],[209,56,232,54],[209,57,232,55],[209,59,232,57],[210,8,233,6,"span"],[210,12,233,10],[210,13,233,11,"setAttributes"],[210,26,233,24],[210,27,233,25],[211,10,234,8],[211,11,234,9,"GEN_AI_RESPONSE_TEXT_ATTRIBUTE"],[211,31,234,39],[211,32,234,39,"GEN_AI_RESPONSE_TEXT_ATTRIBUTE"],[211,62,234,39],[211,65,234,42,"state"],[211,70,234,47],[211,71,234,48,"responseTexts"],[211,84,234,61],[211,85,234,62,"join"],[211,89,234,66],[211,90,234,67],[211,92,234,69],[212,8,235,6],[212,9,235,7],[212,10,235,8],[213,6,236,4],[215,6,238,4],[216,6,239,4],[216,10,239,8,"recordOutputs"],[216,23,239,21],[216,27,239,25,"state"],[216,32,239,30],[216,33,239,31,"toolCalls"],[216,42,239,40],[216,43,239,41,"length"],[216,49,239,47],[216,52,239,50],[216,53,239,51],[216,55,239,53],[217,8,240,6,"span"],[217,12,240,10],[217,13,240,11,"setAttributes"],[217,26,240,24],[217,27,240,25],[218,10,241,8],[218,11,241,9,"GEN_AI_RESPONSE_TOOL_CALLS_ATTRIBUTE"],[218,31,241,45],[218,32,241,45,"GEN_AI_RESPONSE_TOOL_CALLS_ATTRIBUTE"],[218,68,241,45],[218,71,241,48,"JSON"],[218,75,241,52],[218,76,241,53,"stringify"],[218,85,241,62],[218,86,241,63,"state"],[218,91,241,68],[218,92,241,69,"toolCalls"],[218,101,241,78],[219,8,242,6],[219,9,242,7],[219,10,242,8],[220,6,243,4],[221,6,245,4,"span"],[221,10,245,8],[221,11,245,9,"end"],[221,14,245,12],[221,15,245,13],[221,16,245,14],[222,4,246,2],[223,2,247,0],[224,0,247,1],[224,3]],"functionMap":{"names":["<global>","isErrorEvent","handleMessageMetadata","handleContentBlockStart","handleContentBlockDelta","handleContentBlockStop","processEvent","instrumentStream"],"mappings":"AAA;ACkB;CDgB;AEQ;CFwB;AGK;CHS;AIK;CJuB;AKK;CLwB;AMU;CNuB;AOO;CPqE"},"hasCjsExports":false},"type":"js/module"}]}