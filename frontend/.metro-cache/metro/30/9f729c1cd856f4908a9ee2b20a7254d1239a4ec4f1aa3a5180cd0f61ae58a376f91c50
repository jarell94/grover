{"dependencies":[],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  Object.defineProperty(exports, \"DEFAULT_RETRY_AFTER\", {\n    enumerable: true,\n    get: function () {\n      return DEFAULT_RETRY_AFTER;\n    }\n  });\n  Object.defineProperty(exports, \"disabledUntil\", {\n    enumerable: true,\n    get: function () {\n      return disabledUntil;\n    }\n  });\n  Object.defineProperty(exports, \"isRateLimited\", {\n    enumerable: true,\n    get: function () {\n      return isRateLimited;\n    }\n  });\n  Object.defineProperty(exports, \"parseRetryAfterHeader\", {\n    enumerable: true,\n    get: function () {\n      return parseRetryAfterHeader;\n    }\n  });\n  Object.defineProperty(exports, \"updateRateLimits\", {\n    enumerable: true,\n    get: function () {\n      return updateRateLimits;\n    }\n  });\n  // Intentionally keeping the key broad, as we don't know for sure what rate limit headers get returned from backend\n\n  const DEFAULT_RETRY_AFTER = 60 * 1000; // 60 seconds\n\n  /**\n   * Extracts Retry-After value from the request header or returns default value\n   * @param header string representation of 'Retry-After' header\n   * @param now current unix timestamp\n   *\n   */\n  function parseRetryAfterHeader(header, now = Date.now()) {\n    const headerDelay = parseInt(`${header}`, 10);\n    if (!isNaN(headerDelay)) {\n      return headerDelay * 1000;\n    }\n    const headerDate = Date.parse(`${header}`);\n    if (!isNaN(headerDate)) {\n      return headerDate - now;\n    }\n    return DEFAULT_RETRY_AFTER;\n  }\n\n  /**\n   * Gets the time that the given category is disabled until for rate limiting.\n   * In case no category-specific limit is set but a general rate limit across all categories is active,\n   * that time is returned.\n   *\n   * @return the time in ms that the category is disabled until or 0 if there's no active rate limit.\n   */\n  function disabledUntil(limits, dataCategory) {\n    return limits[dataCategory] || limits.all || 0;\n  }\n\n  /**\n   * Checks if a category is rate limited\n   */\n  function isRateLimited(limits, dataCategory, now = Date.now()) {\n    return disabledUntil(limits, dataCategory) > now;\n  }\n\n  /**\n   * Update ratelimits from incoming headers.\n   *\n   * @return the updated RateLimits object.\n   */\n  function updateRateLimits(limits, {\n    statusCode,\n    headers\n  }, now = Date.now()) {\n    const updatedRateLimits = Object.assign({}, limits);\n\n    // \"The name is case-insensitive.\"\n    // https://developer.mozilla.org/en-US/docs/Web/API/Headers/get\n    const rateLimitHeader = headers?.['x-sentry-rate-limits'];\n    const retryAfterHeader = headers?.['retry-after'];\n    if (rateLimitHeader) {\n      /**\n       * rate limit headers are of the form\n       *     <header>,<header>,..\n       * where each <header> is of the form\n       *     <retry_after>: <categories>: <scope>: <reason_code>: <namespaces>\n       * where\n       *     <retry_after> is a delay in seconds\n       *     <categories> is the event type(s) (error, transaction, etc) being rate limited and is of the form\n       *         <category>;<category>;...\n       *     <scope> is what's being limited (org, project, or key) - ignored by SDK\n       *     <reason_code> is an arbitrary string like \"org_quota\" - ignored by SDK\n       *     <namespaces> Semicolon-separated list of metric namespace identifiers. Defines which namespace(s) will be affected.\n       *         Only present if rate limit applies to the metric_bucket data category.\n       */\n      for (const limit of rateLimitHeader.trim().split(',')) {\n        const [retryAfter, categories,,, namespaces] = limit.split(':', 5);\n        const headerDelay = parseInt(retryAfter, 10);\n        const delay = (!isNaN(headerDelay) ? headerDelay : 60) * 1000; // 60sec default\n        if (!categories) {\n          updatedRateLimits.all = now + delay;\n        } else {\n          for (const category of categories.split(';')) {\n            if (category === 'metric_bucket') {\n              // namespaces will be present when category === 'metric_bucket'\n              if (!namespaces || namespaces.split(';').includes('custom')) {\n                updatedRateLimits[category] = now + delay;\n              }\n            } else {\n              updatedRateLimits[category] = now + delay;\n            }\n          }\n        }\n      }\n    } else if (retryAfterHeader) {\n      updatedRateLimits.all = now + parseRetryAfterHeader(retryAfterHeader, now);\n    } else if (statusCode === 429) {\n      updatedRateLimits.all = now + 60 * 1000;\n    }\n    return updatedRateLimits;\n  }\n});","lineCount":133,"map":[[7,2,105,0,"Object"],[7,8,105,0],[7,9,105,0,"defineProperty"],[7,23,105,0],[7,24,105,0,"exports"],[7,31,105,0],[8,4,105,0,"enumerable"],[8,14,105,0],[9,4,105,0,"get"],[9,7,105,0],[9,18,105,0,"get"],[9,19,105,0],[10,6,105,0],[10,13,105,9,"DEFAULT_RETRY_AFTER"],[10,32,105,28],[11,4,105,28],[12,2,105,28],[13,2,105,0,"Object"],[13,8,105,0],[13,9,105,0,"defineProperty"],[13,23,105,0],[13,24,105,0,"exports"],[13,31,105,0],[14,4,105,0,"enumerable"],[14,14,105,0],[15,4,105,0,"get"],[15,7,105,0],[15,18,105,0,"get"],[15,19,105,0],[16,6,105,0],[16,13,105,30,"disabledUntil"],[16,26,105,43],[17,4,105,43],[18,2,105,43],[19,2,105,0,"Object"],[19,8,105,0],[19,9,105,0,"defineProperty"],[19,23,105,0],[19,24,105,0,"exports"],[19,31,105,0],[20,4,105,0,"enumerable"],[20,14,105,0],[21,4,105,0,"get"],[21,7,105,0],[21,18,105,0,"get"],[21,19,105,0],[22,6,105,0],[22,13,105,45,"isRateLimited"],[22,26,105,58],[23,4,105,58],[24,2,105,58],[25,2,105,0,"Object"],[25,8,105,0],[25,9,105,0,"defineProperty"],[25,23,105,0],[25,24,105,0,"exports"],[25,31,105,0],[26,4,105,0,"enumerable"],[26,14,105,0],[27,4,105,0,"get"],[27,7,105,0],[27,18,105,0,"get"],[27,19,105,0],[28,6,105,0],[28,13,105,60,"parseRetryAfterHeader"],[28,34,105,81],[29,4,105,81],[30,2,105,81],[31,2,105,0,"Object"],[31,8,105,0],[31,9,105,0,"defineProperty"],[31,23,105,0],[31,24,105,0,"exports"],[31,31,105,0],[32,4,105,0,"enumerable"],[32,14,105,0],[33,4,105,0,"get"],[33,7,105,0],[33,18,105,0,"get"],[33,19,105,0],[34,6,105,0],[34,13,105,83,"updateRateLimits"],[34,29,105,99],[35,4,105,99],[36,2,105,99],[37,2,1,0],[39,2,3,0],[39,8,3,6,"DEFAULT_RETRY_AFTER"],[39,27,3,25],[39,30,3,28],[39,32,3,30],[39,35,3,33],[39,39,3,37],[39,40,3,38],[39,41,3,39],[41,2,5,0],[42,0,6,0],[43,0,7,0],[44,0,8,0],[45,0,9,0],[46,0,10,0],[47,2,11,0],[47,11,11,9,"parseRetryAfterHeader"],[47,32,11,30,"parseRetryAfterHeader"],[47,33,11,31,"header"],[47,39,11,37],[47,41,11,39,"now"],[47,44,11,42],[47,47,11,45,"Date"],[47,51,11,49],[47,52,11,50,"now"],[47,55,11,53],[47,56,11,54],[47,57,11,55],[47,59,11,57],[48,4,12,2],[48,10,12,8,"headerDelay"],[48,21,12,19],[48,24,12,22,"parseInt"],[48,32,12,30],[48,33,12,31],[48,36,12,34,"header"],[48,42,12,40],[48,44,12,42],[48,46,12,44],[48,48,12,46],[48,49,12,47],[49,4,13,2],[49,8,13,6],[49,9,13,7,"isNaN"],[49,14,13,12],[49,15,13,13,"headerDelay"],[49,26,13,24],[49,27,13,25],[49,29,13,27],[50,6,14,4],[50,13,14,11,"headerDelay"],[50,24,14,22],[50,27,14,25],[50,31,14,29],[51,4,15,2],[52,4,17,2],[52,10,17,8,"headerDate"],[52,20,17,18],[52,23,17,21,"Date"],[52,27,17,25],[52,28,17,26,"parse"],[52,33,17,31],[52,34,17,32],[52,37,17,35,"header"],[52,43,17,41],[52,45,17,43],[52,46,17,44],[53,4,18,2],[53,8,18,6],[53,9,18,7,"isNaN"],[53,14,18,12],[53,15,18,13,"headerDate"],[53,25,18,23],[53,26,18,24],[53,28,18,26],[54,6,19,4],[54,13,19,11,"headerDate"],[54,23,19,21],[54,26,19,24,"now"],[54,29,19,27],[55,4,20,2],[56,4,22,2],[56,11,22,9,"DEFAULT_RETRY_AFTER"],[56,30,22,28],[57,2,23,0],[59,2,25,0],[60,0,26,0],[61,0,27,0],[62,0,28,0],[63,0,29,0],[64,0,30,0],[65,0,31,0],[66,2,32,0],[66,11,32,9,"disabledUntil"],[66,24,32,22,"disabledUntil"],[66,25,32,23,"limits"],[66,31,32,29],[66,33,32,31,"dataCategory"],[66,45,32,43],[66,47,32,45],[67,4,33,2],[67,11,33,9,"limits"],[67,17,33,15],[67,18,33,16,"dataCategory"],[67,30,33,28],[67,31,33,29],[67,35,33,33,"limits"],[67,41,33,39],[67,42,33,40,"all"],[67,45,33,43],[67,49,33,47],[67,50,33,48],[68,2,34,0],[70,2,36,0],[71,0,37,0],[72,0,38,0],[73,2,39,0],[73,11,39,9,"isRateLimited"],[73,24,39,22,"isRateLimited"],[73,25,39,23,"limits"],[73,31,39,29],[73,33,39,31,"dataCategory"],[73,45,39,43],[73,47,39,45,"now"],[73,50,39,48],[73,53,39,51,"Date"],[73,57,39,55],[73,58,39,56,"now"],[73,61,39,59],[73,62,39,60],[73,63,39,61],[73,65,39,63],[74,4,40,2],[74,11,40,9,"disabledUntil"],[74,24,40,22],[74,25,40,23,"limits"],[74,31,40,29],[74,33,40,31,"dataCategory"],[74,45,40,43],[74,46,40,44],[74,49,40,47,"now"],[74,52,40,50],[75,2,41,0],[77,2,43,0],[78,0,44,0],[79,0,45,0],[80,0,46,0],[81,0,47,0],[82,2,48,0],[82,11,48,9,"updateRateLimits"],[82,27,48,25,"updateRateLimits"],[82,28,49,2,"limits"],[82,34,49,8],[82,36,50,2],[83,4,50,4,"statusCode"],[83,14,50,14],[84,4,50,16,"headers"],[85,2,50,24],[85,3,50,25],[85,5,51,2,"now"],[85,8,51,5],[85,11,51,8,"Date"],[85,15,51,12],[85,16,51,13,"now"],[85,19,51,16],[85,20,51,17],[85,21,51,18],[85,23,52,2],[86,4,53,2],[86,10,53,8,"updatedRateLimits"],[86,27,53,25],[86,30,53,25,"Object"],[86,36,53,25],[86,37,53,25,"assign"],[86,43,53,25],[86,48,54,7,"limits"],[86,54,54,13],[86,55,55,3],[88,4,57,2],[89,4,58,2],[90,4,59,2],[90,10,59,8,"rateLimitHeader"],[90,25,59,23],[90,28,59,26,"headers"],[90,35,59,33],[90,38,59,36],[90,60,59,58],[90,61,59,59],[91,4,60,2],[91,10,60,8,"retryAfterHeader"],[91,26,60,24],[91,29,60,27,"headers"],[91,36,60,34],[91,39,60,37],[91,52,60,50],[91,53,60,51],[92,4,62,2],[92,8,62,6,"rateLimitHeader"],[92,23,62,21],[92,25,62,23],[93,6,63,4],[94,0,64,0],[95,0,65,0],[96,0,66,0],[97,0,67,0],[98,0,68,0],[99,0,69,0],[100,0,70,0],[101,0,71,0],[102,0,72,0],[103,0,73,0],[104,0,74,0],[105,0,75,0],[106,0,76,0],[107,6,77,4],[107,11,77,9],[107,17,77,15,"limit"],[107,22,77,20],[107,26,77,24,"rateLimitHeader"],[107,41,77,39],[107,42,77,40,"trim"],[107,46,77,44],[107,47,77,45],[107,48,77,46],[107,49,77,47,"split"],[107,54,77,52],[107,55,77,53],[107,58,77,56],[107,59,77,57],[107,61,77,59],[108,8,78,6],[108,14,78,12],[108,15,78,13,"retryAfter"],[108,25,78,23],[108,27,78,25,"categories"],[108,37,78,35],[108,41,78,41,"namespaces"],[108,51,78,51],[108,52,78,52],[108,55,78,55,"limit"],[108,60,78,60],[108,61,78,61,"split"],[108,66,78,66],[108,67,78,67],[108,70,78,70],[108,72,78,72],[108,73,78,73],[108,74,78,74],[109,8,79,6],[109,14,79,12,"headerDelay"],[109,25,79,23],[109,28,79,26,"parseInt"],[109,36,79,34],[109,37,79,35,"retryAfter"],[109,47,79,45],[109,49,79,47],[109,51,79,49],[109,52,79,50],[110,8,80,6],[110,14,80,12,"delay"],[110,19,80,17],[110,22,80,20],[110,23,80,21],[110,24,80,22,"isNaN"],[110,29,80,27],[110,30,80,28,"headerDelay"],[110,41,80,39],[110,42,80,40],[110,45,80,43,"headerDelay"],[110,56,80,54],[110,59,80,57],[110,61,80,59],[110,65,80,63],[110,69,80,67],[110,70,80,68],[110,71,80,69],[111,8,81,6],[111,12,81,10],[111,13,81,11,"categories"],[111,23,81,21],[111,25,81,23],[112,10,82,8,"updatedRateLimits"],[112,27,82,25],[112,28,82,26,"all"],[112,31,82,29],[112,34,82,32,"now"],[112,37,82,35],[112,40,82,38,"delay"],[112,45,82,43],[113,8,83,6],[113,9,83,7],[113,15,83,13],[114,10,84,8],[114,15,84,13],[114,21,84,19,"category"],[114,29,84,27],[114,33,84,31,"categories"],[114,43,84,41],[114,44,84,42,"split"],[114,49,84,47],[114,50,84,48],[114,53,84,51],[114,54,84,52],[114,56,84,54],[115,12,85,10],[115,16,85,14,"category"],[115,24,85,22],[115,29,85,27],[115,44,85,42],[115,46,85,44],[116,14,86,12],[117,14,87,12],[117,18,87,16],[117,19,87,17,"namespaces"],[117,29,87,27],[117,33,87,31,"namespaces"],[117,43,87,41],[117,44,87,42,"split"],[117,49,87,47],[117,50,87,48],[117,53,87,51],[117,54,87,52],[117,55,87,53,"includes"],[117,63,87,61],[117,64,87,62],[117,72,87,70],[117,73,87,71],[117,75,87,73],[118,16,88,14,"updatedRateLimits"],[118,33,88,31],[118,34,88,32,"category"],[118,42,88,40],[118,43,88,41],[118,46,88,44,"now"],[118,49,88,47],[118,52,88,50,"delay"],[118,57,88,55],[119,14,89,12],[120,12,90,10],[120,13,90,11],[120,19,90,17],[121,14,91,12,"updatedRateLimits"],[121,31,91,29],[121,32,91,30,"category"],[121,40,91,38],[121,41,91,39],[121,44,91,42,"now"],[121,47,91,45],[121,50,91,48,"delay"],[121,55,91,53],[122,12,92,10],[123,10,93,8],[124,8,94,6],[125,6,95,4],[126,4,96,2],[126,5,96,3],[126,11,96,9],[126,15,96,13,"retryAfterHeader"],[126,31,96,29],[126,33,96,31],[127,6,97,4,"updatedRateLimits"],[127,23,97,21],[127,24,97,22,"all"],[127,27,97,25],[127,30,97,28,"now"],[127,33,97,31],[127,36,97,34,"parseRetryAfterHeader"],[127,57,97,55],[127,58,97,56,"retryAfterHeader"],[127,74,97,72],[127,76,97,74,"now"],[127,79,97,77],[127,80,97,78],[128,4,98,2],[128,5,98,3],[128,11,98,9],[128,15,98,13,"statusCode"],[128,25,98,23],[128,30,98,28],[128,33,98,31],[128,35,98,33],[129,6,99,4,"updatedRateLimits"],[129,23,99,21],[129,24,99,22,"all"],[129,27,99,25],[129,30,99,28,"now"],[129,33,99,31],[129,36,99,34],[129,38,99,36],[129,41,99,39],[129,45,99,43],[130,4,100,2],[131,4,102,2],[131,11,102,9,"updatedRateLimits"],[131,28,102,26],[132,2,103,0],[133,0,103,1],[133,3]],"functionMap":{"names":["<global>","parseRetryAfterHeader","disabledUntil","isRateLimited","updateRateLimits"],"mappings":"AAA;ACU;CDY;AES;CFE;AGK;CHE;AIO;CJuD"},"hasCjsExports":false},"type":"js/module"}]}