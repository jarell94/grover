{"dependencies":[{"name":"./is.js","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":37,"index":37}}],"key":"C6fLnEQPNIdj7xXbougAJ0zoinA=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  Object.defineProperty(exports, \"handleCallbackErrors\", {\n    enumerable: true,\n    get: function () {\n      return handleCallbackErrors;\n    }\n  });\n  var _isJs = require(_dependencyMap[0], \"./is.js\");\n  /**\n   * Wrap a callback function with error handling.\n   * If an error is thrown, it will be passed to the `onError` callback and re-thrown.\n   *\n   * If the return value of the function is a promise, it will be handled with `maybeHandlePromiseRejection`.\n   *\n   * If an `onFinally` callback is provided, this will be called when the callback has finished\n   * - so if it returns a promise, once the promise resolved/rejected,\n   * else once the callback has finished executing.\n   * The `onFinally` callback will _always_ be called, no matter if an error was thrown or not.\n   */\n  function handleCallbackErrors(fn, onError, onFinally = () => {}) {\n    let maybePromiseResult;\n    try {\n      maybePromiseResult = fn();\n    } catch (e) {\n      onError(e);\n      onFinally();\n      throw e;\n    }\n    return maybeHandlePromiseRejection(maybePromiseResult, onError, onFinally);\n  }\n\n  /**\n   * Maybe handle a promise rejection.\n   * This expects to be given a value that _may_ be a promise, or any other value.\n   * If it is a promise, and it rejects, it will call the `onError` callback.\n   * Other than this, it will generally return the given value as-is.\n   */\n  function maybeHandlePromiseRejection(value, onError, onFinally) {\n    if ((0, _isJs.isThenable)(value)) {\n      // @ts-expect-error - the isThenable check returns the \"wrong\" type here\n      return value.then(res => {\n        onFinally();\n        return res;\n      }, e => {\n        onError(e);\n        onFinally();\n        throw e;\n      });\n    }\n    onFinally();\n    return value;\n  }\n});","lineCount":58,"map":[[7,2,59,0,"Object"],[7,8,59,0],[7,9,59,0,"defineProperty"],[7,23,59,0],[7,24,59,0,"exports"],[7,31,59,0],[8,4,59,0,"enumerable"],[8,14,59,0],[9,4,59,0,"get"],[9,7,59,0],[9,18,59,0,"get"],[9,19,59,0],[10,6,59,0],[10,13,59,9,"handleCallbackErrors"],[10,33,59,29],[11,4,59,29],[12,2,59,29],[13,2,1,0],[13,6,1,0,"_isJs"],[13,11,1,0],[13,14,1,0,"require"],[13,21,1,0],[13,22,1,0,"_dependencyMap"],[13,36,1,0],[14,2,3,0],[15,0,4,0],[16,0,5,0],[17,0,6,0],[18,0,7,0],[19,0,8,0],[20,0,9,0],[21,0,10,0],[22,0,11,0],[23,0,12,0],[24,0,13,0],[25,2,14,0],[25,11,14,9,"handleCallbackErrors"],[25,31,14,29,"handleCallbackErrors"],[25,32,16,1,"fn"],[25,34,16,3],[25,36,16,5,"onError"],[25,43,16,12],[25,45,16,14,"onFinally"],[25,54,16,23],[25,57,16,26,"onFinally"],[25,58,16,26],[25,63,16,32],[25,64,16,33],[25,65,16,34],[25,67,16,36],[26,4,17,2],[26,8,17,6,"maybePromiseResult"],[26,26,17,24],[27,4,18,2],[27,8,18,6],[28,6,19,4,"maybePromiseResult"],[28,24,19,22],[28,27,19,25,"fn"],[28,29,19,27],[28,30,19,28],[28,31,19,29],[29,4,20,2],[29,5,20,3],[29,6,20,4],[29,13,20,11,"e"],[29,14,20,12],[29,16,20,14],[30,6,21,4,"onError"],[30,13,21,11],[30,14,21,12,"e"],[30,15,21,13],[30,16,21,14],[31,6,22,4,"onFinally"],[31,15,22,13],[31,16,22,14],[31,17,22,15],[32,6,23,4],[32,12,23,10,"e"],[32,13,23,11],[33,4,24,2],[34,4,26,2],[34,11,26,9,"maybeHandlePromiseRejection"],[34,38,26,36],[34,39,26,37,"maybePromiseResult"],[34,57,26,55],[34,59,26,57,"onError"],[34,66,26,64],[34,68,26,66,"onFinally"],[34,77,26,75],[34,78,26,76],[35,2,27,0],[37,2,29,0],[38,0,30,0],[39,0,31,0],[40,0,32,0],[41,0,33,0],[42,0,34,0],[43,2,35,0],[43,11,35,9,"maybeHandlePromiseRejection"],[43,38,35,36,"maybeHandlePromiseRejection"],[43,39,36,2,"value"],[43,44,36,7],[43,46,37,2,"onError"],[43,53,37,9],[43,55,38,2,"onFinally"],[43,64,38,11],[43,66,39,2],[44,4,40,2],[44,8,40,6],[44,12,40,6,"isThenable"],[44,17,40,16],[44,18,40,16,"isThenable"],[44,28,40,16],[44,30,40,17,"value"],[44,35,40,22],[44,36,40,23],[44,38,40,25],[45,6,41,4],[46,6,42,4],[46,13,42,11,"value"],[46,18,42,16],[46,19,42,17,"then"],[46,23,42,21],[46,24,43,6,"res"],[46,27,43,9],[46,31,43,13],[47,8,44,8,"onFinally"],[47,17,44,17],[47,18,44,18],[47,19,44,19],[48,8,45,8],[48,15,45,15,"res"],[48,18,45,18],[49,6,46,6],[49,7,46,7],[49,9,47,6,"e"],[49,10,47,7],[49,14,47,11],[50,8,48,8,"onError"],[50,15,48,15],[50,16,48,16,"e"],[50,17,48,17],[50,18,48,18],[51,8,49,8,"onFinally"],[51,17,49,17],[51,18,49,18],[51,19,49,19],[52,8,50,8],[52,14,50,14,"e"],[52,15,50,15],[53,6,51,6],[53,7,52,4],[53,8,52,5],[54,4,53,2],[55,4,55,2,"onFinally"],[55,13,55,11],[55,14,55,12],[55,15,55,13],[56,4,56,2],[56,11,56,9,"value"],[56,16,56,14],[57,2,57,0],[58,0,57,1],[58,3]],"functionMap":{"names":["<global>","handleCallbackErrors","<anonymous>","maybeHandlePromiseRejection","value.then$argument_0","value.then$argument_1"],"mappings":"AAA;ACa;0BCE,QD;CDW;AGQ;MCQ;ODG;MEC;OFI;CHM"},"hasCjsExports":false},"type":"js/module"}]}