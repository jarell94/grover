{"dependencies":[],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  Object.defineProperty(exports, \"AsyncExpiringMap\", {\n    enumerable: true,\n    get: function () {\n      return AsyncExpiringMap;\n    }\n  });\n  /**\n   * A Map that automatically removes entries after their TTL has expired.\n   *\n   * The map is Promise-aware, meaning it will start TTL countdown only after the promise has resolved.\n   */\n  class AsyncExpiringMap {\n    constructor({\n      cleanupInterval = 5000,\n      ttl = 2000\n    } = {}) {\n      this._ttl = ttl;\n      this._map = new Map();\n      this._cleanupIntervalMs = cleanupInterval;\n      this.startCleanup();\n    }\n    /**\n     * Set a key-value pair.\n     */\n    set(key, promise) {\n      if (!this._cleanupInterval) {\n        this.startCleanup();\n      }\n      if (typeof promise !== 'object' || !promise || !('then' in promise)) {\n        this._map.set(key, {\n          value: promise,\n          expiresAt: Date.now() + this._ttl,\n          promise: null\n        });\n        return;\n      }\n      const entry = {\n        value: undefined,\n        expiresAt: null,\n        promise\n      };\n      this._map.set(key, entry);\n      promise.then(value => {\n        entry.value = value;\n        entry.expiresAt = Date.now() + this._ttl;\n        entry.promise = null;\n      }, () => {\n        entry.expiresAt = Date.now() + this._ttl;\n        entry.promise = null;\n      });\n    }\n    /**\n     * Pops a key-value pair.\n     */\n    pop(key) {\n      const entry = this.get(key);\n      this._map.delete(key);\n      return entry;\n    }\n    /**\n     * Get a value by key.\n     *\n     * If the values is expired it will be returned and removed from the map.\n     */\n    get(key) {\n      const entry = this._map.get(key);\n      if (!entry) {\n        return undefined;\n      }\n      if (entry.promise) {\n        return entry.promise;\n      }\n      if (entry.expiresAt && entry.expiresAt <= Date.now()) {\n        this._map.delete(key);\n      }\n      return entry.value;\n    }\n    /**\n     * Check if a key exists in the map.\n     *\n     * If the key is expired it's not present in the map.\n     */\n    has(key) {\n      const entry = this._map.get(key);\n      if (!entry) {\n        return false;\n      }\n      if (entry.promise) {\n        return true;\n      }\n      if (entry.expiresAt && entry.expiresAt <= Date.now()) {\n        this._map.delete(key);\n        return false;\n      }\n      return true;\n    }\n    /**\n     * Get the remaining time to live of a key.\n     */\n    ttl(key) {\n      const entry = this._map.get(key);\n      if (entry === null || entry === void 0 ? void 0 : entry.expiresAt) {\n        const remainingTime = entry.expiresAt - Date.now();\n        return remainingTime > 0 ? remainingTime : 0;\n      }\n      return undefined;\n    }\n    /**\n     * Remove expired entries.\n     */\n    cleanup() {\n      const now = Date.now();\n      for (const [key, entry] of this._map.entries()) {\n        if (entry.expiresAt && entry.expiresAt <= now) {\n          this._map.delete(key);\n        }\n      }\n      const size = this._map.size;\n      if (!size) {\n        this.stopCleanup();\n      }\n    }\n    /**\n     * Clear all entries.\n     */\n    clear() {\n      if (this._cleanupInterval) {\n        clearInterval(this._cleanupInterval);\n      }\n      this._map.clear();\n    }\n    /**\n     * Stop the cleanup interval.\n     */\n    stopCleanup() {\n      if (this._cleanupInterval) {\n        clearInterval(this._cleanupInterval);\n      }\n    }\n    /**\n     * Start the cleanup interval.\n     */\n    startCleanup() {\n      this._cleanupInterval = setInterval(() => this.cleanup(), this._cleanupIntervalMs);\n    }\n  }\n});","lineCount":153,"map":[[7,2,6,0,"Object"],[7,8,6,0],[7,9,6,0,"defineProperty"],[7,23,6,0],[7,24,6,0,"exports"],[7,31,6,0],[8,4,6,0,"enumerable"],[8,14,6,0],[9,4,6,0,"get"],[9,7,6,0],[9,18,6,0,"get"],[9,19,6,0],[10,6,6,0],[10,13,6,0,"AsyncExpiringMap"],[10,29,6,0],[11,4,6,0],[12,2,6,0],[13,2,1,0],[14,0,2,0],[15,0,3,0],[16,0,4,0],[17,0,5,0],[18,2,6,7],[18,8,6,13,"AsyncExpiringMap"],[18,24,6,29],[18,25,6,30],[19,4,7,4,"constructor"],[19,15,7,15,"constructor"],[19,16,7,16],[20,6,7,18,"cleanupInterval"],[20,21,7,33],[20,24,7,36],[20,28,7,40],[21,6,7,42,"ttl"],[21,9,7,45],[21,12,7,48],[22,4,7,54],[22,5,7,55],[22,8,7,58],[22,9,7,59],[22,10,7,60],[22,12,7,62],[23,6,8,8],[23,10,8,12],[23,11,8,13,"_ttl"],[23,15,8,17],[23,18,8,20,"ttl"],[23,21,8,23],[24,6,9,8],[24,10,9,12],[24,11,9,13,"_map"],[24,15,9,17],[24,18,9,20],[24,22,9,24,"Map"],[24,25,9,27],[24,26,9,28],[24,27,9,29],[25,6,10,8],[25,10,10,12],[25,11,10,13,"_cleanupIntervalMs"],[25,29,10,31],[25,32,10,34,"cleanupInterval"],[25,47,10,49],[26,6,11,8],[26,10,11,12],[26,11,11,13,"startCleanup"],[26,23,11,25],[26,24,11,26],[26,25,11,27],[27,4,12,4],[28,4,13,4],[29,0,14,0],[30,0,15,0],[31,4,16,4,"set"],[31,7,16,7,"set"],[31,8,16,8,"key"],[31,11,16,11],[31,13,16,13,"promise"],[31,20,16,20],[31,22,16,22],[32,6,17,8],[32,10,17,12],[32,11,17,13],[32,15,17,17],[32,16,17,18,"_cleanupInterval"],[32,32,17,34],[32,34,17,36],[33,8,18,12],[33,12,18,16],[33,13,18,17,"startCleanup"],[33,25,18,29],[33,26,18,30],[33,27,18,31],[34,6,19,8],[35,6,20,8],[35,10,20,12],[35,17,20,19,"promise"],[35,24,20,26],[35,29,20,31],[35,37,20,39],[35,41,20,43],[35,42,20,44,"promise"],[35,49,20,51],[35,53,20,55],[35,55,20,57],[35,61,20,63],[35,65,20,67,"promise"],[35,72,20,74],[35,73,20,75],[35,75,20,77],[36,8,21,12],[36,12,21,16],[36,13,21,17,"_map"],[36,17,21,21],[36,18,21,22,"set"],[36,21,21,25],[36,22,21,26,"key"],[36,25,21,29],[36,27,21,31],[37,10,21,33,"value"],[37,15,21,38],[37,17,21,40,"promise"],[37,24,21,47],[38,10,21,49,"expiresAt"],[38,19,21,58],[38,21,21,60,"Date"],[38,25,21,64],[38,26,21,65,"now"],[38,29,21,68],[38,30,21,69],[38,31,21,70],[38,34,21,73],[38,38,21,77],[38,39,21,78,"_ttl"],[38,43,21,82],[39,10,21,84,"promise"],[39,17,21,91],[39,19,21,93],[40,8,21,98],[40,9,21,99],[40,10,21,100],[41,8,22,12],[42,6,23,8],[43,6,24,8],[43,12,24,14,"entry"],[43,17,24,19],[43,20,24,22],[44,8,25,12,"value"],[44,13,25,17],[44,15,25,19,"undefined"],[44,24,25,28],[45,8,26,12,"expiresAt"],[45,17,26,21],[45,19,26,23],[45,23,26,27],[46,8,27,12,"promise"],[47,6,28,8],[47,7,28,9],[48,6,29,8],[48,10,29,12],[48,11,29,13,"_map"],[48,15,29,17],[48,16,29,18,"set"],[48,19,29,21],[48,20,29,22,"key"],[48,23,29,25],[48,25,29,27,"entry"],[48,30,29,32],[48,31,29,33],[49,6,30,8,"promise"],[49,13,30,15],[49,14,30,16,"then"],[49,18,30,20],[49,19,30,21,"value"],[49,24,30,26],[49,28,30,30],[50,8,31,12,"entry"],[50,13,31,17],[50,14,31,18,"value"],[50,19,31,23],[50,22,31,26,"value"],[50,27,31,31],[51,8,32,12,"entry"],[51,13,32,17],[51,14,32,18,"expiresAt"],[51,23,32,27],[51,26,32,30,"Date"],[51,30,32,34],[51,31,32,35,"now"],[51,34,32,38],[51,35,32,39],[51,36,32,40],[51,39,32,43],[51,43,32,47],[51,44,32,48,"_ttl"],[51,48,32,52],[52,8,33,12,"entry"],[52,13,33,17],[52,14,33,18,"promise"],[52,21,33,25],[52,24,33,28],[52,28,33,32],[53,6,34,8],[53,7,34,9],[53,9,34,11],[53,15,34,17],[54,8,35,12,"entry"],[54,13,35,17],[54,14,35,18,"expiresAt"],[54,23,35,27],[54,26,35,30,"Date"],[54,30,35,34],[54,31,35,35,"now"],[54,34,35,38],[54,35,35,39],[54,36,35,40],[54,39,35,43],[54,43,35,47],[54,44,35,48,"_ttl"],[54,48,35,52],[55,8,36,12,"entry"],[55,13,36,17],[55,14,36,18,"promise"],[55,21,36,25],[55,24,36,28],[55,28,36,32],[56,6,37,8],[56,7,37,9],[56,8,37,10],[57,4,38,4],[58,4,39,4],[59,0,40,0],[60,0,41,0],[61,4,42,4,"pop"],[61,7,42,7,"pop"],[61,8,42,8,"key"],[61,11,42,11],[61,13,42,13],[62,6,43,8],[62,12,43,14,"entry"],[62,17,43,19],[62,20,43,22],[62,24,43,26],[62,25,43,27,"get"],[62,28,43,30],[62,29,43,31,"key"],[62,32,43,34],[62,33,43,35],[63,6,44,8],[63,10,44,12],[63,11,44,13,"_map"],[63,15,44,17],[63,16,44,18,"delete"],[63,22,44,24],[63,23,44,25,"key"],[63,26,44,28],[63,27,44,29],[64,6,45,8],[64,13,45,15,"entry"],[64,18,45,20],[65,4,46,4],[66,4,47,4],[67,0,48,0],[68,0,49,0],[69,0,50,0],[70,0,51,0],[71,4,52,4,"get"],[71,7,52,7,"get"],[71,8,52,8,"key"],[71,11,52,11],[71,13,52,13],[72,6,53,8],[72,12,53,14,"entry"],[72,17,53,19],[72,20,53,22],[72,24,53,26],[72,25,53,27,"_map"],[72,29,53,31],[72,30,53,32,"get"],[72,33,53,35],[72,34,53,36,"key"],[72,37,53,39],[72,38,53,40],[73,6,54,8],[73,10,54,12],[73,11,54,13,"entry"],[73,16,54,18],[73,18,54,20],[74,8,55,12],[74,15,55,19,"undefined"],[74,24,55,28],[75,6,56,8],[76,6,57,8],[76,10,57,12,"entry"],[76,15,57,17],[76,16,57,18,"promise"],[76,23,57,25],[76,25,57,27],[77,8,58,12],[77,15,58,19,"entry"],[77,20,58,24],[77,21,58,25,"promise"],[77,28,58,32],[78,6,59,8],[79,6,60,8],[79,10,60,12,"entry"],[79,15,60,17],[79,16,60,18,"expiresAt"],[79,25,60,27],[79,29,60,31,"entry"],[79,34,60,36],[79,35,60,37,"expiresAt"],[79,44,60,46],[79,48,60,50,"Date"],[79,52,60,54],[79,53,60,55,"now"],[79,56,60,58],[79,57,60,59],[79,58,60,60],[79,60,60,62],[80,8,61,12],[80,12,61,16],[80,13,61,17,"_map"],[80,17,61,21],[80,18,61,22,"delete"],[80,24,61,28],[80,25,61,29,"key"],[80,28,61,32],[80,29,61,33],[81,6,62,8],[82,6,63,8],[82,13,63,15,"entry"],[82,18,63,20],[82,19,63,21,"value"],[82,24,63,26],[83,4,64,4],[84,4,65,4],[85,0,66,0],[86,0,67,0],[87,0,68,0],[88,0,69,0],[89,4,70,4,"has"],[89,7,70,7,"has"],[89,8,70,8,"key"],[89,11,70,11],[89,13,70,13],[90,6,71,8],[90,12,71,14,"entry"],[90,17,71,19],[90,20,71,22],[90,24,71,26],[90,25,71,27,"_map"],[90,29,71,31],[90,30,71,32,"get"],[90,33,71,35],[90,34,71,36,"key"],[90,37,71,39],[90,38,71,40],[91,6,72,8],[91,10,72,12],[91,11,72,13,"entry"],[91,16,72,18],[91,18,72,20],[92,8,73,12],[92,15,73,19],[92,20,73,24],[93,6,74,8],[94,6,75,8],[94,10,75,12,"entry"],[94,15,75,17],[94,16,75,18,"promise"],[94,23,75,25],[94,25,75,27],[95,8,76,12],[95,15,76,19],[95,19,76,23],[96,6,77,8],[97,6,78,8],[97,10,78,12,"entry"],[97,15,78,17],[97,16,78,18,"expiresAt"],[97,25,78,27],[97,29,78,31,"entry"],[97,34,78,36],[97,35,78,37,"expiresAt"],[97,44,78,46],[97,48,78,50,"Date"],[97,52,78,54],[97,53,78,55,"now"],[97,56,78,58],[97,57,78,59],[97,58,78,60],[97,60,78,62],[98,8,79,12],[98,12,79,16],[98,13,79,17,"_map"],[98,17,79,21],[98,18,79,22,"delete"],[98,24,79,28],[98,25,79,29,"key"],[98,28,79,32],[98,29,79,33],[99,8,80,12],[99,15,80,19],[99,20,80,24],[100,6,81,8],[101,6,82,8],[101,13,82,15],[101,17,82,19],[102,4,83,4],[103,4,84,4],[104,0,85,0],[105,0,86,0],[106,4,87,4,"ttl"],[106,7,87,7,"ttl"],[106,8,87,8,"key"],[106,11,87,11],[106,13,87,13],[107,6,88,8],[107,12,88,14,"entry"],[107,17,88,19],[107,20,88,22],[107,24,88,26],[107,25,88,27,"_map"],[107,29,88,31],[107,30,88,32,"get"],[107,33,88,35],[107,34,88,36,"key"],[107,37,88,39],[107,38,88,40],[108,6,89,8],[108,10,89,12,"entry"],[108,15,89,17],[108,20,89,22],[108,24,89,26],[108,28,89,30,"entry"],[108,33,89,35],[108,38,89,40],[108,43,89,45],[108,44,89,46],[108,47,89,49],[108,52,89,54],[108,53,89,55],[108,56,89,58,"entry"],[108,61,89,63],[108,62,89,64,"expiresAt"],[108,71,89,73],[108,73,89,75],[109,8,90,12],[109,14,90,18,"remainingTime"],[109,27,90,31],[109,30,90,34,"entry"],[109,35,90,39],[109,36,90,40,"expiresAt"],[109,45,90,49],[109,48,90,52,"Date"],[109,52,90,56],[109,53,90,57,"now"],[109,56,90,60],[109,57,90,61],[109,58,90,62],[110,8,91,12],[110,15,91,19,"remainingTime"],[110,28,91,32],[110,31,91,35],[110,32,91,36],[110,35,91,39,"remainingTime"],[110,48,91,52],[110,51,91,55],[110,52,91,56],[111,6,92,8],[112,6,93,8],[112,13,93,15,"undefined"],[112,22,93,24],[113,4,94,4],[114,4,95,4],[115,0,96,0],[116,0,97,0],[117,4,98,4,"cleanup"],[117,11,98,11,"cleanup"],[117,12,98,11],[117,14,98,14],[118,6,99,8],[118,12,99,14,"now"],[118,15,99,17],[118,18,99,20,"Date"],[118,22,99,24],[118,23,99,25,"now"],[118,26,99,28],[118,27,99,29],[118,28,99,30],[119,6,100,8],[119,11,100,13],[119,17,100,19],[119,18,100,20,"key"],[119,21,100,23],[119,23,100,25,"entry"],[119,28,100,30],[119,29,100,31],[119,33,100,35],[119,37,100,39],[119,38,100,40,"_map"],[119,42,100,44],[119,43,100,45,"entries"],[119,50,100,52],[119,51,100,53],[119,52,100,54],[119,54,100,56],[120,8,101,12],[120,12,101,16,"entry"],[120,17,101,21],[120,18,101,22,"expiresAt"],[120,27,101,31],[120,31,101,35,"entry"],[120,36,101,40],[120,37,101,41,"expiresAt"],[120,46,101,50],[120,50,101,54,"now"],[120,53,101,57],[120,55,101,59],[121,10,102,16],[121,14,102,20],[121,15,102,21,"_map"],[121,19,102,25],[121,20,102,26,"delete"],[121,26,102,32],[121,27,102,33,"key"],[121,30,102,36],[121,31,102,37],[122,8,103,12],[123,6,104,8],[124,6,105,8],[124,12,105,14,"size"],[124,16,105,18],[124,19,105,21],[124,23,105,25],[124,24,105,26,"_map"],[124,28,105,30],[124,29,105,31,"size"],[124,33,105,35],[125,6,106,8],[125,10,106,12],[125,11,106,13,"size"],[125,15,106,17],[125,17,106,19],[126,8,107,12],[126,12,107,16],[126,13,107,17,"stopCleanup"],[126,24,107,28],[126,25,107,29],[126,26,107,30],[127,6,108,8],[128,4,109,4],[129,4,110,4],[130,0,111,0],[131,0,112,0],[132,4,113,4,"clear"],[132,9,113,9,"clear"],[132,10,113,9],[132,12,113,12],[133,6,114,8],[133,10,114,12],[133,14,114,16],[133,15,114,17,"_cleanupInterval"],[133,31,114,33],[133,33,114,35],[134,8,115,12,"clearInterval"],[134,21,115,25],[134,22,115,26],[134,26,115,30],[134,27,115,31,"_cleanupInterval"],[134,43,115,47],[134,44,115,48],[135,6,116,8],[136,6,117,8],[136,10,117,12],[136,11,117,13,"_map"],[136,15,117,17],[136,16,117,18,"clear"],[136,21,117,23],[136,22,117,24],[136,23,117,25],[137,4,118,4],[138,4,119,4],[139,0,120,0],[140,0,121,0],[141,4,122,4,"stopCleanup"],[141,15,122,15,"stopCleanup"],[141,16,122,15],[141,18,122,18],[142,6,123,8],[142,10,123,12],[142,14,123,16],[142,15,123,17,"_cleanupInterval"],[142,31,123,33],[142,33,123,35],[143,8,124,12,"clearInterval"],[143,21,124,25],[143,22,124,26],[143,26,124,30],[143,27,124,31,"_cleanupInterval"],[143,43,124,47],[143,44,124,48],[144,6,125,8],[145,4,126,4],[146,4,127,4],[147,0,128,0],[148,0,129,0],[149,4,130,4,"startCleanup"],[149,16,130,16,"startCleanup"],[149,17,130,16],[149,19,130,19],[150,6,131,8],[150,10,131,12],[150,11,131,13,"_cleanupInterval"],[150,27,131,29],[150,30,131,32,"setInterval"],[150,41,131,43],[150,42,131,44],[150,48,131,50],[150,52,131,54],[150,53,131,55,"cleanup"],[150,60,131,62],[150,61,131,63],[150,62,131,64],[150,64,131,66],[150,68,131,70],[150,69,131,71,"_cleanupIntervalMs"],[150,87,131,89],[150,88,131,90],[151,4,132,4],[152,2,133,0],[153,0,133,1],[153,3]],"functionMap":{"names":["<global>","AsyncExpiringMap","constructor","set","promise.then$argument_0","promise.then$argument_1","pop","get","has","ttl","cleanup","clear","stopCleanup","startCleanup","setInterval$argument_0"],"mappings":"AAA;OCK;ICC;KDK;IEI;qBCc;SDI,EE;SFG;KFC;IKI;KLI;IMM;KNY;IOM;KPa;IQI;KRO;ISI;KTW;IUI;KVK;IWI;KXI;IYI;4CCC,oBD;KZC;CDC"},"hasCjsExports":false},"type":"js/module"}]}