{"dependencies":[{"name":"./polyfills/interactionCountPolyfill.js","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":78,"index":78}}],"key":"0MuBAjXYJzqIS93aKiU6tlqsUTU=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  Object.defineProperty(exports, \"InteractionManager\", {\n    enumerable: true,\n    get: function () {\n      return InteractionManager;\n    }\n  });\n  var _polyfillsInteractionCountPolyfillJs = require(_dependencyMap[0], \"./polyfills/interactionCountPolyfill.js\");\n  /*\n   * Copyright 2024 Google LLC\n   *\n   * Licensed under the Apache License, Version 2.0 (the \"License\");\n   * you may not use this file except in compliance with the License.\n   * You may obtain a copy of the License at\n   *\n   *     https://www.apache.org/licenses/LICENSE-2.0\n   *\n   * Unless required by applicable law or agreed to in writing, software\n   * distributed under the License is distributed on an \"AS IS\" BASIS,\n   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n   * See the License for the specific language governing permissions and\n   * limitations under the License.\n   */\n\n  // To prevent unnecessary memory usage on pages with lots of interactions,\n  // store at most 10 of the longest interactions to consider as INP candidates.\n  const MAX_INTERACTIONS_TO_CONSIDER = 10;\n\n  // Used to store the interaction count after a bfcache restore, since p98\n  // interaction latencies should only consider the current navigation.\n  let prevInteractionCount = 0;\n\n  /**\n   * Returns the interaction count since the last bfcache restore (or for the\n   * full page lifecycle if there were no bfcache restores).\n   */\n  const getInteractionCountForNavigation = () => {\n    return (0, _polyfillsInteractionCountPolyfillJs.getInteractionCount)() - prevInteractionCount;\n  };\n\n  /**\n   *\n   */\n  class InteractionManager {\n    constructor() {\n      InteractionManager.prototype.__init.call(this);\n      InteractionManager.prototype.__init2.call(this);\n    }\n    /**\n     * A list of longest interactions on the page (by latency) sorted so the\n     * longest one is first. The list is at most MAX_INTERACTIONS_TO_CONSIDER\n     * long.\n     */\n    // eslint-disable-next-line @sentry-internal/sdk/no-class-field-initializers, @typescript-eslint/explicit-member-accessibility\n    __init() {\n      this._longestInteractionList = [];\n    }\n\n    /**\n     * A mapping of longest interactions by their interaction ID.\n     * This is used for faster lookup.\n     */\n    // eslint-disable-next-line @sentry-internal/sdk/no-class-field-initializers, @typescript-eslint/explicit-member-accessibility\n    __init2() {\n      this._longestInteractionMap = new Map();\n    }\n\n    // eslint-disable-next-line @typescript-eslint/explicit-member-accessibility\n\n    // eslint-disable-next-line @typescript-eslint/explicit-member-accessibility\n\n    // eslint-disable-next-line @typescript-eslint/explicit-member-accessibility, jsdoc/require-jsdoc\n    _resetInteractions() {\n      prevInteractionCount = (0, _polyfillsInteractionCountPolyfillJs.getInteractionCount)();\n      this._longestInteractionList.length = 0;\n      this._longestInteractionMap.clear();\n    }\n\n    /**\n     * Returns the estimated p98 longest interaction based on the stored\n     * interaction candidates and the interaction count for the current page.\n     */\n    // eslint-disable-next-line @typescript-eslint/explicit-member-accessibility\n    _estimateP98LongestInteraction() {\n      const candidateInteractionIndex = Math.min(this._longestInteractionList.length - 1, Math.floor(getInteractionCountForNavigation() / 50));\n      return this._longestInteractionList[candidateInteractionIndex];\n    }\n\n    /**\n     * Takes a performance entry and adds it to the list of worst interactions\n     * if its duration is long enough to make it among the worst. If the\n     * entry is part of an existing interaction, it is merged and the latency\n     * and entries list is updated as needed.\n     */\n    // eslint-disable-next-line @typescript-eslint/explicit-member-accessibility\n    _processEntry(entry) {\n      this._onBeforeProcessingEntry?.(entry);\n\n      // Skip further processing for entries that cannot be INP candidates.\n      if (!(entry.interactionId || entry.entryType === 'first-input')) return;\n\n      // The least-long of the 10 longest interactions.\n      const minLongestInteraction = this._longestInteractionList.at(-1);\n      let interaction = this._longestInteractionMap.get(entry.interactionId);\n\n      // Only process the entry if it's possibly one of the ten longest,\n      // or if it's part of an existing interaction.\n      if (interaction || this._longestInteractionList.length < MAX_INTERACTIONS_TO_CONSIDER ||\n      // If the above conditions are false, `minLongestInteraction` will be set.\n      entry.duration > minLongestInteraction._latency) {\n        // If the interaction already exists, update it. Otherwise create one.\n        if (interaction) {\n          // If the new entry has a longer duration, replace the old entries,\n          // otherwise add to the array.\n          if (entry.duration > interaction._latency) {\n            interaction.entries = [entry];\n            interaction._latency = entry.duration;\n          } else if (entry.duration === interaction._latency && entry.startTime === interaction.entries[0].startTime) {\n            interaction.entries.push(entry);\n          }\n        } else {\n          interaction = {\n            id: entry.interactionId,\n            entries: [entry],\n            _latency: entry.duration\n          };\n          this._longestInteractionMap.set(interaction.id, interaction);\n          this._longestInteractionList.push(interaction);\n        }\n\n        // Sort the entries by latency (descending) and keep only the top ten.\n        this._longestInteractionList.sort((a, b) => b._latency - a._latency);\n        if (this._longestInteractionList.length > MAX_INTERACTIONS_TO_CONSIDER) {\n          const removedInteractions = this._longestInteractionList.splice(MAX_INTERACTIONS_TO_CONSIDER);\n          for (const interaction of removedInteractions) {\n            this._longestInteractionMap.delete(interaction.id);\n          }\n        }\n\n        // Call any post-processing on the interaction\n        this._onAfterProcessingINPCandidate?.(interaction);\n      }\n    }\n  }\n});","lineCount":150,"map":[[7,2,142,0,"Object"],[7,8,142,0],[7,9,142,0,"defineProperty"],[7,23,142,0],[7,24,142,0,"exports"],[7,31,142,0],[8,4,142,0,"enumerable"],[8,14,142,0],[9,4,142,0,"get"],[9,7,142,0],[9,18,142,0,"get"],[9,19,142,0],[10,6,142,0],[10,13,142,9,"InteractionManager"],[10,31,142,27],[11,4,142,27],[12,2,142,27],[13,2,1,0],[13,6,1,0,"_polyfillsInteractionCountPolyfillJs"],[13,42,1,0],[13,45,1,0,"require"],[13,52,1,0],[13,53,1,0,"_dependencyMap"],[13,67,1,0],[14,2,3,0],[15,0,4,0],[16,0,5,0],[17,0,6,0],[18,0,7,0],[19,0,8,0],[20,0,9,0],[21,0,10,0],[22,0,11,0],[23,0,12,0],[24,0,13,0],[25,0,14,0],[26,0,15,0],[27,0,16,0],[28,0,17,0],[30,2,20,0],[31,2,21,0],[32,2,22,0],[32,8,22,6,"MAX_INTERACTIONS_TO_CONSIDER"],[32,36,22,34],[32,39,22,37],[32,41,22,39],[34,2,24,0],[35,2,25,0],[36,2,26,0],[36,6,26,4,"prevInteractionCount"],[36,26,26,24],[36,29,26,27],[36,30,26,28],[38,2,28,0],[39,0,29,0],[40,0,30,0],[41,0,31,0],[42,2,32,0],[42,8,32,6,"getInteractionCountForNavigation"],[42,40,32,38],[42,43,32,41,"getInteractionCountForNavigation"],[42,44,32,41],[42,49,32,47],[43,4,33,2],[43,11,33,9],[43,15,33,9,"getInteractionCount"],[43,51,33,28],[43,52,33,28,"getInteractionCount"],[43,71,33,28],[43,73,33,29],[43,74,33,30],[43,77,33,33,"prevInteractionCount"],[43,97,33,53],[44,2,34,0],[44,3,34,1],[46,2,36,0],[47,0,37,0],[48,0,38,0],[49,2,39,0],[49,8,39,6,"InteractionManager"],[49,26,39,24],[49,27,39,25],[50,4,39,26,"constructor"],[50,15,39,37,"constructor"],[50,16,39,37],[50,18,39,40],[51,6,39,42,"InteractionManager"],[51,24,39,60],[51,25,39,61,"prototype"],[51,34,39,70],[51,35,39,71,"__init"],[51,41,39,77],[51,42,39,78,"call"],[51,46,39,82],[51,47,39,83],[51,51,39,87],[51,52,39,88],[52,6,39,89,"InteractionManager"],[52,24,39,107],[52,25,39,108,"prototype"],[52,34,39,117],[52,35,39,118,"__init2"],[52,42,39,125],[52,43,39,126,"call"],[52,47,39,130],[52,48,39,131],[52,52,39,135],[52,53,39,136],[53,4,39,138],[54,4,40,2],[55,0,41,0],[56,0,42,0],[57,0,43,0],[58,0,44,0],[59,4,45,2],[60,4,46,2,"__init"],[60,10,46,8,"__init"],[60,11,46,8],[60,13,46,11],[61,6,46,12],[61,10,46,16],[61,11,46,17,"_longestInteractionList"],[61,34,46,40],[61,37,46,43],[61,39,46,45],[62,4,46,46],[64,4,48,2],[65,0,49,0],[66,0,50,0],[67,0,51,0],[68,4,52,2],[69,4,53,2,"__init2"],[69,11,53,9,"__init2"],[69,12,53,9],[69,14,53,12],[70,6,53,13],[70,10,53,17],[70,11,53,18,"_longestInteractionMap"],[70,33,53,40],[70,36,53,43],[70,40,53,47,"Map"],[70,43,53,50],[70,44,53,51],[70,45,53,52],[71,4,53,53],[73,4,55,2],[75,4,57,2],[77,4,59,2],[78,4,60,2,"_resetInteractions"],[78,22,60,20,"_resetInteractions"],[78,23,60,20],[78,25,60,23],[79,6,61,4,"prevInteractionCount"],[79,26,61,24],[79,29,61,27],[79,33,61,27,"getInteractionCount"],[79,69,61,46],[79,70,61,46,"getInteractionCount"],[79,89,61,46],[79,91,61,47],[79,92,61,48],[80,6,62,4],[80,10,62,8],[80,11,62,9,"_longestInteractionList"],[80,34,62,32],[80,35,62,33,"length"],[80,41,62,39],[80,44,62,42],[80,45,62,43],[81,6,63,4],[81,10,63,8],[81,11,63,9,"_longestInteractionMap"],[81,33,63,31],[81,34,63,32,"clear"],[81,39,63,37],[81,40,63,38],[81,41,63,39],[82,4,64,2],[84,4,66,2],[85,0,67,0],[86,0,68,0],[87,0,69,0],[88,4,70,2],[89,4,71,2,"_estimateP98LongestInteraction"],[89,34,71,32,"_estimateP98LongestInteraction"],[89,35,71,32],[89,37,71,35],[90,6,72,4],[90,12,72,10,"candidateInteractionIndex"],[90,37,72,35],[90,40,72,38,"Math"],[90,44,72,42],[90,45,72,43,"min"],[90,48,72,46],[90,49,73,6],[90,53,73,10],[90,54,73,11,"_longestInteractionList"],[90,77,73,34],[90,78,73,35,"length"],[90,84,73,41],[90,87,73,44],[90,88,73,45],[90,90,74,6,"Math"],[90,94,74,10],[90,95,74,11,"floor"],[90,100,74,16],[90,101,74,17,"getInteractionCountForNavigation"],[90,133,74,49],[90,134,74,50],[90,135,74,51],[90,138,74,54],[90,140,74,56],[90,141,75,4],[90,142,75,5],[91,6,77,4],[91,13,77,11],[91,17,77,15],[91,18,77,16,"_longestInteractionList"],[91,41,77,39],[91,42,77,40,"candidateInteractionIndex"],[91,67,77,65],[91,68,77,66],[92,4,78,2],[94,4,80,2],[95,0,81,0],[96,0,82,0],[97,0,83,0],[98,0,84,0],[99,0,85,0],[100,4,86,2],[101,4,87,2,"_processEntry"],[101,17,87,15,"_processEntry"],[101,18,87,16,"entry"],[101,23,87,21],[101,25,87,23],[102,6,88,4],[102,10,88,8],[102,11,88,9,"_onBeforeProcessingEntry"],[102,35,88,33],[102,38,88,36,"entry"],[102,43,88,41],[102,44,88,42],[104,6,90,4],[105,6,91,4],[105,10,91,8],[105,12,91,10,"entry"],[105,17,91,15],[105,18,91,16,"interactionId"],[105,31,91,29],[105,35,91,33,"entry"],[105,40,91,38],[105,41,91,39,"entryType"],[105,50,91,48],[105,55,91,53],[105,68,91,66],[105,69,91,67],[105,71,91,69],[107,6,93,4],[108,6,94,4],[108,12,94,10,"minLongestInteraction"],[108,33,94,31],[108,36,94,34],[108,40,94,38],[108,41,94,39,"_longestInteractionList"],[108,64,94,62],[108,65,94,63,"at"],[108,67,94,65],[108,68,94,66],[108,69,94,67],[108,70,94,68],[108,71,94,69],[109,6,96,4],[109,10,96,8,"interaction"],[109,21,96,19],[109,24,96,22],[109,28,96,26],[109,29,96,27,"_longestInteractionMap"],[109,51,96,49],[109,52,96,50,"get"],[109,55,96,53],[109,56,96,54,"entry"],[109,61,96,59],[109,62,96,60,"interactionId"],[109,75,96,73],[109,76,96,74],[111,6,98,4],[112,6,99,4],[113,6,100,4],[113,10,101,6,"interaction"],[113,21,101,17],[113,25,102,6],[113,29,102,10],[113,30,102,11,"_longestInteractionList"],[113,53,102,34],[113,54,102,35,"length"],[113,60,102,41],[113,63,102,44,"MAX_INTERACTIONS_TO_CONSIDER"],[113,91,102,72],[114,6,103,6],[115,6,104,6,"entry"],[115,11,104,11],[115,12,104,12,"duration"],[115,20,104,20],[115,23,104,23,"minLongestInteraction"],[115,44,104,44],[115,45,104,45,"_latency"],[115,53,104,53],[115,55,105,6],[116,8,106,6],[117,8,107,6],[117,12,107,10,"interaction"],[117,23,107,21],[117,25,107,23],[118,10,108,8],[119,10,109,8],[120,10,110,8],[120,14,110,12,"entry"],[120,19,110,17],[120,20,110,18,"duration"],[120,28,110,26],[120,31,110,29,"interaction"],[120,42,110,40],[120,43,110,41,"_latency"],[120,51,110,49],[120,53,110,51],[121,12,111,10,"interaction"],[121,23,111,21],[121,24,111,22,"entries"],[121,31,111,29],[121,34,111,32],[121,35,111,33,"entry"],[121,40,111,38],[121,41,111,39],[122,12,112,10,"interaction"],[122,23,112,21],[122,24,112,22,"_latency"],[122,32,112,30],[122,35,112,33,"entry"],[122,40,112,38],[122,41,112,39,"duration"],[122,49,112,47],[123,10,113,8],[123,11,113,9],[123,17,113,15],[123,21,113,19,"entry"],[123,26,113,24],[123,27,113,25,"duration"],[123,35,113,33],[123,40,113,38,"interaction"],[123,51,113,49],[123,52,113,50,"_latency"],[123,60,113,58],[123,64,113,62,"entry"],[123,69,113,67],[123,70,113,68,"startTime"],[123,79,113,77],[123,84,113,82,"interaction"],[123,95,113,93],[123,96,113,94,"entries"],[123,103,113,101],[123,104,113,102],[123,105,113,103],[123,106,113,104],[123,107,113,105,"startTime"],[123,116,113,114],[123,118,113,116],[124,12,114,10,"interaction"],[124,23,114,21],[124,24,114,22,"entries"],[124,31,114,29],[124,32,114,30,"push"],[124,36,114,34],[124,37,114,35,"entry"],[124,42,114,40],[124,43,114,41],[125,10,115,8],[126,8,116,6],[126,9,116,7],[126,15,116,13],[127,10,117,8,"interaction"],[127,21,117,19],[127,24,117,22],[128,12,118,10,"id"],[128,14,118,12],[128,16,118,14,"entry"],[128,21,118,19],[128,22,118,20,"interactionId"],[128,35,118,33],[129,12,119,10,"entries"],[129,19,119,17],[129,21,119,19],[129,22,119,20,"entry"],[129,27,119,25],[129,28,119,26],[130,12,120,10,"_latency"],[130,20,120,18],[130,22,120,20,"entry"],[130,27,120,25],[130,28,120,26,"duration"],[131,10,121,8],[131,11,121,9],[132,10,122,8],[132,14,122,12],[132,15,122,13,"_longestInteractionMap"],[132,37,122,35],[132,38,122,36,"set"],[132,41,122,39],[132,42,122,40,"interaction"],[132,53,122,51],[132,54,122,52,"id"],[132,56,122,54],[132,58,122,56,"interaction"],[132,69,122,67],[132,70,122,68],[133,10,123,8],[133,14,123,12],[133,15,123,13,"_longestInteractionList"],[133,38,123,36],[133,39,123,37,"push"],[133,43,123,41],[133,44,123,42,"interaction"],[133,55,123,53],[133,56,123,54],[134,8,124,6],[136,8,126,6],[137,8,127,6],[137,12,127,10],[137,13,127,11,"_longestInteractionList"],[137,36,127,34],[137,37,127,35,"sort"],[137,41,127,39],[137,42,127,40],[137,43,127,41,"a"],[137,44,127,42],[137,46,127,44,"b"],[137,47,127,45],[137,52,127,50,"b"],[137,53,127,51],[137,54,127,52,"_latency"],[137,62,127,60],[137,65,127,63,"a"],[137,66,127,64],[137,67,127,65,"_latency"],[137,75,127,73],[137,76,127,74],[138,8,128,6],[138,12,128,10],[138,16,128,14],[138,17,128,15,"_longestInteractionList"],[138,40,128,38],[138,41,128,39,"length"],[138,47,128,45],[138,50,128,48,"MAX_INTERACTIONS_TO_CONSIDER"],[138,78,128,76],[138,80,128,78],[139,10,129,8],[139,16,129,14,"removedInteractions"],[139,35,129,33],[139,38,129,36],[139,42,129,40],[139,43,129,41,"_longestInteractionList"],[139,66,129,64],[139,67,129,65,"splice"],[139,73,129,71],[139,74,129,72,"MAX_INTERACTIONS_TO_CONSIDER"],[139,102,129,100],[139,103,129,101],[140,10,131,8],[140,15,131,13],[140,21,131,19,"interaction"],[140,32,131,30],[140,36,131,34,"removedInteractions"],[140,55,131,53],[140,57,131,55],[141,12,132,10],[141,16,132,14],[141,17,132,15,"_longestInteractionMap"],[141,39,132,37],[141,40,132,38,"delete"],[141,46,132,44],[141,47,132,45,"interaction"],[141,58,132,56],[141,59,132,57,"id"],[141,61,132,59],[141,62,132,60],[142,10,133,8],[143,8,134,6],[145,8,136,6],[146,8,137,6],[146,12,137,10],[146,13,137,11,"_onAfterProcessingINPCandidate"],[146,43,137,41],[146,46,137,44,"interaction"],[146,57,137,55],[146,58,137,56],[147,6,138,4],[148,4,139,2],[149,2,140,0],[150,0,140,1],[150,3]],"functionMap":{"names":["<global>","getInteractionCountForNavigation","InteractionManager","constructor","__init","__init2","_resetInteractions","_estimateP98LongestInteraction","_processEntry","_longestInteractionList.sort$argument_0"],"mappings":"AAA;yCC+B;CDE;AEK,0BC,iHD;EEO,6CF;EGO,oDH;EIO;GJI;EKO;GLO;EMS;wCCwC,iCD;GNY;CFC"},"hasCjsExports":false},"type":"js/module"}]}