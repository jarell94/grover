{"dependencies":[{"name":"../../../types.js","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":43,"index":43}}],"key":"How8xsoS0dUDpKnVy0jHSdmxOM4=","exportNames":["*"],"imports":1}},{"name":"./getActivationStart.js","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":2,"column":0,"index":44},"end":{"line":2,"column":61,"index":105}}],"key":"HZgTfwsiKuqLBQr5NRx20nhaN6c=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  Object.defineProperty(exports, \"getVisibilityWatcher\", {\n    enumerable: true,\n    get: function () {\n      return getVisibilityWatcher;\n    }\n  });\n  var _typesJs = require(_dependencyMap[0], \"../../../types.js\");\n  var _getActivationStartJs = require(_dependencyMap[1], \"./getActivationStart.js\");\n  /*\n   * Copyright 2020 Google LLC\n   *\n   * Licensed under the Apache License, Version 2.0 (the \"License\");\n   * you may not use this file except in compliance with the License.\n   * You may obtain a copy of the License at\n   *\n   *     https://www.apache.org/licenses/LICENSE-2.0\n   *\n   * Unless required by applicable law or agreed to in writing, software\n   * distributed under the License is distributed on an \"AS IS\" BASIS,\n   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n   * See the License for the specific language governing permissions and\n   * limitations under the License.\n   */\n\n  let firstHiddenTime = -1;\n  const initHiddenTime = () => {\n    // If the document is hidden when this code runs, assume it was always\n    // hidden and the page was loaded in the background, with the one exception\n    // that visibility state is always 'hidden' during prerendering, so we have\n    // to ignore that case until prerendering finishes (see: `prerenderingchange`\n    // event logic below).\n    return _typesJs.WINDOW.document?.visibilityState === 'hidden' && !_typesJs.WINDOW.document?.prerendering ? 0 : Infinity;\n  };\n  const onVisibilityUpdate = event => {\n    // If the document is 'hidden' and no previous hidden timestamp has been\n    // set, update it based on the current event data.\n    if (_typesJs.WINDOW.document.visibilityState === 'hidden' && firstHiddenTime > -1) {\n      // If the event is a 'visibilitychange' event, it means the page was\n      // visible prior to this change, so the event timestamp is the first\n      // hidden time.\n      // However, if the event is not a 'visibilitychange' event, then it must\n      // be a 'prerenderingchange' event, and the fact that the document is\n      // still 'hidden' from the above check means the tab was activated\n      // in a background state and so has always been hidden.\n      firstHiddenTime = event.type === 'visibilitychange' ? event.timeStamp : 0;\n\n      // Remove all listeners now that a `firstHiddenTime` value has been set.\n      removeChangeListeners();\n    }\n  };\n  const addChangeListeners = () => {\n    addEventListener('visibilitychange', onVisibilityUpdate, true);\n    // IMPORTANT: when a page is prerendering, its `visibilityState` is\n    // 'hidden', so in order to account for cases where this module checks for\n    // visibility during prerendering, an additional check after prerendering\n    // completes is also required.\n    addEventListener('prerenderingchange', onVisibilityUpdate, true);\n  };\n  const removeChangeListeners = () => {\n    removeEventListener('visibilitychange', onVisibilityUpdate, true);\n    removeEventListener('prerenderingchange', onVisibilityUpdate, true);\n  };\n  const getVisibilityWatcher = () => {\n    if (_typesJs.WINDOW.document && firstHiddenTime < 0) {\n      // Check if we have a previous hidden `visibility-state` performance entry.\n      const activationStart = (0, _getActivationStartJs.getActivationStart)();\n      const firstVisibilityStateHiddenTime = !_typesJs.WINDOW.document.prerendering ? globalThis.performance.getEntriesByType('visibility-state').filter(e => e.name === 'hidden' && e.startTime > activationStart)[0]?.startTime : undefined;\n\n      // Prefer that, but if it's not available and the document is hidden when\n      // this code runs, assume it was hidden since navigation start. This isn't\n      // a perfect heuristic, but it's the best we can do until the\n      // `visibility-state` performance entry becomes available in all browsers.\n      firstHiddenTime = firstVisibilityStateHiddenTime ?? initHiddenTime();\n      // We're still going to listen to for changes so we can handle things like\n      // bfcache restores and/or prerender without having to examine individual\n      // timestamps in detail.\n      addChangeListeners();\n    }\n    return {\n      get firstHiddenTime() {\n        return firstHiddenTime;\n      }\n    };\n  };\n});","lineCount":91,"map":[[7,2,91,0,"Object"],[7,8,91,0],[7,9,91,0,"defineProperty"],[7,23,91,0],[7,24,91,0,"exports"],[7,31,91,0],[8,4,91,0,"enumerable"],[8,14,91,0],[9,4,91,0,"get"],[9,7,91,0],[9,18,91,0,"get"],[9,19,91,0],[10,6,91,0],[10,13,91,9,"getVisibilityWatcher"],[10,33,91,29],[11,4,91,29],[12,2,91,29],[13,2,1,0],[13,6,1,0,"_typesJs"],[13,14,1,0],[13,17,1,0,"require"],[13,24,1,0],[13,25,1,0,"_dependencyMap"],[13,39,1,0],[14,2,2,0],[14,6,2,0,"_getActivationStartJs"],[14,27,2,0],[14,30,2,0,"require"],[14,37,2,0],[14,38,2,0,"_dependencyMap"],[14,52,2,0],[15,2,4,0],[16,0,5,0],[17,0,6,0],[18,0,7,0],[19,0,8,0],[20,0,9,0],[21,0,10,0],[22,0,11,0],[23,0,12,0],[24,0,13,0],[25,0,14,0],[26,0,15,0],[27,0,16,0],[28,0,17,0],[29,0,18,0],[31,2,21,0],[31,6,21,4,"firstHiddenTime"],[31,21,21,19],[31,24,21,22],[31,25,21,23],[31,26,21,24],[32,2,23,0],[32,8,23,6,"initHiddenTime"],[32,22,23,20],[32,25,23,23,"initHiddenTime"],[32,26,23,23],[32,31,23,29],[33,4,24,2],[34,4,25,2],[35,4,26,2],[36,4,27,2],[37,4,28,2],[38,4,29,2],[38,11,29,9,"WINDOW"],[38,19,29,15],[38,20,29,15,"WINDOW"],[38,26,29,15],[38,27,29,16,"document"],[38,35,29,24],[38,37,29,26,"visibilityState"],[38,52,29,41],[38,57,29,46],[38,65,29,54],[38,69,29,58],[38,70,29,59,"WINDOW"],[38,78,29,65],[38,79,29,65,"WINDOW"],[38,85,29,65],[38,86,29,66,"document"],[38,94,29,74],[38,96,29,76,"prerendering"],[38,108,29,88],[38,111,29,91],[38,112,29,92],[38,115,29,95,"Infinity"],[38,123,29,103],[39,2,30,0],[39,3,30,1],[40,2,32,0],[40,8,32,6,"onVisibilityUpdate"],[40,26,32,24],[40,29,32,28,"event"],[40,34,32,33],[40,38,32,38],[41,4,33,2],[42,4,34,2],[43,4,35,2],[43,8,35,6,"WINDOW"],[43,16,35,12],[43,17,35,12,"WINDOW"],[43,23,35,12],[43,24,35,13,"document"],[43,32,35,21],[43,33,35,22,"visibilityState"],[43,48,35,37],[43,53,35,42],[43,61,35,50],[43,65,35,54,"firstHiddenTime"],[43,80,35,69],[43,83,35,72],[43,84,35,73],[43,85,35,74],[43,87,35,76],[44,6,36,4],[45,6,37,4],[46,6,38,4],[47,6,39,4],[48,6,40,4],[49,6,41,4],[50,6,42,4],[51,6,43,4,"firstHiddenTime"],[51,21,43,19],[51,24,43,22,"event"],[51,29,43,27],[51,30,43,28,"type"],[51,34,43,32],[51,39,43,37],[51,57,43,55],[51,60,43,58,"event"],[51,65,43,63],[51,66,43,64,"timeStamp"],[51,75,43,73],[51,78,43,76],[51,79,43,77],[53,6,45,4],[54,6,46,4,"removeChangeListeners"],[54,27,46,25],[54,28,46,26],[54,29,46,27],[55,4,47,2],[56,2,48,0],[56,3,48,1],[57,2,50,0],[57,8,50,6,"addChangeListeners"],[57,26,50,24],[57,29,50,27,"addChangeListeners"],[57,30,50,27],[57,35,50,33],[58,4,51,2,"addEventListener"],[58,20,51,18],[58,21,51,19],[58,39,51,37],[58,41,51,39,"onVisibilityUpdate"],[58,59,51,57],[58,61,51,59],[58,65,51,63],[58,66,51,64],[59,4,52,2],[60,4,53,2],[61,4,54,2],[62,4,55,2],[63,4,56,2,"addEventListener"],[63,20,56,18],[63,21,56,19],[63,41,56,39],[63,43,56,41,"onVisibilityUpdate"],[63,61,56,59],[63,63,56,61],[63,67,56,65],[63,68,56,66],[64,2,57,0],[64,3,57,1],[65,2,59,0],[65,8,59,6,"removeChangeListeners"],[65,29,59,27],[65,32,59,30,"removeChangeListeners"],[65,33,59,30],[65,38,59,36],[66,4,60,2,"removeEventListener"],[66,23,60,21],[66,24,60,22],[66,42,60,40],[66,44,60,42,"onVisibilityUpdate"],[66,62,60,60],[66,64,60,62],[66,68,60,66],[66,69,60,67],[67,4,61,2,"removeEventListener"],[67,23,61,21],[67,24,61,22],[67,44,61,42],[67,46,61,44,"onVisibilityUpdate"],[67,64,61,62],[67,66,61,64],[67,70,61,68],[67,71,61,69],[68,2,62,0],[68,3,62,1],[69,2,64,0],[69,8,64,6,"getVisibilityWatcher"],[69,28,64,26],[69,31,64,29,"getVisibilityWatcher"],[69,32,64,29],[69,37,64,35],[70,4,65,2],[70,8,65,6,"WINDOW"],[70,16,65,12],[70,17,65,12,"WINDOW"],[70,23,65,12],[70,24,65,13,"document"],[70,32,65,21],[70,36,65,25,"firstHiddenTime"],[70,51,65,40],[70,54,65,43],[70,55,65,44],[70,57,65,46],[71,6,66,4],[72,6,67,4],[72,12,67,10,"activationStart"],[72,27,67,25],[72,30,67,28],[72,34,67,28,"getActivationStart"],[72,55,67,46],[72,56,67,46,"getActivationStart"],[72,74,67,46],[72,76,67,47],[72,77,67,48],[73,6,68,4],[73,12,68,10,"firstVisibilityStateHiddenTime"],[73,42,68,40],[73,45,68,43],[73,46,68,44,"WINDOW"],[73,54,68,50],[73,55,68,50,"WINDOW"],[73,61,68,50],[73,62,68,51,"document"],[73,70,68,59],[73,71,68,60,"prerendering"],[73,83,68,72],[73,86,69,8,"globalThis"],[73,96,69,18],[73,97,69,19,"performance"],[73,108,69,30],[73,109,70,11,"getEntriesByType"],[73,125,70,27],[73,126,70,28],[73,144,70,46],[73,145,70,47],[73,146,71,11,"filter"],[73,152,71,17],[73,153,71,18,"e"],[73,154,71,19],[73,158,71,23,"e"],[73,159,71,24],[73,160,71,25,"name"],[73,164,71,29],[73,169,71,34],[73,177,71,42],[73,181,71,46,"e"],[73,182,71,47],[73,183,71,48,"startTime"],[73,192,71,57],[73,195,71,60,"activationStart"],[73,210,71,75],[73,211,71,76],[73,212,71,77],[73,213,71,78],[73,214,71,79],[73,216,71,81,"startTime"],[73,225,71,90],[73,228,72,8,"undefined"],[73,237,72,17],[75,6,74,4],[76,6,75,4],[77,6,76,4],[78,6,77,4],[79,6,78,4,"firstHiddenTime"],[79,21,78,19],[79,24,78,22,"firstVisibilityStateHiddenTime"],[79,54,78,52],[79,58,78,56,"initHiddenTime"],[79,72,78,70],[79,73,78,71],[79,74,78,72],[80,6,79,4],[81,6,80,4],[82,6,81,4],[83,6,82,4,"addChangeListeners"],[83,24,82,22],[83,25,82,23],[83,26,82,24],[84,4,83,2],[85,4,84,2],[85,11,84,9],[86,6,85,4],[86,10,85,8,"firstHiddenTime"],[86,25,85,23,"firstHiddenTime"],[86,26,85,23],[86,28,85,26],[87,8,86,6],[87,15,86,13,"firstHiddenTime"],[87,30,86,28],[88,6,87,4],[89,4,88,2],[89,5,88,3],[90,2,89,0],[90,3,89,1],[91,0,89,2],[91,3]],"functionMap":{"names":["<global>","initHiddenTime","onVisibilityUpdate","addChangeListeners","removeChangeListeners","getVisibilityWatcher","globalThis.performance.getEntriesByType.filter$argument_0","get__firstHiddenTime"],"mappings":"AAA;uBCsB;CDO;2BEE;CFgB;2BGE;CHO;8BIE;CJG;6BKE;kBCO,yDD;IEc;KFE;CLE"},"hasCjsExports":false},"type":"js/module"}]}