{"dependencies":[{"name":"../../utils/object.js","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":45,"index":45}}],"key":"RQrRGqbksOCD9OzK2x3a4ahzdIU=","exportNames":["*"],"imports":1}},{"name":"./handlers.js","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":2,"column":0,"index":46},"end":{"line":2,"column":51,"index":97}}],"key":"KucQFengibIO2FPJs66kwgxrI08=","exportNames":["*"],"imports":1}},{"name":"./transport.js","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":3,"column":0,"index":98},"end":{"line":3,"column":117,"index":215}}],"key":"EpyMzzuR/FbwDpvh9f/hZSyWf2c=","exportNames":["*"],"imports":1}},{"name":"./validation.js","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":4,"column":0,"index":216},"end":{"line":4,"column":60,"index":276}}],"key":"wSuRSTlWQJOdJulOWcNvpmeJHkU=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  Object.defineProperty(exports, \"wrapMcpServerWithSentry\", {\n    enumerable: true,\n    get: function () {\n      return wrapMcpServerWithSentry;\n    }\n  });\n  var _utilsObjectJs = require(_dependencyMap[0], \"../../utils/object.js\");\n  var _handlersJs = require(_dependencyMap[1], \"./handlers.js\");\n  var _transportJs = require(_dependencyMap[2], \"./transport.js\");\n  var _validationJs = require(_dependencyMap[3], \"./validation.js\");\n  /**\n   * Tracks wrapped MCP server instances to prevent double-wrapping\n   * @internal\n   */\n  const wrappedMcpServerInstances = new WeakSet();\n\n  /**\n   * Wraps a MCP Server instance from the `@modelcontextprotocol/sdk` package with Sentry instrumentation.\n   *\n   * Compatible with versions `^1.9.0` of the `@modelcontextprotocol/sdk` package.\n   * Automatically instruments transport methods and handler functions for comprehensive monitoring.\n   *\n   * @example\n   * ```typescript\n   * import * as Sentry from '@sentry/core';\n   * import { McpServer } from '@modelcontextprotocol/sdk/server/mcp.js';\n   * import { StreamableHTTPServerTransport } from '@modelcontextprotocol/sdk/server/streamableHttp.js';\n   *\n   * const server = Sentry.wrapMcpServerWithSentry(\n   *   new McpServer({ name: \"my-server\", version: \"1.0.0\" })\n   * );\n   *\n   * const transport = new StreamableHTTPServerTransport();\n   * await server.connect(transport);\n   * ```\n   *\n   * @param mcpServerInstance - MCP server instance to instrument\n   * @returns Instrumented server instance (same reference)\n   */\n  function wrapMcpServerWithSentry(mcpServerInstance) {\n    if (wrappedMcpServerInstances.has(mcpServerInstance)) {\n      return mcpServerInstance;\n    }\n    if (!(0, _validationJs.validateMcpServerInstance)(mcpServerInstance)) {\n      return mcpServerInstance;\n    }\n    const serverInstance = mcpServerInstance;\n    (0, _utilsObjectJs.fill)(serverInstance, 'connect', originalConnect => {\n      return async function (transport, ...restArgs) {\n        const result = await originalConnect.call(this, transport, ...restArgs);\n        (0, _transportJs.wrapTransportOnMessage)(transport);\n        (0, _transportJs.wrapTransportSend)(transport);\n        (0, _transportJs.wrapTransportOnClose)(transport);\n        (0, _transportJs.wrapTransportError)(transport);\n        return result;\n      };\n    });\n    (0, _handlersJs.wrapAllMCPHandlers)(serverInstance);\n    wrappedMcpServerInstances.add(mcpServerInstance);\n    return mcpServerInstance;\n  }\n});","lineCount":68,"map":[[7,2,69,0,"Object"],[7,8,69,0],[7,9,69,0,"defineProperty"],[7,23,69,0],[7,24,69,0,"exports"],[7,31,69,0],[8,4,69,0,"enumerable"],[8,14,69,0],[9,4,69,0,"get"],[9,7,69,0],[9,18,69,0,"get"],[9,19,69,0],[10,6,69,0],[10,13,69,9,"wrapMcpServerWithSentry"],[10,36,69,32],[11,4,69,32],[12,2,69,32],[13,2,1,0],[13,6,1,0,"_utilsObjectJs"],[13,20,1,0],[13,23,1,0,"require"],[13,30,1,0],[13,31,1,0,"_dependencyMap"],[13,45,1,0],[14,2,2,0],[14,6,2,0,"_handlersJs"],[14,17,2,0],[14,20,2,0,"require"],[14,27,2,0],[14,28,2,0,"_dependencyMap"],[14,42,2,0],[15,2,3,0],[15,6,3,0,"_transportJs"],[15,18,3,0],[15,21,3,0,"require"],[15,28,3,0],[15,29,3,0,"_dependencyMap"],[15,43,3,0],[16,2,4,0],[16,6,4,0,"_validationJs"],[16,19,4,0],[16,22,4,0,"require"],[16,29,4,0],[16,30,4,0,"_dependencyMap"],[16,44,4,0],[17,2,6,0],[18,0,7,0],[19,0,8,0],[20,0,9,0],[21,2,10,0],[21,8,10,6,"wrappedMcpServerInstances"],[21,33,10,31],[21,36,10,34],[21,40,10,38,"WeakSet"],[21,47,10,45],[21,48,10,46],[21,49,10,47],[23,2,12,0],[24,0,13,0],[25,0,14,0],[26,0,15,0],[27,0,16,0],[28,0,17,0],[29,0,18,0],[30,0,19,0],[31,0,20,0],[32,0,21,0],[33,0,22,0],[34,0,23,0],[35,0,24,0],[36,0,25,0],[37,0,26,0],[38,0,27,0],[39,0,28,0],[40,0,29,0],[41,0,30,0],[42,0,31,0],[43,0,32,0],[44,0,33,0],[45,0,34,0],[46,2,35,0],[46,11,35,9,"wrapMcpServerWithSentry"],[46,34,35,32,"wrapMcpServerWithSentry"],[46,35,35,33,"mcpServerInstance"],[46,52,35,50],[46,54,35,52],[47,4,36,2],[47,8,36,6,"wrappedMcpServerInstances"],[47,33,36,31],[47,34,36,32,"has"],[47,37,36,35],[47,38,36,36,"mcpServerInstance"],[47,55,36,53],[47,56,36,54],[47,58,36,56],[48,6,37,4],[48,13,37,11,"mcpServerInstance"],[48,30,37,28],[49,4,38,2],[50,4,40,2],[50,8,40,6],[50,9,40,7],[50,13,40,7,"validateMcpServerInstance"],[50,26,40,32],[50,27,40,32,"validateMcpServerInstance"],[50,52,40,32],[50,54,40,33,"mcpServerInstance"],[50,71,40,50],[50,72,40,51],[50,74,40,53],[51,6,41,4],[51,13,41,11,"mcpServerInstance"],[51,30,41,28],[52,4,42,2],[53,4,44,2],[53,10,44,8,"serverInstance"],[53,24,44,22],[53,27,44,25,"mcpServerInstance"],[53,44,44,42],[54,4,46,2],[54,8,46,2,"fill"],[54,22,46,6],[54,23,46,6,"fill"],[54,27,46,6],[54,29,46,7,"serverInstance"],[54,43,46,21],[54,45,46,23],[54,54,46,32],[54,56,46,34,"originalConnect"],[54,71,46,49],[54,75,46,53],[55,6,47,4],[55,13,47,11],[55,29,47,28,"transport"],[55,38,47,37],[55,40,47,39],[55,43,47,42,"restArgs"],[55,51,47,50],[55,53,47,52],[56,8,48,6],[56,14,48,12,"result"],[56,20,48,18],[56,23,48,21],[56,29,48,28,"originalConnect"],[56,44,48,43],[56,45,48,46,"call"],[56,49,48,50],[56,50,49,8],[56,54,49,12],[56,56,50,8,"transport"],[56,65,50,17],[56,67,51,8],[56,70,51,11,"restArgs"],[56,78,52,6],[56,79,52,7],[57,8,54,6],[57,12,54,6,"wrapTransportOnMessage"],[57,24,54,28],[57,25,54,28,"wrapTransportOnMessage"],[57,47,54,28],[57,49,54,29,"transport"],[57,58,54,38],[57,59,54,39],[58,8,55,6],[58,12,55,6,"wrapTransportSend"],[58,24,55,23],[58,25,55,23,"wrapTransportSend"],[58,42,55,23],[58,44,55,24,"transport"],[58,53,55,33],[58,54,55,34],[59,8,56,6],[59,12,56,6,"wrapTransportOnClose"],[59,24,56,26],[59,25,56,26,"wrapTransportOnClose"],[59,45,56,26],[59,47,56,27,"transport"],[59,56,56,36],[59,57,56,37],[60,8,57,6],[60,12,57,6,"wrapTransportError"],[60,24,57,24],[60,25,57,24,"wrapTransportError"],[60,43,57,24],[60,45,57,25,"transport"],[60,54,57,34],[60,55,57,35],[61,8,59,6],[61,15,59,13,"result"],[61,21,59,19],[62,6,60,4],[62,7,60,5],[63,4,61,2],[63,5,61,3],[63,6,61,4],[64,4,63,2],[64,8,63,2,"wrapAllMCPHandlers"],[64,19,63,20],[64,20,63,20,"wrapAllMCPHandlers"],[64,38,63,20],[64,40,63,21,"serverInstance"],[64,54,63,35],[64,55,63,36],[65,4,65,2,"wrappedMcpServerInstances"],[65,29,65,27],[65,30,65,28,"add"],[65,33,65,31],[65,34,65,32,"mcpServerInstance"],[65,51,65,49],[65,52,65,50],[66,4,66,2],[66,11,66,9,"mcpServerInstance"],[66,28,66,26],[67,2,67,0],[68,0,67,1],[68,3]],"functionMap":{"names":["<global>","wrapMcpServerWithSentry","fill$argument_2","<anonymous>"],"mappings":"AAA;ACkC;kCCW;WCC;KDa;GDC;CDM"},"hasCjsExports":false},"type":"js/module"}]}