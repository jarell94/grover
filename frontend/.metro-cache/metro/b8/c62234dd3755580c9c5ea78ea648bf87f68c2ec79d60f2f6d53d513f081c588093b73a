{"dependencies":[{"name":"@sentry/core","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":93,"index":93}}],"key":"/o+dASQcHF2bB25icdsM0E4TExc=","exportNames":["*"],"imports":1}},{"name":"../debug-build.js","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":2,"column":0,"index":94},"end":{"line":2,"column":48,"index":142}}],"key":"rfhktnzi6PvZxT1xtyHWbBktN/w=","exportNames":["*"],"imports":1}},{"name":"../helpers.js","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":3,"column":0,"index":143},"end":{"line":3,"column":39,"index":182}}],"key":"xGB1RU1bemGAHq3E44EIR7oSA2c=","exportNames":["*"],"imports":1}},{"name":"./utils.js","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":4,"column":0,"index":183},"end":{"line":4,"column":123,"index":306}}],"key":"NIaSEHO1E48gsZc7jH9Ex1xTHgE=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  Object.defineProperty(exports, \"startProfileForSpan\", {\n    enumerable: true,\n    get: function () {\n      return startProfileForSpan;\n    }\n  });\n  var _sentryCore = require(_dependencyMap[0], \"@sentry/core\");\n  var _debugBuildJs = require(_dependencyMap[1], \"../debug-build.js\");\n  var _helpersJs = require(_dependencyMap[2], \"../helpers.js\");\n  var _utilsJs = require(_dependencyMap[3], \"./utils.js\");\n  /**\n   * Wraps startTransaction and stopTransaction with profiling related logic.\n   * startProfileForTransaction is called after the call to startTransaction in order to avoid our own code from\n   * being profiled. Because of that same reason, stopProfiling is called before the call to stopTransaction.\n   */\n  function startProfileForSpan(span) {\n    // Start the profiler and get the profiler instance.\n    let startTimestamp;\n    if ((0, _utilsJs.isAutomatedPageLoadSpan)(span)) {\n      startTimestamp = (0, _sentryCore.timestampInSeconds)() * 1000;\n    }\n    const profiler = (0, _utilsJs.startJSSelfProfile)();\n\n    // We failed to construct the profiler, so we skip.\n    // No need to log anything as this has already been logged in startProfile.\n    if (!profiler) {\n      return;\n    }\n    if (_debugBuildJs.DEBUG_BUILD) {\n      _sentryCore.debug.log(`[Profiling] started profiling span: ${(0, _sentryCore.spanToJSON)(span).description}`);\n    }\n\n    // We create \"unique\" span names to avoid concurrent spans with same names\n    // from being ignored by the profiler. From here on, only this span name should be used when\n    // calling the profiler methods. Note: we log the original name to the user to avoid confusion.\n    const profileId = (0, _sentryCore.uuid4)();\n    (0, _sentryCore.getCurrentScope)().setContext('profile', {\n      profile_id: profileId,\n      start_timestamp: startTimestamp\n    });\n\n    /**\n     * Idempotent handler for profile stop\n     */\n    async function onProfileHandler() {\n      // Check if the profile exists and return it the behavior has to be idempotent as users may call span.finish multiple times.\n      if (!span) {\n        return;\n      }\n      // Satisfy the type checker, but profiler will always be defined here.\n      if (!profiler) {\n        return;\n      }\n      return profiler.stop().then(profile => {\n        if (maxDurationTimeoutID) {\n          _helpersJs.WINDOW.clearTimeout(maxDurationTimeoutID);\n          maxDurationTimeoutID = undefined;\n        }\n        if (_debugBuildJs.DEBUG_BUILD) {\n          _sentryCore.debug.log(`[Profiling] stopped profiling of span: ${(0, _sentryCore.spanToJSON)(span).description}`);\n        }\n\n        // In case of an overlapping span, stopProfiling may return null and silently ignore the overlapping profile.\n        if (!profile) {\n          if (_debugBuildJs.DEBUG_BUILD) {\n            _sentryCore.debug.log(`[Profiling] profiler returned null profile for: ${(0, _sentryCore.spanToJSON)(span).description}`, 'this may indicate an overlapping span or a call to stopProfiling with a profile title that was never started');\n          }\n          return;\n        }\n        (0, _utilsJs.addProfileToGlobalCache)(profileId, profile);\n      }).catch(error => {\n        if (_debugBuildJs.DEBUG_BUILD) {\n          _sentryCore.debug.log('[Profiling] error while stopping profiler:', error);\n        }\n      });\n    }\n\n    // Enqueue a timeout to prevent profiles from running over max duration.\n    let maxDurationTimeoutID = _helpersJs.WINDOW.setTimeout(() => {\n      if (_debugBuildJs.DEBUG_BUILD) {\n        _sentryCore.debug.log('[Profiling] max profile duration elapsed, stopping profiling for:', (0, _sentryCore.spanToJSON)(span).description);\n      }\n      // If the timeout exceeds, we want to stop profiling, but not finish the span\n      // eslint-disable-next-line @typescript-eslint/no-floating-promises\n      onProfileHandler();\n    }, _utilsJs.MAX_PROFILE_DURATION_MS);\n\n    // We need to reference the original end call to avoid creating an infinite loop\n    const originalEnd = span.end.bind(span);\n\n    /**\n     * Wraps span `end()` with profiling related logic.\n     * startProfiling is called after the call to spanStart in order to avoid our own code from\n     * being profiled. Because of that same reason, stopProfiling is called before the call to spanEnd.\n     */\n    function profilingWrappedSpanEnd() {\n      if (!span) {\n        return originalEnd();\n      }\n      // onProfileHandler should always return the same profile even if this is called multiple times.\n      // Always call onProfileHandler to ensure stopProfiling is called and the timeout is cleared.\n      void onProfileHandler().then(() => {\n        originalEnd();\n      }, () => {\n        // If onProfileHandler fails, we still want to call the original finish method.\n        originalEnd();\n      });\n      return span;\n    }\n    span.end = profilingWrappedSpanEnd;\n  }\n});","lineCount":118,"map":[[7,2,125,0,"Object"],[7,8,125,0],[7,9,125,0,"defineProperty"],[7,23,125,0],[7,24,125,0,"exports"],[7,31,125,0],[8,4,125,0,"enumerable"],[8,14,125,0],[9,4,125,0,"get"],[9,7,125,0],[9,18,125,0,"get"],[9,19,125,0],[10,6,125,0],[10,13,125,9,"startProfileForSpan"],[10,32,125,28],[11,4,125,28],[12,2,125,28],[13,2,1,0],[13,6,1,0,"_sentryCore"],[13,17,1,0],[13,20,1,0,"require"],[13,27,1,0],[13,28,1,0,"_dependencyMap"],[13,42,1,0],[14,2,2,0],[14,6,2,0,"_debugBuildJs"],[14,19,2,0],[14,22,2,0,"require"],[14,29,2,0],[14,30,2,0,"_dependencyMap"],[14,44,2,0],[15,2,3,0],[15,6,3,0,"_helpersJs"],[15,16,3,0],[15,19,3,0,"require"],[15,26,3,0],[15,27,3,0,"_dependencyMap"],[15,41,3,0],[16,2,4,0],[16,6,4,0,"_utilsJs"],[16,14,4,0],[16,17,4,0,"require"],[16,24,4,0],[16,25,4,0,"_dependencyMap"],[16,39,4,0],[17,2,6,0],[18,0,7,0],[19,0,8,0],[20,0,9,0],[21,0,10,0],[22,2,11,0],[22,11,11,9,"startProfileForSpan"],[22,30,11,28,"startProfileForSpan"],[22,31,11,29,"span"],[22,35,11,33],[22,37,11,35],[23,4,12,2],[24,4,13,2],[24,8,13,6,"startTimestamp"],[24,22,13,20],[25,4,14,2],[25,8,14,6],[25,12,14,6,"isAutomatedPageLoadSpan"],[25,20,14,29],[25,21,14,29,"isAutomatedPageLoadSpan"],[25,44,14,29],[25,46,14,30,"span"],[25,50,14,34],[25,51,14,35],[25,53,14,37],[26,6,15,4,"startTimestamp"],[26,20,15,18],[26,23,15,21],[26,27,15,21,"timestampInSeconds"],[26,38,15,39],[26,39,15,39,"timestampInSeconds"],[26,57,15,39],[26,59,15,40],[26,60,15,41],[26,63,15,44],[26,67,15,48],[27,4,16,2],[28,4,18,2],[28,10,18,8,"profiler"],[28,18,18,16],[28,21,18,19],[28,25,18,19,"startJSSelfProfile"],[28,33,18,37],[28,34,18,37,"startJSSelfProfile"],[28,52,18,37],[28,54,18,38],[28,55,18,39],[30,4,20,2],[31,4,21,2],[32,4,22,2],[32,8,22,6],[32,9,22,7,"profiler"],[32,17,22,15],[32,19,22,17],[33,6,23,4],[34,4,24,2],[35,4,26,2],[35,8,26,6,"DEBUG_BUILD"],[35,21,26,17],[35,22,26,17,"DEBUG_BUILD"],[35,33,26,17],[35,35,26,19],[36,6,27,4,"debug"],[36,17,27,9],[36,18,27,9,"debug"],[36,23,27,9],[36,24,27,10,"log"],[36,27,27,13],[36,28,27,14],[36,67,27,53],[36,71,27,53,"spanToJSON"],[36,82,27,63],[36,83,27,63,"spanToJSON"],[36,93,27,63],[36,95,27,64,"span"],[36,99,27,68],[36,100,27,69],[36,101,27,70,"description"],[36,112,27,81],[36,114,27,83],[36,115,27,84],[37,4,28,2],[39,4,30,2],[40,4,31,2],[41,4,32,2],[42,4,33,2],[42,10,33,8,"profileId"],[42,19,33,17],[42,22,33,20],[42,26,33,20,"uuid4"],[42,37,33,25],[42,38,33,25,"uuid4"],[42,43,33,25],[42,45,33,26],[42,46,33,27],[43,4,35,2],[43,8,35,2,"getCurrentScope"],[43,19,35,17],[43,20,35,17,"getCurrentScope"],[43,35,35,17],[43,37,35,18],[43,38,35,19],[43,39,35,20,"setContext"],[43,49,35,30],[43,50,35,31],[43,59,35,40],[43,61,35,42],[44,6,36,4,"profile_id"],[44,16,36,14],[44,18,36,16,"profileId"],[44,27,36,25],[45,6,37,4,"start_timestamp"],[45,21,37,19],[45,23,37,21,"startTimestamp"],[46,4,38,2],[46,5,38,3],[46,6,38,4],[48,4,40,2],[49,0,41,0],[50,0,42,0],[51,4,43,2],[51,19,43,17,"onProfileHandler"],[51,35,43,33,"onProfileHandler"],[51,36,43,33],[51,38,43,36],[52,6,44,4],[53,6,45,4],[53,10,45,8],[53,11,45,9,"span"],[53,15,45,13],[53,17,45,15],[54,8,46,6],[55,6,47,4],[56,6,48,4],[57,6,49,4],[57,10,49,8],[57,11,49,9,"profiler"],[57,19,49,17],[57,21,49,19],[58,8,50,6],[59,6,51,4],[60,6,53,4],[60,13,53,11,"profiler"],[60,21,53,19],[60,22,54,7,"stop"],[60,26,54,11],[60,27,54,12],[60,28,54,13],[60,29,55,7,"then"],[60,33,55,11],[60,34,55,13,"profile"],[60,41,55,20],[60,45,55,25],[61,8,56,8],[61,12,56,12,"maxDurationTimeoutID"],[61,32,56,32],[61,34,56,34],[62,10,57,10,"WINDOW"],[62,20,57,16],[62,21,57,16,"WINDOW"],[62,27,57,16],[62,28,57,17,"clearTimeout"],[62,40,57,29],[62,41,57,30,"maxDurationTimeoutID"],[62,61,57,50],[62,62,57,51],[63,10,58,10,"maxDurationTimeoutID"],[63,30,58,30],[63,33,58,33,"undefined"],[63,42,58,42],[64,8,59,8],[65,8,61,8],[65,12,61,12,"DEBUG_BUILD"],[65,25,61,23],[65,26,61,23,"DEBUG_BUILD"],[65,37,61,23],[65,39,61,25],[66,10,62,10,"debug"],[66,21,62,15],[66,22,62,15,"debug"],[66,27,62,15],[66,28,62,16,"log"],[66,31,62,19],[66,32,62,20],[66,74,62,62],[66,78,62,62,"spanToJSON"],[66,89,62,72],[66,90,62,72,"spanToJSON"],[66,100,62,72],[66,102,62,73,"span"],[66,106,62,77],[66,107,62,78],[66,108,62,79,"description"],[66,119,62,90],[66,121,62,92],[66,122,62,93],[67,8,63,8],[69,8,65,8],[70,8,66,8],[70,12,66,12],[70,13,66,13,"profile"],[70,20,66,20],[70,22,66,22],[71,10,67,10],[71,14,67,14,"DEBUG_BUILD"],[71,27,67,25],[71,28,67,25,"DEBUG_BUILD"],[71,39,67,25],[71,41,67,27],[72,12,68,12,"debug"],[72,23,68,17],[72,24,68,17,"debug"],[72,29,68,17],[72,30,68,18,"log"],[72,33,68,21],[72,34,69,14],[72,85,69,65],[72,89,69,65,"spanToJSON"],[72,100,69,75],[72,101,69,75,"spanToJSON"],[72,111,69,75],[72,113,69,76,"span"],[72,117,69,80],[72,118,69,81],[72,119,69,82,"description"],[72,130,69,93],[72,132,69,95],[72,134,70,14],[72,244,71,12],[72,245,71,13],[73,10,72,10],[74,10,73,10],[75,8,74,8],[76,8,76,8],[76,12,76,8,"addProfileToGlobalCache"],[76,20,76,31],[76,21,76,31,"addProfileToGlobalCache"],[76,44,76,31],[76,46,76,32,"profileId"],[76,55,76,41],[76,57,76,43,"profile"],[76,64,76,50],[76,65,76,51],[77,6,77,6],[77,7,77,7],[77,8,77,8],[77,9,78,7,"catch"],[77,14,78,12],[77,15,78,13,"error"],[77,20,78,18],[77,24,78,22],[78,8,79,8],[78,12,79,12,"DEBUG_BUILD"],[78,25,79,23],[78,26,79,23,"DEBUG_BUILD"],[78,37,79,23],[78,39,79,25],[79,10,80,10,"debug"],[79,21,80,15],[79,22,80,15,"debug"],[79,27,80,15],[79,28,80,16,"log"],[79,31,80,19],[79,32,80,20],[79,76,80,64],[79,78,80,66,"error"],[79,83,80,71],[79,84,80,72],[80,8,81,8],[81,6,82,6],[81,7,82,7],[81,8,82,8],[82,4,83,2],[84,4,85,2],[85,4,86,2],[85,8,86,6,"maxDurationTimeoutID"],[85,28,86,26],[85,31,86,29,"WINDOW"],[85,41,86,35],[85,42,86,35,"WINDOW"],[85,48,86,35],[85,49,86,36,"setTimeout"],[85,59,86,46],[85,60,86,47],[85,66,86,53],[86,6,87,4],[86,10,87,8,"DEBUG_BUILD"],[86,23,87,19],[86,24,87,19,"DEBUG_BUILD"],[86,35,87,19],[86,37,87,21],[87,8,88,6,"debug"],[87,19,88,11],[87,20,88,11,"debug"],[87,25,88,11],[87,26,88,12,"log"],[87,29,88,15],[87,30,88,16],[87,97,88,83],[87,99,88,85],[87,103,88,85,"spanToJSON"],[87,114,88,95],[87,115,88,95,"spanToJSON"],[87,125,88,95],[87,127,88,96,"span"],[87,131,88,100],[87,132,88,101],[87,133,88,102,"description"],[87,144,88,113],[87,145,88,114],[88,6,89,4],[89,6,90,4],[90,6,91,4],[91,6,92,4,"onProfileHandler"],[91,22,92,20],[91,23,92,21],[91,24,92,22],[92,4,93,2],[92,5,93,3],[92,7,93,5,"MAX_PROFILE_DURATION_MS"],[92,15,93,28],[92,16,93,28,"MAX_PROFILE_DURATION_MS"],[92,39,93,28],[92,40,93,29],[94,4,95,2],[95,4,96,2],[95,10,96,8,"originalEnd"],[95,21,96,19],[95,24,96,22,"span"],[95,28,96,26],[95,29,96,27,"end"],[95,32,96,30],[95,33,96,31,"bind"],[95,37,96,35],[95,38,96,36,"span"],[95,42,96,40],[95,43,96,41],[97,4,98,2],[98,0,99,0],[99,0,100,0],[100,0,101,0],[101,0,102,0],[102,4,103,2],[102,13,103,11,"profilingWrappedSpanEnd"],[102,36,103,34,"profilingWrappedSpanEnd"],[102,37,103,34],[102,39,103,37],[103,6,104,4],[103,10,104,8],[103,11,104,9,"span"],[103,15,104,13],[103,17,104,15],[104,8,105,6],[104,15,105,13,"originalEnd"],[104,26,105,24],[104,27,105,25],[104,28,105,26],[105,6,106,4],[106,6,107,4],[107,6,108,4],[108,6,109,4],[108,11,109,9,"onProfileHandler"],[108,27,109,25],[108,28,109,26],[108,29,109,27],[108,30,109,28,"then"],[108,34,109,32],[108,35,110,6],[108,41,110,12],[109,8,111,8,"originalEnd"],[109,19,111,19],[109,20,111,20],[109,21,111,21],[110,6,112,6],[110,7,112,7],[110,9,113,6],[110,15,113,12],[111,8,114,8],[112,8,115,8,"originalEnd"],[112,19,115,19],[112,20,115,20],[112,21,115,21],[113,6,116,6],[113,7,117,4],[113,8,117,5],[114,6,119,4],[114,13,119,11,"span"],[114,17,119,15],[115,4,120,2],[116,4,122,2,"span"],[116,8,122,6],[116,9,122,7,"end"],[116,12,122,10],[116,15,122,13,"profilingWrappedSpanEnd"],[116,38,122,36],[117,2,123,0],[118,0,123,1],[118,3]],"functionMap":{"names":["<global>","startProfileForSpan","onProfileHandler","profiler.stop.then$argument_0","profiler.stop.then._catch$argument_0","WINDOW.setTimeout$argument_0","profilingWrappedSpanEnd","onProfileHandler.then$argument_0","onProfileHandler.then$argument_1"],"mappings":"AAA;ACU;ECgC;YCY;ODsB;aEC;OFI;GDC;+CIG;GJO;EKU;MCO;ODE;MEC;OFG;GLI;CDG"},"hasCjsExports":false},"type":"js/module"}]}