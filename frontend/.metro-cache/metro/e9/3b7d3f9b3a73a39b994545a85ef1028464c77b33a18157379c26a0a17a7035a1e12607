{"dependencies":[{"name":"../../utils/url.js","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":81,"index":81}}],"key":"7n2ZI7RMQXEmzpzkluv2/VyQdhU=","exportNames":["*"],"imports":1}},{"name":"./attributes.js","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":2,"column":0,"index":82},"end":{"line":2,"column":210,"index":292}}],"key":"UMlNobrmssIvLA9C9D03xjrDrQE=","exportNames":["*"],"imports":1}},{"name":"./methodConfig.js","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":3,"column":0,"index":293},"end":{"line":3,"column":75,"index":368}}],"key":"7Iv4eYbPbbAg2QP9HRAi/cM4JSo=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  Object.defineProperty(exports, \"buildTypeSpecificAttributes\", {\n    enumerable: true,\n    get: function () {\n      return buildTypeSpecificAttributes;\n    }\n  });\n  Object.defineProperty(exports, \"getNotificationAttributes\", {\n    enumerable: true,\n    get: function () {\n      return getNotificationAttributes;\n    }\n  });\n  var _utilsUrlJs = require(_dependencyMap[0], \"../../utils/url.js\");\n  var _attributesJs = require(_dependencyMap[1], \"./attributes.js\");\n  var _methodConfigJs = require(_dependencyMap[2], \"./methodConfig.js\");\n  /**\n   * Core attribute extraction and building functions for MCP server instrumentation\n   */\n\n  /**\n   * Extracts additional attributes for specific notification types\n   * @param method - Notification method name\n   * @param params - Notification parameters\n   * @returns Method-specific attributes for span instrumentation\n   */\n  function getNotificationAttributes(method, params) {\n    const attributes = {};\n    switch (method) {\n      case 'notifications/cancelled':\n        if (params?.requestId) {\n          attributes['mcp.cancelled.request_id'] = String(params.requestId);\n        }\n        if (params?.reason) {\n          attributes['mcp.cancelled.reason'] = String(params.reason);\n        }\n        break;\n      case 'notifications/message':\n        if (params?.level) {\n          attributes[_attributesJs.MCP_LOGGING_LEVEL_ATTRIBUTE] = String(params.level);\n        }\n        if (params?.logger) {\n          attributes[_attributesJs.MCP_LOGGING_LOGGER_ATTRIBUTE] = String(params.logger);\n        }\n        if (params?.data !== undefined) {\n          attributes[_attributesJs.MCP_LOGGING_DATA_TYPE_ATTRIBUTE] = typeof params.data;\n          if (typeof params.data === 'string') {\n            attributes[_attributesJs.MCP_LOGGING_MESSAGE_ATTRIBUTE] = params.data;\n          } else {\n            attributes[_attributesJs.MCP_LOGGING_MESSAGE_ATTRIBUTE] = JSON.stringify(params.data);\n          }\n        }\n        break;\n      case 'notifications/progress':\n        if (params?.progressToken) {\n          attributes['mcp.progress.token'] = String(params.progressToken);\n        }\n        if (typeof params?.progress === 'number') {\n          attributes['mcp.progress.current'] = params.progress;\n        }\n        if (typeof params?.total === 'number') {\n          attributes['mcp.progress.total'] = params.total;\n          if (typeof params?.progress === 'number') {\n            attributes['mcp.progress.percentage'] = params.progress / params.total * 100;\n          }\n        }\n        if (params?.message) {\n          attributes['mcp.progress.message'] = String(params.message);\n        }\n        break;\n      case 'notifications/resources/updated':\n        if (params?.uri) {\n          attributes[_attributesJs.MCP_RESOURCE_URI_ATTRIBUTE] = String(params.uri);\n          const urlObject = (0, _utilsUrlJs.parseStringToURLObject)(String(params.uri));\n          if (urlObject && !(0, _utilsUrlJs.isURLObjectRelative)(urlObject)) {\n            attributes['mcp.resource.protocol'] = urlObject.protocol.replace(':', '');\n          }\n        }\n        break;\n      case 'notifications/initialized':\n        attributes['mcp.lifecycle.phase'] = 'initialization_complete';\n        attributes['mcp.protocol.ready'] = 1;\n        break;\n    }\n    return attributes;\n  }\n\n  /**\n   * Build type-specific attributes based on message type\n   * @param type - Span type (request or notification)\n   * @param message - JSON-RPC message\n   * @param params - Optional parameters for attribute extraction\n   * @returns Type-specific attributes for span instrumentation\n   */\n  function buildTypeSpecificAttributes(type, message, params) {\n    if (type === 'request') {\n      const request = message;\n      const targetInfo = (0, _methodConfigJs.extractTargetInfo)(request.method, params || {});\n      return Object.assign({}, request.id !== undefined && {\n        [_attributesJs.MCP_REQUEST_ID_ATTRIBUTE]: String(request.id)\n      }, targetInfo.attributes, (0, _methodConfigJs.getRequestArguments)(request.method, params || {}));\n    }\n    return getNotificationAttributes(message.method, params || {});\n  }\n});","lineCount":110,"map":[[7,2,112,0,"Object"],[7,8,112,0],[7,9,112,0,"defineProperty"],[7,23,112,0],[7,24,112,0,"exports"],[7,31,112,0],[8,4,112,0,"enumerable"],[8,14,112,0],[9,4,112,0,"get"],[9,7,112,0],[9,18,112,0,"get"],[9,19,112,0],[10,6,112,0],[10,13,112,9,"buildTypeSpecificAttributes"],[10,40,112,36],[11,4,112,36],[12,2,112,36],[13,2,112,0,"Object"],[13,8,112,0],[13,9,112,0,"defineProperty"],[13,23,112,0],[13,24,112,0,"exports"],[13,31,112,0],[14,4,112,0,"enumerable"],[14,14,112,0],[15,4,112,0,"get"],[15,7,112,0],[15,18,112,0,"get"],[15,19,112,0],[16,6,112,0],[16,13,112,38,"getNotificationAttributes"],[16,38,112,63],[17,4,112,63],[18,2,112,63],[19,2,1,0],[19,6,1,0,"_utilsUrlJs"],[19,17,1,0],[19,20,1,0,"require"],[19,27,1,0],[19,28,1,0,"_dependencyMap"],[19,42,1,0],[20,2,2,0],[20,6,2,0,"_attributesJs"],[20,19,2,0],[20,22,2,0,"require"],[20,29,2,0],[20,30,2,0,"_dependencyMap"],[20,44,2,0],[21,2,3,0],[21,6,3,0,"_methodConfigJs"],[21,21,3,0],[21,24,3,0,"require"],[21,31,3,0],[21,32,3,0,"_dependencyMap"],[21,46,3,0],[22,2,5,0],[23,0,6,0],[24,0,7,0],[26,2,10,0],[27,0,11,0],[28,0,12,0],[29,0,13,0],[30,0,14,0],[31,0,15,0],[32,2,16,0],[32,11,16,9,"getNotificationAttributes"],[32,36,16,34,"getNotificationAttributes"],[32,37,17,2,"method"],[32,43,17,8],[32,45,18,2,"params"],[32,51,18,8],[32,53,19,2],[33,4,20,2],[33,10,20,8,"attributes"],[33,20,20,18],[33,23,20,21],[33,24,20,22],[33,25,20,23],[34,4,22,2],[34,12,22,10,"method"],[34,18,22,16],[35,6,23,4],[35,11,23,9],[35,36,23,34],[36,8,24,6],[36,12,24,10,"params"],[36,18,24,16],[36,20,24,18,"requestId"],[36,29,24,27],[36,31,24,29],[37,10,25,8,"attributes"],[37,20,25,18],[37,21,25,19],[37,47,25,45],[37,48,25,46],[37,51,25,49,"String"],[37,57,25,55],[37,58,25,56,"params"],[37,64,25,62],[37,65,25,63,"requestId"],[37,74,25,72],[37,75,25,73],[38,8,26,6],[39,8,27,6],[39,12,27,10,"params"],[39,18,27,16],[39,20,27,18,"reason"],[39,26,27,24],[39,28,27,26],[40,10,28,8,"attributes"],[40,20,28,18],[40,21,28,19],[40,43,28,41],[40,44,28,42],[40,47,28,45,"String"],[40,53,28,51],[40,54,28,52,"params"],[40,60,28,58],[40,61,28,59,"reason"],[40,67,28,65],[40,68,28,66],[41,8,29,6],[42,8,30,6],[43,6,32,4],[43,11,32,9],[43,34,32,32],[44,8,33,6],[44,12,33,10,"params"],[44,18,33,16],[44,20,33,18,"level"],[44,25,33,23],[44,27,33,25],[45,10,34,8,"attributes"],[45,20,34,18],[45,21,34,19,"MCP_LOGGING_LEVEL_ATTRIBUTE"],[45,34,34,46],[45,35,34,46,"MCP_LOGGING_LEVEL_ATTRIBUTE"],[45,62,34,46],[45,63,34,47],[45,66,34,50,"String"],[45,72,34,56],[45,73,34,57,"params"],[45,79,34,63],[45,80,34,64,"level"],[45,85,34,69],[45,86,34,70],[46,8,35,6],[47,8,36,6],[47,12,36,10,"params"],[47,18,36,16],[47,20,36,18,"logger"],[47,26,36,24],[47,28,36,26],[48,10,37,8,"attributes"],[48,20,37,18],[48,21,37,19,"MCP_LOGGING_LOGGER_ATTRIBUTE"],[48,34,37,47],[48,35,37,47,"MCP_LOGGING_LOGGER_ATTRIBUTE"],[48,63,37,47],[48,64,37,48],[48,67,37,51,"String"],[48,73,37,57],[48,74,37,58,"params"],[48,80,37,64],[48,81,37,65,"logger"],[48,87,37,71],[48,88,37,72],[49,8,38,6],[50,8,39,6],[50,12,39,10,"params"],[50,18,39,16],[50,20,39,18,"data"],[50,24,39,22],[50,29,39,27,"undefined"],[50,38,39,36],[50,40,39,38],[51,10,40,8,"attributes"],[51,20,40,18],[51,21,40,19,"MCP_LOGGING_DATA_TYPE_ATTRIBUTE"],[51,34,40,50],[51,35,40,50,"MCP_LOGGING_DATA_TYPE_ATTRIBUTE"],[51,66,40,50],[51,67,40,51],[51,70,40,54],[51,77,40,61,"params"],[51,83,40,67],[51,84,40,68,"data"],[51,88,40,72],[52,10,41,8],[52,14,41,12],[52,21,41,19,"params"],[52,27,41,25],[52,28,41,26,"data"],[52,32,41,30],[52,37,41,35],[52,45,41,43],[52,47,41,45],[53,12,42,10,"attributes"],[53,22,42,20],[53,23,42,21,"MCP_LOGGING_MESSAGE_ATTRIBUTE"],[53,36,42,50],[53,37,42,50,"MCP_LOGGING_MESSAGE_ATTRIBUTE"],[53,66,42,50],[53,67,42,51],[53,70,42,54,"params"],[53,76,42,60],[53,77,42,61,"data"],[53,81,42,65],[54,10,43,8],[54,11,43,9],[54,17,43,15],[55,12,44,10,"attributes"],[55,22,44,20],[55,23,44,21,"MCP_LOGGING_MESSAGE_ATTRIBUTE"],[55,36,44,50],[55,37,44,50,"MCP_LOGGING_MESSAGE_ATTRIBUTE"],[55,66,44,50],[55,67,44,51],[55,70,44,54,"JSON"],[55,74,44,58],[55,75,44,59,"stringify"],[55,84,44,68],[55,85,44,69,"params"],[55,91,44,75],[55,92,44,76,"data"],[55,96,44,80],[55,97,44,81],[56,10,45,8],[57,8,46,6],[58,8,47,6],[59,6,49,4],[59,11,49,9],[59,35,49,33],[60,8,50,6],[60,12,50,10,"params"],[60,18,50,16],[60,20,50,18,"progressToken"],[60,33,50,31],[60,35,50,33],[61,10,51,8,"attributes"],[61,20,51,18],[61,21,51,19],[61,41,51,39],[61,42,51,40],[61,45,51,43,"String"],[61,51,51,49],[61,52,51,50,"params"],[61,58,51,56],[61,59,51,57,"progressToken"],[61,72,51,70],[61,73,51,71],[62,8,52,6],[63,8,53,6],[63,12,53,10],[63,19,53,17,"params"],[63,25,53,23],[63,27,53,25,"progress"],[63,35,53,33],[63,40,53,38],[63,48,53,46],[63,50,53,48],[64,10,54,8,"attributes"],[64,20,54,18],[64,21,54,19],[64,43,54,41],[64,44,54,42],[64,47,54,45,"params"],[64,53,54,51],[64,54,54,52,"progress"],[64,62,54,60],[65,8,55,6],[66,8,56,6],[66,12,56,10],[66,19,56,17,"params"],[66,25,56,23],[66,27,56,25,"total"],[66,32,56,30],[66,37,56,35],[66,45,56,43],[66,47,56,45],[67,10,57,8,"attributes"],[67,20,57,18],[67,21,57,19],[67,41,57,39],[67,42,57,40],[67,45,57,43,"params"],[67,51,57,49],[67,52,57,50,"total"],[67,57,57,55],[68,10,58,8],[68,14,58,12],[68,21,58,19,"params"],[68,27,58,25],[68,29,58,27,"progress"],[68,37,58,35],[68,42,58,40],[68,50,58,48],[68,52,58,50],[69,12,59,10,"attributes"],[69,22,59,20],[69,23,59,21],[69,48,59,46],[69,49,59,47],[69,52,59,51,"params"],[69,58,59,57],[69,59,59,58,"progress"],[69,67,59,66],[69,70,59,69,"params"],[69,76,59,75],[69,77,59,76,"total"],[69,82,59,81],[69,85,59,85],[69,88,59,88],[70,10,60,8],[71,8,61,6],[72,8,62,6],[72,12,62,10,"params"],[72,18,62,16],[72,20,62,18,"message"],[72,27,62,25],[72,29,62,27],[73,10,63,8,"attributes"],[73,20,63,18],[73,21,63,19],[73,43,63,41],[73,44,63,42],[73,47,63,45,"String"],[73,53,63,51],[73,54,63,52,"params"],[73,60,63,58],[73,61,63,59,"message"],[73,68,63,66],[73,69,63,67],[74,8,64,6],[75,8,65,6],[76,6,67,4],[76,11,67,9],[76,44,67,42],[77,8,68,6],[77,12,68,10,"params"],[77,18,68,16],[77,20,68,18,"uri"],[77,23,68,21],[77,25,68,23],[78,10,69,8,"attributes"],[78,20,69,18],[78,21,69,19,"MCP_RESOURCE_URI_ATTRIBUTE"],[78,34,69,45],[78,35,69,45,"MCP_RESOURCE_URI_ATTRIBUTE"],[78,61,69,45],[78,62,69,46],[78,65,69,49,"String"],[78,71,69,55],[78,72,69,56,"params"],[78,78,69,62],[78,79,69,63,"uri"],[78,82,69,66],[78,83,69,67],[79,10,70,8],[79,16,70,14,"urlObject"],[79,25,70,23],[79,28,70,26],[79,32,70,26,"parseStringToURLObject"],[79,43,70,48],[79,44,70,48,"parseStringToURLObject"],[79,66,70,48],[79,68,70,49,"String"],[79,74,70,55],[79,75,70,56,"params"],[79,81,70,62],[79,82,70,63,"uri"],[79,85,70,66],[79,86,70,67],[79,87,70,68],[80,10,71,8],[80,14,71,12,"urlObject"],[80,23,71,21],[80,27,71,25],[80,28,71,26],[80,32,71,26,"isURLObjectRelative"],[80,43,71,45],[80,44,71,45,"isURLObjectRelative"],[80,63,71,45],[80,65,71,46,"urlObject"],[80,74,71,55],[80,75,71,56],[80,77,71,58],[81,12,72,10,"attributes"],[81,22,72,20],[81,23,72,21],[81,46,72,44],[81,47,72,45],[81,50,72,48,"urlObject"],[81,59,72,57],[81,60,72,58,"protocol"],[81,68,72,66],[81,69,72,67,"replace"],[81,76,72,74],[81,77,72,75],[81,80,72,78],[81,82,72,80],[81,84,72,82],[81,85,72,83],[82,10,73,8],[83,8,74,6],[84,8,75,6],[85,6,77,4],[85,11,77,9],[85,38,77,36],[86,8,78,6,"attributes"],[86,18,78,16],[86,19,78,17],[86,40,78,38],[86,41,78,39],[86,44,78,42],[86,69,78,67],[87,8,79,6,"attributes"],[87,18,79,16],[87,19,79,17],[87,39,79,37],[87,40,79,38],[87,43,79,41],[87,44,79,42],[88,8,80,6],[89,4,81,2],[90,4,83,2],[90,11,83,9,"attributes"],[90,21,83,19],[91,2,84,0],[93,2,86,0],[94,0,87,0],[95,0,88,0],[96,0,89,0],[97,0,90,0],[98,0,91,0],[99,0,92,0],[100,2,93,0],[100,11,93,9,"buildTypeSpecificAttributes"],[100,38,93,36,"buildTypeSpecificAttributes"],[100,39,94,2,"type"],[100,43,94,6],[100,45,95,2,"message"],[100,52,95,9],[100,54,96,2,"params"],[100,60,96,8],[100,62,97,2],[101,4,98,2],[101,8,98,6,"type"],[101,12,98,10],[101,17,98,15],[101,26,98,24],[101,28,98,26],[102,6,99,4],[102,12,99,10,"request"],[102,19,99,17],[102,22,99,20,"message"],[102,29,99,27],[103,6,100,4],[103,12,100,10,"targetInfo"],[103,22,100,20],[103,25,100,23],[103,29,100,23,"extractTargetInfo"],[103,44,100,40],[103,45,100,40,"extractTargetInfo"],[103,62,100,40],[103,64,100,41,"request"],[103,71,100,48],[103,72,100,49,"method"],[103,78,100,55],[103,80,100,57,"params"],[103,86,100,63],[103,90,100,67],[103,91,100,68],[103,92,100,69],[103,93,100,70],[104,6,102,4],[104,13,102,4,"Object"],[104,19,102,4],[104,20,102,4,"assign"],[104,26,102,4],[104,31,103,10,"request"],[104,38,103,17],[104,39,103,18,"id"],[104,41,103,20],[104,46,103,25,"undefined"],[104,55,103,34],[104,59,103,38],[105,8,103,40],[105,9,103,41,"MCP_REQUEST_ID_ATTRIBUTE"],[105,22,103,65],[105,23,103,65,"MCP_REQUEST_ID_ATTRIBUTE"],[105,47,103,65],[105,50,103,68,"String"],[105,56,103,74],[105,57,103,75,"request"],[105,64,103,82],[105,65,103,83,"id"],[105,67,103,85],[106,6,103,87],[106,7,103,88],[106,9,104,9,"targetInfo"],[106,19,104,19],[106,20,104,20,"attributes"],[106,30,104,30],[106,32,105,9],[106,36,105,9,"getRequestArguments"],[106,51,105,28],[106,52,105,28,"getRequestArguments"],[106,71,105,28],[106,73,105,29,"request"],[106,80,105,36],[106,81,105,37,"method"],[106,87,105,43],[106,89,105,45,"params"],[106,95,105,51],[106,99,105,55],[106,100,105,56],[106,101,105,57],[106,102,105,58],[107,4,107,2],[108,4,109,2],[108,11,109,9,"getNotificationAttributes"],[108,36,109,34],[108,37,109,35,"message"],[108,44,109,42],[108,45,109,43,"method"],[108,51,109,49],[108,53,109,51,"params"],[108,59,109,57],[108,63,109,61],[108,64,109,62],[108,65,109,63],[108,66,109,64],[109,2,110,0],[110,0,110,1],[110,3]],"functionMap":{"names":["<global>","getNotificationAttributes","buildTypeSpecificAttributes"],"mappings":"AAA;ACe;CDoE;AES;CFiB"},"hasCjsExports":false},"type":"js/module"}]}